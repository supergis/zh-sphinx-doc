% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}

\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
  \DeclareUnicodeCharacter{00A0}{\nobreakspace}
\else\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb}
\usepackage{babel}
\usepackage{times}
\usepackage[Sonny]{fncychap}
\usepackage{longtable}
\usepackage{sphinx}
\usepackage{multirow}
\usepackage{eqparbox}


\addto\captionsenglish{\renewcommand{\figurename}{图 }}
\addto\captionsenglish{\renewcommand{\tablename}{表 }}
\SetupFloatingEnvironment{literal-block}{name=列表 }

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}

\hypersetup{unicode=true}
#\usepackage{CJKutf8}
\AtBeginDocument{\begin{CJK}{UTF8}{gbsn}}
\AtEndDocument{\end{CJK}}


\title{sphinx Documentation}
\date{5月 07, 2016}
\release{}
\author{openthings}
\newcommand{\sphinxlogo}{}
\renewcommand{\releasename}{发布}
\makeindex

\makeatletter
\def\PYG@reset{\let\PYG@it=\relax \let\PYG@bf=\relax%
    \let\PYG@ul=\relax \let\PYG@tc=\relax%
    \let\PYG@bc=\relax \let\PYG@ff=\relax}
\def\PYG@tok#1{\csname PYG@tok@#1\endcsname}
\def\PYG@toks#1+{\ifx\relax#1\empty\else%
    \PYG@tok{#1}\expandafter\PYG@toks\fi}
\def\PYG@do#1{\PYG@bc{\PYG@tc{\PYG@ul{%
    \PYG@it{\PYG@bf{\PYG@ff{#1}}}}}}}
\def\PYG#1#2{\PYG@reset\PYG@toks#1+\relax+\PYG@do{#2}}

\expandafter\def\csname PYG@tok@na\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@vg\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@gu\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@sr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.14,0.33,0.53}{##1}}}
\expandafter\def\csname PYG@tok@ne\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@gs\endcsname{\let\PYG@bf=\textbf}
\expandafter\def\csname PYG@tok@kt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.56,0.13,0.00}{##1}}}
\expandafter\def\csname PYG@tok@vi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@mh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@m\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@err\endcsname{\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PYG@tok@go\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.20,0.20,0.20}{##1}}}
\expandafter\def\csname PYG@tok@ss\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.32,0.47,0.09}{##1}}}
\expandafter\def\csname PYG@tok@kn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@sx\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@o\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PYG@tok@ni\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.84,0.33,0.22}{##1}}}
\expandafter\def\csname PYG@tok@mf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@nf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.49}{##1}}}
\expandafter\def\csname PYG@tok@si\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.44,0.63,0.82}{##1}}}
\expandafter\def\csname PYG@tok@sb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@cpf\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@s\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@se\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@c\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@gr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gp\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@cs\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\colorbox[rgb]{1.00,0.94,0.94}{\strut ##1}}}
\expandafter\def\csname PYG@tok@nt\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.45}{##1}}}
\expandafter\def\csname PYG@tok@kc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@w\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PYG@tok@sh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@cp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@no\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.38,0.68,0.84}{##1}}}
\expandafter\def\csname PYG@tok@gi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PYG@tok@k\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@il\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@gd\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@nn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@cm\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@nv\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@mi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@sc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@gh\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@ch\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@kd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@gt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PYG@tok@vc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@nd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.33,0.33,0.33}{##1}}}
\expandafter\def\csname PYG@tok@ow\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@kr\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@ge\endcsname{\let\PYG@it=\textit}
\expandafter\def\csname PYG@tok@nl\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.13,0.44}{##1}}}
\expandafter\def\csname PYG@tok@nc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@c1\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@kp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@mb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@s1\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@mo\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@s2\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@nb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@sd\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@bp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}

\def\PYGZbs{\char`\\}
\def\PYGZus{\char`\_}
\def\PYGZob{\char`\{}
\def\PYGZcb{\char`\}}
\def\PYGZca{\char`\^}
\def\PYGZam{\char`\&}
\def\PYGZlt{\char`\<}
\def\PYGZgt{\char`\>}
\def\PYGZsh{\char`\#}
\def\PYGZpc{\char`\%}
\def\PYGZdl{\char`\$}
\def\PYGZhy{\char`\-}
\def\PYGZsq{\char`\'}
\def\PYGZdq{\char`\"}
\def\PYGZti{\char`\~}
% for compatibility with earlier versions
\def\PYGZat{@}
\def\PYGZlb{[}
\def\PYGZrb{]}
\makeatother

\renewcommand\PYGZsq{\textquotesingle}

\begin{document}

\maketitle
\tableofcontents
\phantomsection\label{contents::doc}



\chapter{译者前言}
\label{index:id1}\label{index:sphinx}\label{index:contents}\label{index::doc}
sphinx使用手册,源文档地址 \href{http://sphinx.pocoo.org/}{Sphinx} .
\begin{quote}

\textbf{用户评价:}
\code{值得欢呼的好工具，确实方便那些需要书写文档的程序员们!}
\end{quote}


\chapter{欢迎}
\label{index:id2}\begin{quote}

Sphinx 是一种文档工具，它可以令人轻松的撰写出清晰且优美的文档, 由 Georg Brandl 在BSD 许可证下开发.
\href{http://docs.python.org/}{新版的Python文档} 就是由Sphinx生成的，
并且它已成为Python项目首选的文档工具,同时它对 C/C++ 项目也有很好的支持; 并计划对其它开发语言添加特殊支持.
本站当然也是使用 Sphinx 生成的，它采用reStructuredText!
Sphinx还在继续开发. 下面列出了其良好特性,这些特性在Python官方文档中均有体现:
\begin{itemize}
\item {} 
\emph{丰富的输出格式:} 支持 HTML (包括 Windows 帮助文档), LaTeX (可以打印PDF版本), manual pages（man 文档）, 纯文本

\item {} 
\emph{完备的交叉引用:} 语义化的标签,并可以自动化链接函数,类,引文,术语及相似的片段信息

\item {} 
\emph{明晰的分层结构:} 可以轻松的定义文档树,并自动化链接同级/父级/下级文章

\item {} 
\emph{美观的自动索引:} 可自动生成美观的模块索引

\item {} 
\emph{精确的语法高亮:} 基于 \href{http://pygments.org/}{Pygments} 自动生成语法高亮

\item {} 
\emph{开放的扩展:} 支持代码块的自动测试,并包含Python模块的自述文档(API docs)等

\end{itemize}

Sphinx 使用 \href{http://docutils.sf.net/rst.html}{reStructuredText}
作为标记语言, 可以享有 \href{http://docutils.sf.net/}{Docutils} 为reStructuredText提供的分析，转换等多种工具.
\end{quote}


\chapter{引言}
\label{intro:id1}\label{intro::doc}
该文档是Sphinx建立文档的参考.  Sphinx 将 \href{http://docutils.sf.net/rst.html}{reStructuredText}  源文件集转换为丰富的输出格式，并自动产生参考文献、索引等.
简言之，如果你有一个包含reST-格式的文档的目录（包含文档的所有文件或子目录）,
Sphinx 会生成组织合理的HTML文件（在另一个目录里），使得浏览及导航功能使用非常方便.
通用一份源文件，你可以生成LaTeX 文件，然后编译成 PDF 版本的文档,
也可以直接使用 \href{http://rst2pdf.googlecode.com}{rst2pdf} 生成PDF 文件.

重点讨论的是手写文档而不是自动生成的API文档.
但是我们对于两种都支持的很好，甚至支持两种内容混合的文档,
假如你需要纯净的API文档，查看 \href{http://epydoc.sf.net/}{Epydoc}, 它可以解析 reST.


\section{不同文档系统的转换}
\label{intro:id2}
这一节搜集了一些有用的提示，帮助我们从其他的文档系统迁移到reStructuredText/Sphinx.
\begin{itemize}
\item {} 
Gerard Flanagan （人名）写了一个脚本把纯净的HTML转换为 reST文本;
你可以到 \href{http://pypi.python.org/pypi/html2rest}{Python 索引页} 查看.

\item {} 
原来的Python文档转换为 Sphinx,
代码托管在 \href{http://svn.python.org/projects/doctools/converter}{the Python SVN repository}.
它包含将Python-doc-style LaTeX 标记转换为Sphinx reST 的生成代码.

\item {} 
Marcin Wojdyr 写了一个脚本，将 Docbook 转换为 reST ; 可查看 \href{http://code.google.com/p/db2rst/}{Google Code}.

\item {} 
Christophe de Vienne 写了一个将 Open/LibreOffice 文档转换为
Sphinx的工具: \href{http://pypi.python.org/pypi/odt2sphinx/}{odt2sphinx}.

\item {} 
转换不同的标记语言, \href{http://johnmacfarlane.net/pandoc/}{Pandoc} 也是一个非常有用的工具.

\end{itemize}


\section{在其他系统中使用}
\label{intro:id3}
请参考 {\hyperref[faq:usingwith]{\crossref{\DUrole{std,std-ref}{pertinent section in the FAQ list}}}}.


\section{前提}
\label{intro:id4}
Sphinx 运行前需要安装 \textbf{Python 2.4} 或者 \textbf{Python 3.1} , 以及
\href{http://docutils.sf.net/}{docutils} 和 \href{http://jinja.pocoo.org/}{Jinja2} 库.  Sphinx 必须工作在 0.7 版本及一些 SVN 快照(不能损坏).
如果需要源码支持高亮显示，则必须安装 \href{http://pygments.org/}{Pygments} 库.

如果使用 \textbf{Python 2.4} ，还需要 \href{http://pypi.python.org/pypi/uuid/}{uuid}.


\section{用法}
\label{intro:uuid}\label{intro:id5}
更深入的话题,请参考 {\hyperref[tutorial::doc]{\crossref{\DUrole{doc}{Sphinx初尝}}}} .


\chapter{Sphinx初尝}
\label{tutorial:sphinx}\label{tutorial::doc}
此文档是Sphinx使用的综览性教程，包含Sphinx常用的任务处理.

绿色箭头链接了任务操作的详细信息.


\section{配置文档源}
\label{tutorial:id1}
文档集的根目录叫 {\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}}.  该目录也包含了 Sphinx 的配置文件 \code{conf.py}, 在这里你可以配置Sphinx各个方面，使Sphinx按照你的要求读取源文件并创建文档.  \footnote[1]{\sphinxAtStartFootnote%
这只是一般情况. \code{conf.py} 可以被移动到其他目录，请参考 {\hyperref[glossary:term\string-configuration\string-directory]{\termref{\DUrole{xref,std,std-term}{configuration directory}}}} 及 {\hyperref[invocation:invocation]{\crossref{\DUrole{std,std-ref}{调用 sphinx-build}}}} .
}

Sphinx 有个脚本叫做 \textbf{\texttt{sphinx-quickstart}} ,它可以帮你建立源目录及默认配置文件 \code{conf.py} ，它通过几个简单的问题获取一些有用的配置值.
你仅需要运行

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sphinx\PYGZhy{}quickstart
\end{Verbatim}

然后回答这些问题.  (其中''autodoc'' 扩展选项请选中.)

它也会自动匹配 ``API 文档'' 生成器 \textbf{\texttt{sphinx-apidoc}}; 详细信息请参考 {\hyperref[invocation:invocation\string-apidoc]{\crossref{\DUrole{std,std-ref}{调用 sphinx-apidoc}}}}.


\section{定义文档结构}
\label{tutorial:id3}
假定你已经运行了 \textbf{\texttt{sphinx-quickstart}} .  它创建了源目录，包含 \code{conf.py}
及一份主文档 \code{index.rst} (如果你接受了默认选项).主文档 {\hyperref[glossary:term\string-master\string-document]{\termref{\DUrole{xref,std,std-term}{master document}}}} 的主要功能是被
转换成欢迎页, 它包含一个目录表（ ``table of contents tree''或者 \emph{toctree} ). Sphinx 主要功能是使用
reStructuredText, 把许多文件组织成一份结构合理的文档.
\setbox0\vbox{
\begin{minipage}{0.95\linewidth}
\textbf{reStructuredText 导读}

\medskip


\code{toctree} 是 reStructuredText的 \emph{directive} （指令）, 一种用途十分广泛的块标记.  定义了参数、选项及目录.

\emph{Arguments} 直接在双冒号后面给出指令的名字.  每个指令都有不定个数的参数.

\emph{Options} 在参数后以''字段列表''的形式给出.  如
\code{maxdepth} 是 \code{toctree} 指令的选项之一.

\emph{Content} 具体内容,在选项或参数的后面，隔开一个空行.  每个指令后面都跟着不同作用的内容.

共同的约定是 \textbf{内容与选项一般有相同的缩进} .
\end{minipage}}
\begin{center}\setlength{\fboxsep}{5pt}\shadowbox{\box0}\end{center}

toctree 指令初始为空, 如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:maxdepth:} \PYG{n+nf}{2}
\end{Verbatim}

你可以在 \emph{content} 的位置添加文档列表:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:maxdepth:} \PYG{n+nf}{2}

   intro
   tutorial
\PYG{c+cp}{   ...}
\end{Verbatim}

以上精确展示toctree 与文档的转换.  所有的文档以文件名 {\hyperref[glossary:term\string-document\string-name]{\termref{\DUrole{xref,std,std-term}{document name}}}}s的形式给出,
不需文件后缀名;使用斜线作为目录分隔符.

\raisebox{-0.5\height}{\includegraphics{{more}.png}} 更多信息请查看 {\hyperref[markup/toctree:toctree\string-directive]{\crossref{\DUrole{std,std-ref}{the toctree directive}}}}.

现在可以创建toctree指令后的文件及目录了，
它们的章节标题被插入到toctree指令的位置 (与 ``maxdepth'' 同一缩进) . 现在Sphinx已知道文档的分层结构.
(toctree指令后的文件也可以有 \code{toctree} 指令, 会生成更深的层次结构.)


\section{添加内容}
\label{tutorial:id4}
在Sphinx源文件里, 可以使用reStructuredText的很多特性.
也有些特性被添加到Sphinx中.  例如, 可以引用参考文件链接 (对所有输出类型均有效) ，使用 {\hyperref[markup/inline:role\string-ref]{\crossref{\code{ref}}}} 角色.

又如, 浏览HTML版本时想要查看文档的源文件，只需点击边框栏的''显示源代码''.
\begin{description}
\item[{\raisebox{-0.5\height}{\includegraphics{{more}.png}}  {\hyperref[rest:rst\string-primer]{\crossref{\DUrole{std,std-ref}{reStructuredText 简介}}}} 详细介绍了reStructuredText}] \leavevmode
{\hyperref[markup/index:sphinxmarkup]{\crossref{\DUrole{std,std-ref}{Sphinx标记的组成}}}} 列出了Sphinx添加的全部标记.

\end{description}


\section{运行创建工具}
\label{tutorial:id5}
现在已经添加了一些文件,下面可以创建文档了.
创建工具 \textbf{\texttt{sphinx-build}} , 使用方式

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sphinx\PYGZhy{}build \PYGZhy{}b html sourcedir builddir
\end{Verbatim}

\emph{sourcedir} 是源目录  {\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}} , \emph{builddir} 则是放置生成的文档的根目录. \code{-b} 是创建工具的选项;这个例子创建HTML文件.

\raisebox{-0.5\height}{\includegraphics{{more}.png}}  {\hyperref[invocation:invocation]{\crossref{\DUrole{std,std-ref}{调用 sphinx-build}}}} 列出工具 \textbf{\texttt{sphinx-build}}
支持的所有选项.
\begin{description}
\item[{而且, \textbf{\texttt{sphinx-quickstart}} 脚本创建的 \code{Makefile} 和}] \leavevmode
\code{make.bat} 使操作更容易，仅需运行

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} make html
\end{Verbatim}

\end{description}

创建 HTML 在设定好的目录里.  执行 \code{make} 将不需要任何参数.

\begin{notice}{note}{怎样产生PDF 文档?}

\code{make latexpdf} 运行在 {\hyperref[builders:sphinx.builders.latex.LaTeXBuilder]{\crossref{\code{LaTeX builder}}}} ,点击可以获取pdfTeX工具链.
\end{notice}


\section{文档对象}
\label{tutorial:id6}
Sphinx的对象 \emph{objects} (一般含义）在任何 \emph{domain} （主域）里是指简单的文档.  一个主域包含所有的对象类型,
完整的生成标记或引用对象的描述.
最著名的主域是Python 主域.  Python文档建立函数 \code{enumerate()} , 在源文件里添加:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} enumerate(sequence[, start=0])

   返回一个迭代器，输出包含索引及\PYG{g+ge}{*sequence*}里所有条目的元组.
\end{Verbatim}

返回形式为:
\index{enumerate() (內置函数)}

\begin{fulllineitems}
\phantomsection\label{tutorial:enumerate}\pysiglinewithargsret{\bfcode{enumerate}}{\emph{sequence}\optional{, \emph{start=0}}}{}
返回一个迭代器，输出包含索引及*sequence*里所有条目的元组

\end{fulllineitems}


指令的参数是对象的描述标示 \emph{signature} , 内容是对它的说明.同一行可以写多个参数.

Python 主域通常是默认的, 因此不需要特别标记出主域的名字:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{function}\PYG{p}{::} enumerate(sequence[, start=0])

\PYG{c+cp}{   ...}
\end{Verbatim}

以上在默认主域配置下效果是等同的.

对不同的Python 对象有不同的指令,
如 {\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}} 或者 {\hyperref[domains:directive\string-py:method]{\crossref{\code{py:method}}}} .  不同的对象类型有不同的引用角色 \emph{role} .
这个标记将创建链接到文档的 \code{enumerate()}

\begin{Verbatim}[commandchars=\\\{\}]
这个 \PYG{n+na}{:py:func:}\PYG{n+nv}{{}`enumerate{}`} 函数用于 ...
\end{Verbatim}

这是一个实例: 可链接 {\hyperref[tutorial:enumerate]{\crossref{\code{enumerate()}}}} .

同样如果默认为 Python 主域 \code{py:} 可以省略.  但这不重要，Sphinx会自动发现包含 \code{enumerate()} 的文件并且链接.

不同主域对于不同标示有特定的角色，以使输出格式更美观，在C/C++
主域里增加了链接到元素类型的角色.

\raisebox{-0.5\height}{\includegraphics{{more}.png}}  {\hyperref[domains:domains]{\crossref{\DUrole{std,std-ref}{Sphinx Domains}}}} 列出所有主域及其指令/角色.


\section{基本配置}
\label{tutorial:id7}
前面提到的文件 \code{conf.py} ，控制着Sphinx怎样生成文档.
这个文件以Python 源文件的形式执行你的配置信息 .
高级的使用者则通过Sphinx使其执行, 可以配置它实现不平凡的任务, 例如继承 \code{sys.path} 或者导入
模块标示文档的版本.

仅需要修改 \code{conf.py} ,可以改变默认值, 删除一些符号，修改对应的值.
(通过标准的 Python 操作符: \code{\#} 为注释行).或者通过 \textbf{\texttt{sphinx-quickstart}} 初始化一些值.
自定义的配置一般不会由 \textbf{\texttt{sphinx-quickstart}} 自动产生,需要自己添加标记.
记住此文件使用Python 的操作符及字符串、数字、列表等.这个文件默认保存为UTF-8编码, 首行需要添加编码声明.
插入非ASCII字符, 则需要使用Python Unicode 字符串 (如 \code{project = u'Exposé'} ).

\raisebox{-0.5\height}{\includegraphics{{more}.png}} 详情查看  {\hyperref[config:build\string-config]{\crossref{\DUrole{std,std-ref}{The build configuration file}}}} .


\section{自动文档}
\label{tutorial:id8}
Python 源代码的文档字符串一般放置了许多的说明信息.  Sphinx 支持自动摄取这些说明信息,
使用 ``autodoc''的扩展  \emph{extension} (标准的Python模块扩展,为Sphinx提供的附加功能).

使用autodoc, 需在配置里激活，在  \code{conf.py} 放入字符串 \code{'sphinx.ext.autodoc'}
位置在 {\color{red}\bfseries{}:confval:{}`extensions{}`} 配置值列表.  现在已配置了一些附加指令.

如,文档化函数 \code{io.open()} ,读取源码的标示及文档字符串,这样写:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autofunction}\PYG{p}{::} io.open
\end{Verbatim}

也可以读取整个类或模块, 使用选项

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{automodule}\PYG{p}{::} io
   \PYG{n+nc}{:members:}
\end{Verbatim}

autodoc 需要导入到你的模块以便索取文档字符串.
因此,在  \code{conf.py} 需要为  \code{sys.path} 添加合适的路径.

\raisebox{-0.5\height}{\includegraphics{{more}.png}}  详情请参考 {\hyperref[ext/autodoc:module\string-sphinx.ext.autodoc]{\crossref{\code{sphinx.ext.autodoc}}}} .


\section{其他话题}
\label{tutorial:id11}\begin{itemize}
\item {} 
其他扩展 (math, intersphinx, viewcode, doctest)

\item {} 
静态文件

\item {} 
选择主题

\item {} 
模板

\item {} 
使用扩展

\item {} 
写扩展

\end{itemize}
\paragraph{尾注}


\chapter{调用 sphinx-build}
\label{invocation:sphinx-build}\label{invocation:invocation}\label{invocation::doc}
脚本 \textbf{\texttt{sphinx-build}} 用来建立Sphinx文档集.
调用方式:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sphinx\PYGZhy{}build [options] sourcedir builddir [filenames]
\end{Verbatim}

\emph{sourcedir} 是源文件目录  {\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}} , \emph{builddir} 是生成文件目录.一般不需要写 \emph{filenames} .

脚本 \textbf{\texttt{sphinx-build}} 的选项:
\index{sphinx-build 命令行选项!-b 生成器名字}\index{-b 生成器名字!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-b}\pysigline{\bfcode{-b}\code{~生成器名字}}
生成器,决定了生成文档的类型,是最重要的选项.  通用的生成器有:
\begin{description}
\item[{\textbf{html}}] \leavevmode
生成HTML文档.  默认的生成器.

\item[{\textbf{dirhtml}}] \leavevmode
生成HTML文档，但是每个文档都有单一的目录，在用浏览器访问时有漂亮的URLs (没有后缀 \code{.html} ) .

\item[{\textbf{singlehtml}}] \leavevmode
所有内容生成单一的 HTML .

\item[{\textbf{htmlhelp}, \textbf{qthelp}, \textbf{devhelp}, \textbf{epub}}] \leavevmode
生成HTML文档，建立文档集时包含这些类型之一的额外信息.

\item[{\textbf{latex}}] \leavevmode
生成 LaTeX 源，可使用 \textbf{\texttt{pdflatex}} 将其编译成 PDF 文档.

\item[{\textbf{man}}] \leavevmode
生成UNIX系统的groff格式手册.

\item[{\textbf{texinfo}}] \leavevmode
生成 Texinfo 文件，可以使用 \textbf{\texttt{makeinfo}} 产生Info 文件.

\item[{\textbf{text}}] \leavevmode
生成纯文本文件.

\item[{\textbf{gettext}}] \leavevmode
生成 gettext-style 分类信息  ( \code{.pot} 文件).

\item[{\textbf{doctest}}] \leavevmode
运行文档集内所有测试，如果 {\hyperref[ext/doctest:module\string-sphinx.ext.doctest]{\crossref{\code{doctest}}}} 扩展可用.

\item[{\textbf{linkcheck}}] \leavevmode
检查所有外部链接的可信度.

\end{description}

查看 {\hyperref[builders:builders]{\crossref{\DUrole{std,std-ref}{Available builders}}}} ，列出了Sphinx支持的所有生成器及
其可添加的扩展.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-a}\index{-a!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-a}\pysigline{\bfcode{-a}\code{}}
给出时重写全部文档，默认则仅重新生成有新的源文件或源文件被修改的文档.(不适用于所有生成器.)

\end{fulllineitems}

\index{sphinx-build 命令行选项!-E}\index{-E!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-E}\pysigline{\bfcode{-E}\code{}}
不使用保存的 {\hyperref[glossary:term\string-environment]{\termref{\DUrole{xref,std,std-term}{environment}}}} (环境，缓存了所有的参考索引), 而是完全重建.
默认仅读取和解析最近新添加及改动的源文件.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-t tag}\index{-t tag!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-t}\pysigline{\bfcode{-t}\code{~tag}}
定义标签 \emph{tag}.  与 {\hyperref[markup/misc:directive\string-only]{\crossref{\code{only}}}} 指令相关，标签是一个目录集合，仅处理标签目录中的内容.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{sphinx-build 命令行选项!-d 路径}\index{-d 路径!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-d}\pysigline{\bfcode{-d}\code{~路径}}
目前Sphinx生成输出前会读取和解析所有的源文件,
解析过的源文件被缓存成 ``doctree pickles''.
通常，这些文件被放在生成目录的 \code{.doctrees} 文件夹中;
这个选项可以选择不同的缓存目录( doctrees 可以被所有的生存器共享).

\end{fulllineitems}

\index{sphinx-build 命令行选项!-c 路径}\index{-c 路径!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-c}\pysigline{\bfcode{-c}\code{~路径}}
不使用源目录下的 \code{conf.py} 而是使用指定的配置文件.
注意在配置文件中提及的路径都是相对配置文件所在目录的相对路径,因此路径必须一致.

\DUrole{versionmodified}{0.3 新版功能.}

\end{fulllineitems}

\index{sphinx-build 命令行选项!-C}\index{-C!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-C}\pysigline{\bfcode{-C}\code{}}
不查找配置文件，仅使用选项 \code{-D} 的配置.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\index{sphinx-build 命令行选项!-D setting=value}\index{-D setting=value!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-D}\pysigline{\bfcode{-D}\code{~setting=value}}
覆盖 \code{conf.py} 里的配置值.  value 是一个字符串或字典.
例如: \code{-D latex\_elements.docclass=scrartcl}.
布尔值使用 \code{0} 或 \code{1} 代替.

\DUrole{versionmodified}{在 0.6 版更改: }值可以为一个字典.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-A name=value}\index{-A name=value!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-A}\pysigline{\bfcode{-A}\code{~name=value}}
模板里的 \emph{name} 变量使用 \emph{value} 值代替.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\index{sphinx-build 命令行选项!-n}\index{-n!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-n}\pysigline{\bfcode{-n}\code{}}
采用 nit-picky 模式.  该模式下所有错误都会产生警告信息.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-N}\index{-N!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-N}\pysigline{\bfcode{-N}\code{}}
不产生彩色输出.  (在 Windows, 彩色输出一直是不可用的.)

\end{fulllineitems}

\index{sphinx-build 命令行选项!-q}\index{-q!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-q}\pysigline{\bfcode{-q}\code{}}
不产生标准输出，仅使用标准错误输出输出警告和错误信息.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-Q}\index{-Q!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-Q}\pysigline{\bfcode{-Q}\code{}}
不产生标准输出，也不产生警告信息，仅使用标准错误输出输出错误信息.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-w file}\index{-w file!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-w}\pysigline{\bfcode{-w}\code{~file}}
除标准错误输出外，将警告（错误）输出到指定文件.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-W}\index{-W!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-W}\pysigline{\bfcode{-W}\code{}}
将警告视为错误.产生第一个警告就停止文档生成活动， \code{sphinx-build} 在状态1 退出.

\end{fulllineitems}

\index{sphinx-build 命令行选项!-P}\index{-P!sphinx-build 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-build-P}\pysigline{\bfcode{-P}\code{}}
发生未绑定的异常时运行Python 调试器 \code{pdb}.(仅在调试时使用.)

\end{fulllineitems}


源目录与目标目录后面，可以给出一个到多个文件名.  Sphinx会尝试仅生成这些文件(及其依赖文件).


\section{Makefile 选项}
\label{invocation:makefile}
文件 \code{Makefile} 及 \code{make.bat} 由
\textbf{\texttt{sphinx-quickstart}} 创建，脚本 \textbf{\texttt{sphinx-build}} 仅使用选项
{\hyperref[invocation:cmdoption\string-sphinx\string-build\string-b]{\crossref{\code{-b}}}} 和 {\hyperref[invocation:cmdoption\string-sphinx\string-build\string-d]{\crossref{\code{-d}}}} .它们则支持以下自定义行为的变量:


\begin{fulllineitems}
\pysigline{\bfcode{PAPER}}
{\color{red}\bfseries{}:confval:{}`latex\_paper\_size{}`} 的值.

\end{fulllineitems}



\begin{fulllineitems}
\pysigline{\bfcode{SPHINXBUILD}}
命令 \code{sphinx-build} 替代值.

\end{fulllineitems}



\begin{fulllineitems}
\pysigline{\bfcode{BUILDDIR}}
替代运行 \textbf{\texttt{sphinx-quickstart}} 选择的目标目录.

\end{fulllineitems}



\begin{fulllineitems}
\pysigline{\bfcode{SPHINXOPTS}}
\textbf{\texttt{sphinx-build}} 的额外选项.

\end{fulllineitems}



\chapter{调用 sphinx-apidoc}
\label{invocation:invocation-apidoc}\label{invocation:sphinx-apidoc}
程序 \textbf{\texttt{sphinx-apidoc}} 将Python页面自动生成API文档.调用方式:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sphinx\PYGZhy{}apidoc [options] \PYGZhy{}o outputdir packagedir [pathnames]
\end{Verbatim}

这里 \emph{packagedir} 是生成文档的页面的根目录， \emph{outputdir} 则是生成源文件的输出目录.
\emph{pathnames} 给出的路径在生成时不会被忽略.

脚本 \textbf{\texttt{sphinx-apidoc}} 也有一些选项:
\index{sphinx-apidoc 命令行选项!-o outputdir}\index{-o outputdir!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-o}\pysigline{\bfcode{-o}\code{~outputdir}}
给出文档页的根目录.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-f, --force}\index{-f, --force!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-f}\pysigline{\bfcode{-f}\code{}\code{,~}\bfcode{-{-}force}\code{}}
通常sphinx-apidoc 不会重写任何文件.  使用该项强制重写所有文件.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-n, --dry-run}\index{-n, --dry-run!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-n}\pysigline{\bfcode{-n}\code{}\code{,~}\bfcode{-{-}dry-run}\code{}}
采用该选项，将不会产生任何文件.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-s suffix}\index{-s suffix!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-s}\pysigline{\bfcode{-s}\code{~suffix}}
生成文件的后缀名，默认为 \code{rst}.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-d maxdepth}\index{-d maxdepth!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-d}\pysigline{\bfcode{-d}\code{~maxdepth}}
目录的最大层次.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-T, --no-toc}\index{-T, --no-toc!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-T}\pysigline{\bfcode{-T}\code{}\code{,~}\bfcode{-{-}no-toc}\code{}}
避免生成文件 \code{modules.rst}.
当有选项 {\hyperref[invocation:cmdoption\string-sphinx\string-apidoc\string-\string-full]{\crossref{\code{-{-}full}}}} 时不起作用.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-F, --full}\index{-F, --full!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-F}\pysigline{\bfcode{-F}\code{}\code{,~}\bfcode{-{-}full}\code{}}
创建整个 Sphinx 项目, 与 \textbf{\texttt{sphinx-quickstart}} 使用一样的机制.
大多数配置值被设置为默认，可通过下面选项去修改.

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-H project}\index{-H project!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-H}\pysigline{\bfcode{-H}\code{~project}}
设置项目名 (查看 {\color{red}\bfseries{}:confval:{}`project{}`}).

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-A author}\index{-A author!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-A}\pysigline{\bfcode{-A}\code{~author}}
设置作者名 (查看 {\color{red}\bfseries{}:confval:{}`copyright{}`}).

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-V version}\index{-V version!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-V}\pysigline{\bfcode{-V}\code{~version}}
设置文档版本 (查看 {\color{red}\bfseries{}:confval:{}`version{}`}).

\end{fulllineitems}

\index{sphinx-apidoc 命令行选项!-R release}\index{-R release!sphinx-apidoc 命令行选项}

\begin{fulllineitems}
\phantomsection\label{invocation:cmdoption-sphinx-apidoc-R}\pysigline{\bfcode{-R}\code{~release}}
设置文档的发布版本 (查看 {\color{red}\bfseries{}:confval:{}`release{}`}).

\end{fulllineitems}



\chapter{reStructuredText 简介}
\label{rest:restructuredtext}\label{rest:rst-primer}\label{rest::doc}
本章节介绍 reStructuredText (reST) 的概念和语法，为文档生成者提供足够的信息.
reST 被认为是简单，实用的标记语言，因此学习它不会花太多时间.


\strong{参见:}


读物 \href{http://docutils.sourceforge.net/rst.html}{reStructuredText User Documentation}.  文档内 ``ref'' 链接指向reST的分类参考文献.




\section{段落}
\label{rest:id1}
段落 ({\color{red}\bfseries{}:duref:{}`ref \textless{}paragraphs\textgreater{}{}`}) 是reST 文件的基本模块.
段落是由空行分隔的一段文本.  和Python一样, 对齐也是reST的操作符, 因此同一段落的行都是左对齐的.


\section{内联标记}
\label{rest:inlinemarkup}\label{rest:id4}
标准的reST 内联标记相当简单:
\begin{itemize}
\item {} 
星号: \code{*text*} 是强调 (斜体),

\item {} 
双星号: \code{**text**} 重点强调 (加粗),

\item {} 
反引号: \code{{}`{}`text{}`{}`} 代码样式.

\end{itemize}

星号及反引号在文本中容易与内联标记符号混淆，可使用反斜杠符号转义.

标记需注意的一些限制:
\begin{itemize}
\item {} 
不能相互嵌套,

\item {} 
内容前后不能由空白: 这样写{}`{}`* text*{}`{}` 是错误的,

\item {} 
如果内容需要特殊字符分隔.  使用反斜杠转义，如: \code{thisis\textbackslash{} *one*\textbackslash{} word}.

\end{itemize}

这些限制在未来版本可能会被改善.

reST 也允许自定义 ``文本解释角色''', 这意味着可以以特定的方式解释文本.
Sphinx以此方式提供语义标记及参考索引，操作符为 \code{:rolename:{}`content{}`}.

标准reST 提供以下规则:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:durole:{}`emphasis{}`} -- 写成 \code{*emphasis*}

\item {} 
{\color{red}\bfseries{}:durole:{}`strong{}`} -- 写成 \code{**strong**}

\item {} 
{\color{red}\bfseries{}:durole:{}`literal{}`} -- 写成 \code{{}`{}`literal{}`{}`}

\item {} 
{\color{red}\bfseries{}:durole:{}`subscript{}`} -- 下标

\item {} 
{\color{red}\bfseries{}:durole:{}`superscript{}`} -- 上标

\item {} 
{\color{red}\bfseries{}:durole:{}`title-reference{}`} -- 书、期刊等材料的标题

\end{itemize}

详情请查看 {\hyperref[markup/inline:inline\string-markup]{\crossref{\DUrole{std,std-ref}{内联标记}}}} .


\section{列表与引用}
\label{rest:id17}
列表标记 ({\color{red}\bfseries{}:duref:{}`ref \textless{}bullet-lists\textgreater{}{}`}) 的使用最自然: 仅在段落的开头放置一个星号和一个缩进.
编号的列表也可以;也可以使用符号 \code{\#} 自动加序号:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{l+m}{*} 这是一个项目符号列表.
\PYG{l+m}{*} 它有两项，
  第二项使用两行.

\PYG{l+m}{1.} 这是个有序列表.
\PYG{l+m}{2.} 也有两项.

\PYG{l+m}{\PYGZsh{}.} 是个有序列表.
\PYG{l+m}{\PYGZsh{}.} 也有两项.
\end{Verbatim}

列表可以嵌套，但是需跟父列表使用空行分隔

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{l+m}{*} 这是
\PYG{l+m}{*} 一个列表

  \PYG{l+m}{*} 嵌套列表
  \PYG{l+m}{*} 子项

\PYG{l+m}{*} 父列表继续
\end{Verbatim}

定义列表 ({\color{red}\bfseries{}:duref:{}`ref \textless{}definition-lists\textgreater{}{}`})

\begin{Verbatim}[commandchars=\\\{\}]
术语 (term 文本开头行)
   定义术语，必须缩进

   可以有多段组成

下一术语（term）
   描述.
\end{Verbatim}

一行仅能写一个术语.

引用段落 ({\color{red}\bfseries{}:duref:{}`ref \textless{}block-quotes\textgreater{}{}`}) 仅使用缩进（相对于周围段落）创建.

行模块 ({\color{red}\bfseries{}:duref:{}`ref \textless{}line-blocks\textgreater{}{}`}) 可以这样分隔

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{o}{\textbar{}} 这些行
\PYG{o}{\textbar{}} 在源文件里
\PYG{o}{\textbar{}} 被分隔的一模一样.
\end{Verbatim}

还有其他有用的模块:
\begin{itemize}
\item {} 
字段列表 ({\color{red}\bfseries{}:duref:{}`ref \textless{}field-lists\textgreater{}{}`})

\item {} 
选项列表({\color{red}\bfseries{}:duref:{}`ref \textless{}option-lists\textgreater{}{}`})

\item {} 
字面引用模块 ({\color{red}\bfseries{}:duref:{}`ref \textless{}quoted-literal-blocks\textgreater{}{}`})

\item {} 
文档测试模块 ({\color{red}\bfseries{}:duref:{}`ref \textless{}doctest-blocks\textgreater{}{}`})

\end{itemize}


\section{源代码}
\label{rest:id34}
字面代码块 ({\color{red}\bfseries{}:duref:{}`ref \textless{}literal-blocks\textgreater{}{}`}) 在段落的后面使用标记 \code{::} 引出.
代码块必须缩进(同段落，需要与周围文本以空行分隔):

\begin{Verbatim}[commandchars=\\\{\}]
这是一段正常文本. 下一段是代码文字\PYG{l+s+se}{::}

\PYG{l+s}{   }\PYG{l+s}{它不需要特别处理，仅是}
\PYG{l+s}{   缩进就可以了.}

\PYG{l+s}{   它可以有多行.}

再是正常的文本段.
\end{Verbatim}

这个 \code{::} 标记很优雅:
\begin{itemize}
\item {} 
如果作为独立段落存在,则整段都不会出现在文档里.

\item {} 
如果前面有空白，则标记被移除.

\item {} 
如果前面是非空白，则标记被一个冒号取代.

\end{itemize}

因此上面的例子第一段文字将变为''下一段是代码文字:''.


\section{表格}
\label{rest:rst-tables}\label{rest:id37}
支持两种表格.  一种是 \emph{网格表格} ({\color{red}\bfseries{}:duref:{}`ref
\textless{}grid-tables\textgreater{}{}`}), 可以自定义表格的边框. 如下:

\begin{Verbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{o}{\textbar{}} Header row, column 1   \textbar{} Header 2   \textbar{} Header 3 \textbar{} Header 4 \textbar{}
\PYG{o}{\textbar{}} (header rows optional) \textbar{}            \textbar{}          \textbar{}          \textbar{}
+========================+============+==========+==========+
\PYG{o}{\textbar{}} body row 1, column 1   \textbar{} column 2   \textbar{} column 3 \textbar{} column 4 \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{o}{\textbar{}} body row 2             \textbar{} ...        \textbar{} ...      \textbar{}          \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\end{Verbatim}

\emph{简单表格} ({\color{red}\bfseries{}:duref:{}`ref \textless{}simple-tables\textgreater{}{}`}) 书写简单, 但有一些限制: 需要有多行，且第一列元素不能分行显示，如下:

\begin{Verbatim}[commandchars=\\\{\}]
=====  =====  =======
A      B      A and B
=====  =====  =======
False  False  False
True   False  False
False  True   False
True   True   True
=====  =====  =======
\end{Verbatim}


\section{超链接}
\label{rest:id42}

\subsection{外部链接}
\label{rest:id43}
使用 \code{{}`链接文本 \textless{}http://example.com/\textgreater{}{}`\_} 可以插入网页链接.
链接文本是网址，则不需要特别标记，分析器会自动发现文本里的链接或邮件地址.

可以把链接和标签分开 ({\color{red}\bfseries{}:duref:{}`ref
\textless{}hyperlink-targets\textgreater{}{}`}), 如下:

\begin{Verbatim}[commandchars=\\\{\}]
段落里包含 \PYG{l+s}{{}`a link{}`\PYGZus{}}.

\PYG{p}{..} \PYG{n+nt}{\PYGZus{}a link:} http://example.com/
\end{Verbatim}


\subsection{内部链接}
\label{rest:id46}
内部链接是Sphinx特定的reST角色, 查看章节 {\hyperref[markup/inline:ref\string-role]{\crossref{\DUrole{std,std-ref}{交叉索引的位置}}}}.


\section{章节}
\label{rest:id47}
章节的标题 ({\color{red}\bfseries{}:duref:{}`ref \textless{}sections\textgreater{}{}`}) 在双上划线符号之间（或为下划线）, 并且符号的长度不能小于文本的长度:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+gh}{=================}
\PYG{g+gh}{This is a heading}
\PYG{g+gh}{=================}
\end{Verbatim}

通常没有专门的符号表示标题的等级，但是对于Python 文档，可以这样认为:
\begin{itemize}
\item {} 
\code{\#} 及上划线表示部分

\item {} 
\code{*} 及上划线表示章节

\item {} 
\code{=}, 小章节

\item {} 
\code{-}, 子章节

\item {} 
\code{\textasciicircum{}}, 子章节的子章节

\item {} 
\code{"}, 段落

\end{itemize}

当然也可以标记（查看 reST 文档), 定义章节的层次，但是需要注意输出格式(HTML, LaTeX)所支持的层次深度 .


\section{显式标记}
\label{rest:id50}
显式标记''Explicit markup'' ({\color{red}\bfseries{}:duref:{}`ref \textless{}explicit-markup-blocks\textgreater{}{}`}) 用在那些需做特殊处理的reST结构中,
如尾注，突出段落，评论，通用指令.

显式标记以 \code{..} 开始，后跟空白符，与下面段落的缩进一样.
(在显示标记与正常的段落间需有空行，这听起来有些复杂，但是写起来会非常直观.)


\section{指令}
\label{rest:directives}\label{rest:id53}
指令 ({\color{red}\bfseries{}:duref:{}`ref \textless{}directives\textgreater{}{}`}) 是显式标记最常用的模块.
也是reST 的扩展规则, 在 Sphinx 经常被用到.

文档工具支持以下指令:
\begin{itemize}
\item {} 
警告: {\color{red}\bfseries{}:dudir:{}`attention{}`}, {\color{red}\bfseries{}:dudir:{}`caution{}`}, {\color{red}\bfseries{}:dudir:{}`danger{}`},
{\color{red}\bfseries{}:dudir:{}`error{}`}, {\color{red}\bfseries{}:dudir:{}`hint{}`}, {\color{red}\bfseries{}:dudir:{}`important{}`}, {\color{red}\bfseries{}:dudir:{}`note{}`},
{\color{red}\bfseries{}:dudir:{}`tip{}`}, {\color{red}\bfseries{}:dudir:{}`warning{}`} 及通用标记 {\color{red}\bfseries{}:dudir:{}`admonition{}`}.
(大多数模式仅支持 ``note'' 及 ``warning'' )

\item {} 
图像:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`image{}`} (详情可看下面的 {\hyperref[rest:id129]{\crossref{图像}}} )

\item {} 
{\color{red}\bfseries{}:dudir:{}`figure{}`} (有标题及可选说明的图像)

\end{itemize}

\item {} 
额外的主体元素:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`contents \textless{}table-of-contents\textgreater{}{}`} (本地，仅是当前文件的内容表格)

\item {} 
{\color{red}\bfseries{}:dudir:{}`container{}`} (自定义容器，用来生成HTML的 \code{\textless{}div\textgreater{}} )

\item {} 
{\color{red}\bfseries{}:dudir:{}`rubric{}`} (和文档章节无关的标题)

\item {} 
{\color{red}\bfseries{}:dudir:{}`topic{}`}, {\color{red}\bfseries{}:dudir:{}`sidebar{}`} (高亮显示的主体元素)

\item {} 
{\color{red}\bfseries{}:dudir:{}`parsed-literal{}`} (支持内联标记的斜体模块)

\item {} 
{\color{red}\bfseries{}:dudir:{}`epigraph{}`} (可选属性行的摘要模块)

\item {} 
{\color{red}\bfseries{}:dudir:{}`highlights{}`}, {\color{red}\bfseries{}:dudir:{}`pull-quote{}`} (有自己的类属性的摘要模块)

\item {} 
{\color{red}\bfseries{}:dudir:{}`compound{}`} ( 复合段落)

\end{itemize}

\item {} 
专用表格:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`table{}`} (有标题的表格)

\item {} 
{\color{red}\bfseries{}:dudir:{}`csv-table{}`} (CSV自动生成表格)

\item {} 
{\color{red}\bfseries{}:dudir:{}`list-table{}`} (列表生成的表格)

\end{itemize}

\item {} 
专用指令:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`raw{}`} (包含原始格式的标记)

\item {} 
{\color{red}\bfseries{}:dudir:{}`include{}`} (包含reStructuredText标记的文件)
-- 在Sphinx中,如果包含绝对文件路径，指令会以源目录地址做为参照

\item {} 
{\color{red}\bfseries{}:dudir:{}`class{}`} (将类属性指派给下一个元素) \footnote[1]{\sphinxAtStartFootnote%
当默认主域里包含指令 \code{class} , 这个指令将被隐藏
因此, Sphinx使用 \code{rst-class}.
}

\end{itemize}

\item {} 
HTML 特性:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`meta{}`} (生成HTML \code{\textless{}meta\textgreater{}} 标签)

\item {} 
{\color{red}\bfseries{}:dudir:{}`title{}`} (覆盖文档标题)

\end{itemize}

\item {} 
影响标记:
\begin{itemize}
\item {} 
{\color{red}\bfseries{}:dudir:{}`default-role{}`} (设置新的默认角色)

\item {} 
{\color{red}\bfseries{}:dudir:{}`role{}`} (创建新的角色)

\end{itemize}

如果仅有一个文件，最好使用 {\color{red}\bfseries{}:confval:{}`default\_role{}`}.

\end{itemize}

设置不使用指令 {\color{red}\bfseries{}:dudir:{}`sectnum{}`}, {\color{red}\bfseries{}:dudir:{}`header{}`} 及
{\color{red}\bfseries{}:dudir:{}`footer{}`}.

Sphinx 新增指令可查阅 {\hyperref[markup/index:sphinxmarkup]{\crossref{\DUrole{std,std-ref}{Sphinx标记的组成}}}}.

指令有名字，参数，选项及内容组成. (记住这些，在下面一小节中自定义指令里会用到).来看一个例子:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{function}\PYG{p}{::} foo(x)
              foo(y, z)
   \PYG{n+nc}{:module:} \PYG{n+nf}{some.module.name}

   返回用户输入的一行文本.
\end{Verbatim}

\code{function} 是指令名字.  在第一行和第二行给出了两个参数, 及一个选项 \code{module} (如你所见，选项在参数后给出，由冒号引出).
选项必须与指令有一样的缩进.

指令的内容在隔开一个空行后，与指令有一样缩进.


\section{图像}
\label{rest:id129}
reST 支持图像指令 ({\color{red}\bfseries{}:dudir:{}`ref \textless{}image\textgreater{}{}`}), 如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{image}\PYG{p}{::} gnu.png
   (选项)
\end{Verbatim}

这里给出的文件名( \code{gnu.png}) 必须是源文件的相对路径，如果是绝对路径则以源目录为根目录.
例如，在文件 \code{sketch/spam.rst} 引用图像 \code{images/spam.png} ，则使用 \code{../images/spam.png} 或者
\code{/images/spam.png}.

Sphinx 会自动将图像文件拷贝到输出目录的子目录里，( 输出HTML时目录为 \code{\_static} )

图像的大小选项 (\code{width} 及 \code{height}) :
如果没有单位或单位为像素, 给定的尺寸信息仅在输出通道支持像素时才有用 ( 如输出LaTeX 没用).
其他单位在输出(如 \code{pt} )HTML、LaTeX 时被用到.

Sphinx 延伸了标准的文档化行为，只需在后面加星号:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{image}\PYG{p}{::} gnu.*
\end{Verbatim}

上面这样写，Sphinx 会搜索所有名字匹配的图像，而不管图像类型.
每个生成器则会选择最合适的图像.
一般，在源文件目录里文件名 \code{gnu.*} 会含有两个文件 \code{gnu.pdf}
和 \code{gnu.png} , LaTeX 生成器会选择前者，而HTML 生成器则匹配后者.

\DUrole{versionmodified}{在 0.4 版更改: }添加对文件名以星号结束的支持.

\DUrole{versionmodified}{在 0.6 版更改: }图像路径可以是绝对路径.


\section{尾注}
\label{rest:id132}
尾注 ({\color{red}\bfseries{}:duref:{}`ref \textless{}footnotes\textgreater{}{}`}), 使用 \code{{[}\#name{]}\_} 标记尾注的位置,
尾注的内容则在文档底部红色标题''Footnotes''的后面 , 如下:

\begin{Verbatim}[commandchars=\\\{\}]
Lorem ipsum \PYG{l+s}{[\PYGZsh{}f1]\PYGZus{}} dolor sit amet ... \PYG{l+s}{[\PYGZsh{}f2]\PYGZus{}}

\PYG{p}{..} \PYG{o+ow}{rubric}\PYG{p}{::} Footnotes

\PYG{p}{..} \PYG{n+nt}{[\PYGZsh{}f1]} 第一条尾注的文本.
\PYG{p}{..} \PYG{n+nt}{[\PYGZsh{}f2]} 第二条尾注的文本.
\end{Verbatim}

你也可以使用数字尾注 (\code{{[}1{]}\_}) 或使用自动排序的(\code{{[}\#{]}\_}).


\section{引用}
\label{rest:id135}
支持标准的reST 引用 ({\color{red}\bfseries{}:duref:{}`ref \textless{}citations\textgreater{}{}`}) , 且新增了''global''特性,
所有参考文献不受所在文件的限制.  如:

\begin{Verbatim}[commandchars=\\\{\}]
Lorem ipsum \PYG{l+s}{[Ref]\PYGZus{}} dolor sit amet.

\PYG{p}{..} \PYG{n+nt}{[Ref]} 参考文献, 书,URL 等.
\end{Verbatim}

引用的使用同尾注很相近，但是它们没有数字标签或以 \code{\#} 开始.


\section{替换}
\label{rest:id138}
reST 支持替换 ``substitutions'' ({\color{red}\bfseries{}:duref:{}`ref \textless{}substitution-definitions\textgreater{}{}`}), 有一小段文本或标记被关联到 \code{\textbar{}name\textbar{}}.
定义与尾注一样需有明确的标记块，如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{n+nt}{\textbar{}name\textbar{}} \PYG{o+ow}{replace}\PYG{p}{::} replacement \PYG{g+ge}{*text*}
\end{Verbatim}

或者:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{n+nt}{\textbar{}caution\textbar{}} \PYG{o+ow}{image}\PYG{p}{::} warning.png
             \PYG{n+nc}{:alt:} \PYG{n+nf}{Warning!}
\end{Verbatim}

详情查看 {\color{red}\bfseries{}:duref:{}`reST reference for substitutions \textless{}substitution-definitions\textgreater{}{}`} .

如果想在所有文档中使用这些替换, 需把它们放在 {\color{red}\bfseries{}:confval:{}`rst\_prolog{}`} 或一个单独文件里，
然后在使用它们的文档文件里包含这个文件，包含指令 \code{include} .
(请给出包含文件的扩展名，已区别于其他的源文件，避免Sphinx将其作为独立的文档文件.)

Sphinx 定义了一些默认的替换, 请查看 {\hyperref[markup/inline:default\string-substitutions]{\crossref{\DUrole{std,std-ref}{替换}}}}.


\section{评论}
\label{rest:id145}
有明确标记块但又不是有效的结构标记的标记 (像上面的尾注）都被视为评论 ({\color{red}\bfseries{}:duref:{}`ref \textless{}comments\textgreater{}{}`}).  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{.. 这是一个评论.}
\end{Verbatim}

可以通过缩进产生多行评论:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{..}
\PYG{c+cp}{   这整个缩进块都是}
\PYG{c+cp}{   一个评论.}

\PYG{c+cp}{   仍是一个评论.}
\end{Verbatim}


\section{源编码}
\label{rest:id148}
在reST使用Unicode字符可以容易的包含特殊字符如破折号，版权标志.
Sphinx 默认源文件使用UTF-8 编码; 你可以通过 {\color{red}\bfseries{}:confval:{}`source\_encoding{}`} 的配置值改变编码.


\section{常见问题}
\label{rest:id151}
具体使用中可能会遇到一些问题:
\begin{itemize}
\item {} 
\textbf{内联标记的分离} 如上面所讲，内联标记需与周围的文本使用空格分隔, 内联标记内部则使用反斜线转义空格.  查看详情: \href{http://docutils.sf.net/docs/ref/rst/restructuredtext.html\#inline-markup}{the reference} .

\item {} 
\textbf{内联标记不能嵌套}  像这样写 \code{*see :func:{}`foo{}`*} 是不允许的.

\end{itemize}


\chapter{Sphinx标记的组成}
\label{markup/index:sphinx}\label{markup/index:sphinxmarkup}\label{markup/index::doc}
Sphinx 在 \href{http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html}{standard reST
markup} 基础上新增了许多指令和文本解释角色.  本章节是这些特性的参考资料.


\section{目录树}
\label{markup/toctree:id1}\label{markup/toctree:toctree-directive}\label{markup/toctree::doc}
\index{table of!contents}\index{contents!table of}
目前 reST 还没有专门的语法表示文件的相互关联或怎样将一份文档拆分成多个输出文件，
Sphinx 使用自定义的指令在独立文件里添加这种关系或目录表格.
指令 \code{toctree} 是其核心元素.

\begin{notice}{note}{注解:}
简单的在一个文件里包含另一个文件也可以完成包含指令 {\color{red}\bfseries{}:dudir:{}`include{}`} .
\end{notice}
\index{toctree (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/toctree:directive-toctree}\pysigline{\bfcode{..~toctree::}}
该指令在当前位置插入一个目录树 ``TOC tree'' ,在文档中使用独立的 TOCs (包括 ``sub-TOC trees'')给出指令的主体.
相对文件名 (不以缩写开头) 是指令所在的文件的相对路径，绝对文件名则以源目录为根目录.
数值 \code{maxdepth} 选项指定目录的层次，默认包含所有的层次. \footnote[1]{\sphinxAtStartFootnote%
选项 \code{maxdepth} 不适用于 LaTeX , 其在文档开始部分就会出现包含所有文件的目录表,
它的深度使用 \code{tocdepth} 计数器控制, 可以使用 {\color{red}\bfseries{}:confval:{}`latex\_preamble{}`} 重新配置，例如 \code{\textbackslash{}setcounter\{tocdepth\}\{2\}}.
}

下面是一个例子 (以Python文档库作为参考):

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:maxdepth:} \PYG{n+nf}{2}

   intro
   strings
   datatypes
   numeric
   (更多的文档列在下面)
\end{Verbatim}

它实现了两种功能:
\begin{itemize}
\item {} 
插入所有文档的目录表格，深度为2表示文档必须有一个标题.
这些文档内的指令 \code{toctree} 也会被插入.

\item {} 
Sphinx 确定了 \code{intro}, \code{strings} 这几个字符串在文档中的相对顺序，并知道它们是本文档的子页面，是文档库的索引.
根据这些信息可产生 ``下一个主题'', ``上一个主题'' 及 ``父页面'' 的链接.

\end{itemize}

\textbf{条目}

目录树里的标题是由 {\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}} 指令自动罗列其包含文档的标题. 如果不合适，
可以使用与reST超链接相似的标签符号自定义一个标题，(或使用Sphinx的 {\hyperref[markup/inline:xref\string-syntax]{\crossref{\DUrole{std,std-ref}{cross-referencing syntax}}}}).
如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}

   intro
   All about strings \PYGZlt{}strings\PYGZgt{}
   datatypes
\end{Verbatim}

上面的第二行中 \code{strings} 是文档名, 但是在目录树里会使用 ``All about strings'' 作为标题名.

也可以添加外部链接，只要使用HTTP URL 代替文档名就可以了.

\textbf{章节编号}

如果希望在HTML为章节编号，仅需给出选项 \code{numbered} .  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:numbered:}

   foo
   bar
\end{Verbatim}

编号以标题 \code{foo} 开始.子目录也会自动编号 (不需在给出 \code{numbered} 选项).

也可以定义编号的深度, 需在 \code{numbered} 后给出深度的参数.

\textbf{其他选项}

如果希望目录里仅出现文档的标题，不出现文中其他同等级的标题行（同一缩进）, 可以使用选项 \code{titlesonly}

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:titlesonly:}

   foo
   bar
\end{Verbatim}

使用匹配指令 ``globbing'' , 只需给出 \code{glob} 选项.  可用文档列表里的所有条目都会被匹配，
并且按照字母顺序插入 .  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:glob:}

   intro*
   recipe/*
   *
\end{Verbatim}

以上会包含所有以 \code{intro} 开头的文档及 \code{recipe} 目录下的所有文件,第三行匹配所有剩下的文件 (除了包含该目录树指令的文件,即当前文件.) \footnote[2]{\sphinxAtStartFootnote%
所有可以使用的匹配符号: 标准 shell 表达式如 \code{*}, \code{?}, \code{{[}...{]}} 及 \code{{[}!...{]}} ，但其不匹配斜杠.
使用双星号 \code{**} 可以匹配任何包含斜杠的字符串.
}

特殊名字 \code{self} 可以代替当前文件.  这在从目录树生成导航地图（ ``sitemap'' ）时非常有用.

还可以给出 ``hidden'' 选项, 如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{toctree}\PYG{p}{::}
   \PYG{n+nc}{:hidden:}

   doc\PYGZus{}1
   doc\PYGZus{}2
\end{Verbatim}

文件仍会存在于Sphinx 的文档结构中，但是不会在当前指令位置插入目录 -- 其后可以按照特定的方式插入该文件的链接，比如在HTML边框栏里.

最后, 在 {\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}} (包括子目录)里的所有文件都需出现在某个 \code{toctree} 指令里;
否则Sphinx会报出警告, 因为该文件没有通过标准导航.
可以使用 {\color{red}\bfseries{}:confval:{}`unused\_docs{}`} 排除某些文件，使用 {\color{red}\bfseries{}:confval:{}`exclude\_trees{}`} 排除整个目录.

主文档（ ``master document'' ）(由 {\color{red}\bfseries{}:confval:{}`master\_doc{}`} 指定) 是整个目录结构的根.
可以作为文档的主页面, 如果不给出 \code{maxdepth} 选项，则会是''填满目录内容的表格''.

\DUrole{versionmodified}{在 0.3 版更改: }增加 ``globbing'' 选项.

\DUrole{versionmodified}{在 0.6 版更改: }增加 ``numbered'' 及 ``hidden'' 选项，及外部链接，支持''self'' 关键字.

\DUrole{versionmodified}{在 1.0 版更改: }增加 ``titlesonly'' 选项.

\DUrole{versionmodified}{在 1.1 版更改: }增加''numbered''选项的数值参数 .

\end{fulllineitems}



\subsection{预留名子}
\label{markup/toctree:id12}
Sphinx 有些保留的文档名; 试图创建这些名字的文档会产生错误.

这些特殊的文档名 (生成的页面) 有:
\begin{itemize}
\item {} 
\code{genindex}, \code{modindex}, \code{search}

分别对应通用索引, Python模块索引, 及搜索页面 .

通用索引封装了模块条目，所有
{\hyperref[domains:basic\string-domain\string-markup]{\crossref{\DUrole{std,std-ref}{object descriptions}}}} 生成的索引, 及 {\hyperref[markup/misc:directive\string-index]{\crossref{\code{index}}}}
指令生成的索引.

Python模块索引包含每个 {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}} 指令生成的索引.

搜索页面包含的表单使用JSON格式的搜索索引，然后JavaScript根据输入的搜索词,
全文搜索整个文档;因此,需要工作在支持现代JavaScript的浏览器中.

\item {} 
名字以 \code{\_} 开头

尽管仅有少数预留的文档名还被使用, 但是最好不要创建同名文档或在文档路径中包含这些名字.
(使用 \code{\_} 前缀定义模板路径是个好方法.)

\end{itemize}


\section{段落级别的标记}
\label{markup/para:id1}\label{markup/para::doc}
\index{note}\index{warning}\index{changes!in version}\index{in version!changes}
这个指令可以创建简单的段落，也可以如普通文本一样使用内部信息单位:
\index{note (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-note}\pysigline{\bfcode{..~note::}\code{~}}
显示用户使用API时的注意事项.  指令的内容应该使用完整的语句及标点符号.

例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{note}\PYG{p}{::}

   该功能不适于发送垃圾邮件.
\end{Verbatim}

\end{fulllineitems}

\index{warning (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-warning}\pysigline{\bfcode{..~warning::}\code{~}}
显示用户使用API时的注意事项.  指令包含完整的句子和标点符号.
不同于 {\hyperref[markup/para:directive\string-note]{\crossref{\code{note}}}} ，它一般显示的是信息安全方面的注意事项.

\end{fulllineitems}

\index{versionadded (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-versionadded}\pysigline{\bfcode{..~versionadded::}\code{~version}}
标示某个版本或C语言的API 新增的特性. 应用在模块条目时，会放置在章节内容的前面.

第一个参数必须给出版本号，可以添加第二个参数组成一个简单的说明.

例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{versionadded}\PYG{p}{::} 2.5
   The \PYG{g+ge}{*spam*} parameter.
\end{Verbatim}

注意在指令头和说明中间不能有空行; 这样会使标记语言认为这个模块不是连续的.

\end{fulllineitems}

\index{versionchanged (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-versionchanged}\pysigline{\bfcode{..~versionchanged::}\code{~version}}
与 {\hyperref[markup/para:directive\string-versionadded]{\crossref{\code{versionadded}}}} 相似, 但它描述的是该功能在版本中的更改(新参数,效果改变等).

\end{fulllineitems}

\index{deprecated (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-deprecated}\pysigline{\bfcode{..~deprecated::}\code{~version}}
与 {\hyperref[markup/para:directive\string-versionchanged]{\crossref{\code{versionchanged}}}} 相似, 描述的是功能的取消.  解释仍可以给出，比如功能的替代方案.  如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{deprecated}\PYG{p}{::} 3.1
   Use \PYG{n+na}{:func:}\PYG{n+nv}{{}`spam{}`} instead.
\end{Verbatim}

\end{fulllineitems}



\bigskip\hrule{}\bigskip

\index{seealso (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-seealso}\pysigline{\bfcode{..~seealso::}}
许多章节包含模块文档或者扩展文档的参考索引列表.这些列表由指令 {\hyperref[markup/para:directive\string-seealso]{\crossref{\code{seealso}}}} 创建.

指令 {\hyperref[markup/para:directive\string-seealso]{\crossref{\code{seealso}}}} 通常放在所有子章节的前面.对于HTML文档, 需与主文本分开.

指令 {\hyperref[markup/para:directive\string-seealso]{\crossref{\code{seealso}}}} 内容是reST的定义列表.
例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{seealso}\PYG{p}{::}

   Module \PYG{n+na}{:py:mod:}\PYG{n+nv}{{}`zipfile{}`}
      标准模块 \PYG{n+na}{:py:mod:}\PYG{n+nv}{{}`zipfile{}`} 的文档.

   \PYG{l+s}{{}`GNU tar manual, Basic Tar Format }\PYG{l+s+si}{\PYGZlt{}http://link\PYGZgt{}}\PYG{l+s}{{}`\PYGZus{}}
      归档文件的文档, 包含 GNU tar 扩展.
\end{Verbatim}

一个简单的形式:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{seealso}\PYG{p}{::} modules \PYG{n+na}{:py:mod:}\PYG{n+nv}{{}`zipfile{}`}, \PYG{n+na}{:py:mod:}\PYG{n+nv}{{}`tarfile{}`}
\end{Verbatim}

\DUrole{versionmodified}{0.5 新版功能: }简单形式.

\end{fulllineitems}

\index{rubric (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-rubric}\pysigline{\bfcode{..~rubric::}\code{~title}}
该指令用来创建文档标题,但是该标题不出现在文档的目录结构中.

\begin{notice}{note}{注解:}
如果标题被''Footnotes''标记出来 (或被其他语言选中), 这个标题在LaTeX会被忽略, 或假定它包含尾注定义,仅创建一个空标题 .
\end{notice}

\end{fulllineitems}

\index{centered (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-centered}\pysigline{\bfcode{..~centered::}}
该指令创建居中加粗文本行.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{centered}\PYG{p}{::} LICENSE AGREEMENT
\end{Verbatim}

\DUrole{versionmodified}{1.1 版后已移除: }该指令仅在旧版本里声明了.  使用 \code{rst-class} 代替并添加适当的样式.

\end{fulllineitems}

\index{hlist (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-hlist}\pysigline{\bfcode{..~hlist::}}
该指令生成水平列表.  它将列表项横向显示并减少项目的间距使其较为紧凑.

生成器需支持水平分布, 这里的 \code{columns} 选项定义显示的列数，默认为2.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{hlist}\PYG{p}{::}
   \PYG{n+nc}{:columns:} \PYG{n+nf}{3}

   \PYG{l+m}{*} 列表
   \PYG{l+m}{*} 的子
   \PYG{l+m}{*} 项会
   \PYG{l+m}{*} 水平
   \PYG{l+m}{*} 排列
\end{Verbatim}

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}



\section{目录表格标记}
\label{markup/para:id2}
指令 {\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}} ，会产生子文档的目录表格, 详见 {\hyperref[markup/toctree:toctree\string-directive]{\crossref{\DUrole{std,std-ref}{目录树}}}}.

本地目录表, 则使用标准 reST {\color{red}\bfseries{}:dudir:{}`contents directive
\textless{}table-of-contents\textgreater{}{}`}.


\section{术语}
\label{markup/para:id5}\index{glossary (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-glossary}\pysigline{\bfcode{..~glossary::}\code{~}}
该指令必然包含一个reST式的定义列表标记，由术语和定义组成.  这些定义其后可被 {\hyperref[markup/inline:role\string-term]{\crossref{\code{term}}}} 引用.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{glossary}\PYG{p}{::}

   environment
      一个结构，包含信息是所有文档的保存路径，使用的参考文献等.
      在解析的阶段使用，因此连续运行时仅需解析新的或修改过的文档.

   source directory
      根路径，包含子目录，包含一个Sphinx工程的所有源文件.
\end{Verbatim}

与标准的定义列表相比, 支持多个术语且这些术语可以有内联标记.  可以链接所有术语.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{glossary}\PYG{p}{::}

   term 1
   term 2
      定义两个术语.
\end{Verbatim}

(术语排序时，通过第一个术语决定顺序.)

\DUrole{versionmodified}{0.6 新版功能: }给出术语指令的 \code{:sorted:} 选项，则术语就会按照字母自动排序.

\DUrole{versionmodified}{在 1.1 版更改: }开始支持多术语和术语的内联标记.

\end{fulllineitems}



\section{语法产品的显示}
\label{markup/para:id6}
特殊标记形成了一套语法展示产品.
这些标记很简单，不会试图模型化BNF的各个方面(及其派生形式), 但是提供了足够显示上下文的语法信息，定义符号将以超链接符形式显示.  指令如下:
\index{productionlist (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/para:directive-productionlist}\pysigline{\bfcode{..~productionlist::}\code{~{[}name{]}}}
该指令后跟一组产品.  每个产品一行，有名字组成，与后面的定义通过冒号分隔.
如果定义有多行，后面的行以冒号开始，且冒号垂直对齐.

{\hyperref[markup/para:directive\string-productionlist]{\crossref{\code{productionlist}}}} 的参数用来区分不同语法产品的列表.

在 \code{productionlist} 指令参数间不允许有空行.

定义可以包含别名，以解释文本给出(例如 \code{sum ::= {}`integer{}` "+" {}`integer{}`}) -- 这会生成产品别名的参照表.
除了产品列表，还可以使用别名访问 {\hyperref[markup/inline:role\string-token]{\crossref{\code{token}}}}.

注意产品内部没有完整的reST解释器, 因此不能避免使用 \code{*} 或 \code{\textbar{}} 字符.

\end{fulllineitems}


下面是Python 参考手册的例子:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{productionlist}\PYG{p}{::}
   try\PYGZus{}stmt: try1\PYGZus{}stmt \textbar{} try2\PYGZus{}stmt
   try1\PYGZus{}stmt: \PYGZdq{}try\PYGZdq{} \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`}
            : (\PYGZdq{}except\PYGZdq{} [\PYG{n+nv}{{}`expression{}`} [\PYGZdq{},\PYGZdq{} \PYG{n+nv}{{}`target{}`}]] \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`})+
            : [\PYGZdq{}else\PYGZdq{} \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`}]
            : [\PYGZdq{}finally\PYGZdq{} \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`}]
   try2\PYGZus{}stmt: \PYGZdq{}try\PYGZdq{} \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`}
            : \PYGZdq{}finally\PYGZdq{} \PYGZdq{}:\PYGZdq{} \PYG{n+nv}{{}`suite{}`}
\end{Verbatim}


\section{展示示例代码}
\label{markup/code:id1}\label{markup/code:code-examples}\label{markup/code::doc}
\index{code!examples}\index{examples!code}\index{sourcecode}
示例的Python源代码或者交互界面都可以使用标准reST模块实现.在正常段落后面跟着 \code{::} 开始，再加上适当缩进.

交互界面需包含提示及Python代码的输出.  交互界面没有特别的标记.  在最后一行输入或输出之后，不应出现空的提示; 这是一个什么都不做的例子:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZgt{}\PYGZgt{}\PYGZgt{} 1 + 1
2
\PYGZgt{}\PYGZgt{}\PYGZgt{}
\end{Verbatim}

语法高亮显示由 \href{http://pygments.org}{Pygments} (如果安装) 优雅的显示:
\begin{itemize}
\item {} 
每个源文件都有高亮语言''highlighting language''.  默认是
\code{'python'} ，多数文件会高亮显示 Python 代码段,
可以在 {\color{red}\bfseries{}:confval:{}`highlight\_language{}`} 配置.

\item {} 
有了Python 高亮显示模块, 交互界面会自动识别并且适当强调显示.  一般Python 代码仅在可解析时高亮显示
(使用默认的Python, 但是零散的代码段比如shell命令等代码块将不会像Python一样高亮显示).

\item {} 
高亮显示语言也可以通过指令 \code{highlight} 改变,如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{highlight}\PYG{p}{::} c
\end{Verbatim}

C 语言将会被使用直到下一个 \code{highlight} 指令.

\item {} 
如果文档需展示不同语言片段, 直接使用 \code{code-block} 指令给出高亮语言:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{code\PYGZhy{}block}\PYG{p}{::} ruby

   Some Ruby code.
\end{Verbatim}

指令别名也可用于  \code{sourcecode} .

\item {} 
有效的语言:
\begin{itemize}
\item {} 
\code{none} (没有高亮显示)

\item {} 
\code{python} (默认， {\color{red}\bfseries{}:confval:{}`highlight\_language{}`} 没有设置时)

\item {} 
\code{guess} (让 Pygments 根据内容去决定, 仅支持一些可识别的语言)

\item {} 
\code{rest}

\item {} 
\code{c}

\item {} 
... 其他Pygments 支持的语言名.

\end{itemize}

\item {} 
如果选定语言的高亮显示失败，则模块不会以其他方式高亮显示.

\end{itemize}


\subsection{行号}
\label{markup/code:id6}
如果安装好, Pygments可以为代码块产生行号.自动高亮显示模块 (以 \code{::} 开始), 行号由指令 \code{highlight} 的选项 \code{linenothreshold} 管理:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{highlight}\PYG{p}{::} python
   \PYG{n+nc}{:linenothreshold:} \PYG{n+nf}{5}
\end{Verbatim}

如果代码块多于5行将产生行号.

对于 \code{code-block} 模块, 选项 \code{linenos} 给出则为独立块生成行号:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{code\PYGZhy{}block}\PYG{p}{::} ruby
   \PYG{n+nc}{:linenos:}

   Some more Ruby code.
\end{Verbatim}

另外, 选项 \code{emphasize-lines} 可以生成特别强调的行:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{code\PYGZhy{}block}\PYG{p}{::} python
   \PYG{n+nc}{:emphasize\PYGZhy{}lines:} \PYG{n+nf}{3,5}

   def some\PYGZus{}function():
       interesting = False
       print \PYGZsq{}This line is highlighted.\PYGZsq{}
       print \PYGZsq{}This one is not...\PYGZsq{}
       print \PYGZsq{}...but this one is.\PYGZsq{}
\end{Verbatim}

\DUrole{versionmodified}{在 1.1 版更改: }添加了{}`{}`emphasize-lines{}`{}` .


\subsection{包含}
\label{markup/code:id7}\index{literalinclude (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/code:directive-literalinclude}\pysigline{\bfcode{..~literalinclude::}\code{~filename}}
目录里不显示的文件可能被一个外部纯文本文件保存为例子文本.  文件使用指令 \code{literalinclude} 包含.
\footnote[1]{\sphinxAtStartFootnote%
标准包含指令 \code{.. include} , 如果文件不存在会抛出异常.  这一个则仅会产生警告.
} 例如包含Python源文件 \code{example.py}, 使用:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{literalinclude}\PYG{p}{::} example.py
\end{Verbatim}

文件名为当前文件的相对路径.  如果是绝对路径 (以 \code{/} 开始), 则是源目录的相对路径.

输入标签可以扩展，给出 \code{tab-width} 选项指定标签宽度.

该指令也支持 \code{linenos} 选项产生行号, \code{emphasize-lines} 选项生成强调行,
以及 \code{language} 选项选择不同于当前文件使用的标准语言的语言.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{literalinclude}\PYG{p}{::} example.rb
   \PYG{n+nc}{:language:} \PYG{n+nf}{ruby}
   \PYG{n+nc}{:emphasize\PYGZhy{}lines:} \PYG{n+nf}{12,15\PYGZhy{}18}
   \PYG{n+nc}{:linenos:}
\end{Verbatim}

被包含文件的编码会被认定为 {\color{red}\bfseries{}:confval:{}`source\_encoding{}`}.
如果文件有不同的编码，可以使用 \code{encoding} 选项:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{literalinclude}\PYG{p}{::} example.py
   \PYG{n+nc}{:encoding:} \PYG{n+nf}{latin\PYGZhy{}1}
\end{Verbatim}

指令支持包含文件的一部分.  例如
Python模块, 可以选择类，函数或方法，使用 \code{pyobject} 选项:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{literalinclude}\PYG{p}{::} example.py
   \PYG{n+nc}{:pyobject:} \PYG{n+nf}{Timer.start}
\end{Verbatim}

这会包含文件中 \code{Timer} 类的 \code{start()} 方法后面的代码行.

使用 \code{lines} 选项精确的控制所包含的行:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{literalinclude}\PYG{p}{::} example.py
   \PYG{n+nc}{:lines:} \PYG{n+nf}{1,3,5\PYGZhy{}10,20\PYGZhy{}}
\end{Verbatim}

包含1, 3, 5 到 10 及 20 之后的代码行.

另一种实现包含文件特定部分的方式是使用 \code{start-after} 或 \code{end-before} 选项 (仅使用一种).
选项 \code{start-after} 给出一个字符串, 第一行包含该字符串后面的所有行均被包含.
选项 \code{end-before} 也是给出一个字符串，包含该字符串的第一行前面的文本将会被包含.

可以往包含代码的首尾添加新行，使用 \code{prepend} 及 \code{append} 选项.
这很有用，比如在高亮显示的PHP 代码里不能包含 \code{\textless{}?php}/\code{?\textgreater{}} 标签.

\DUrole{versionmodified}{0.4.3 新版功能: }选项 \code{encoding} .

\DUrole{versionmodified}{0.6 新版功能: }选项 \code{pyobject}, \code{lines}, \code{start-after} 及 \code{end-before} ,
并支持绝对文件名.

\DUrole{versionmodified}{1.0 新版功能: }选项 \code{prepend} 、 \code{append} 及 \code{tab-width}.

\end{fulllineitems}



\section{内联标记}
\label{markup/inline:id1}\label{markup/inline:inline-markup}\label{markup/inline::doc}
Sphinx 使用文本解释角色在文档中插入语义标签.
这样写 \code{:rolename:{}`content{}`}.

\begin{notice}{note}{注解:}
默认角色 (\code{{}`content{}`}) 并不特别.  可使用任何其他有效的名字来代替; 使用 {\color{red}\bfseries{}:confval:{}`default\_role{}`} 设置.
\end{notice}

由主域添加的角色请参考 {\hyperref[domains:domains]{\crossref{\DUrole{std,std-ref}{Sphinx Domains}}}} .


\subsection{交叉索引的语法}
\label{markup/inline:xref-syntax}\label{markup/inline:id4}
多数文本解释角色都会产生交叉索引.
需要写一个 \code{:role:{}`target{}`}, 创建名为 \emph{target} 的链接，类型由 \emph{role} 指定.  链接文本与 \emph{target} 一样.

还有其他的功能，这使得交叉索引更通用:
\begin{itemize}
\item {} 
需要明确的标题及索引标签, 像reST 超链接: \code{:role:{}`title \textless{}target\textgreater{}{}`} ，会链接 \emph{target} 标签, 但链接文本为 \emph{title}.

\item {} 
加前缀 \code{!}, 交叉索引/超链接不会被创建.

\item {} 
前缀 \code{\textasciitilde{}}, 链接文本仅是标签的最后成分.
例如, \code{:py:meth:{}`\textasciitilde{}Queue.Queue.get{}`} 会建立到 \code{Queue.Queue.get} 的链接，但是链接文本仅显示 \code{get} .

HTML 文档, 链接的 \code{title} 属性 (显示为鼠标的tool-tip) 一直是完整的标签名.

\end{itemize}


\subsubsection{交叉索引的对象}
\label{markup/inline:id5}
这些角色在不同主域里:
\begin{itemize}
\item {} 
{\hyperref[domains:python\string-roles]{\crossref{\DUrole{std,std-ref}{Python}}}}

\item {} 
{\hyperref[domains:c\string-roles]{\crossref{\DUrole{std,std-ref}{C}}}}

\item {} 
{\hyperref[domains:cpp\string-roles]{\crossref{\DUrole{std,std-ref}{C++}}}}

\item {} 
{\hyperref[domains:js\string-roles]{\crossref{\DUrole{std,std-ref}{JavaScript}}}}

\item {} 
{\hyperref[domains:rst\string-roles]{\crossref{\DUrole{std,std-ref}{ReST}}}}

\end{itemize}


\subsubsection{交叉索引的位置}
\label{markup/inline:id6}\label{markup/inline:ref-role}\index{ref (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-ref}\pysigline{\bfcode{:ref:}}
在文档的任意位置都可以使用交叉索引, 像标准reST 标签一样使用.
对于文档条目这些标签名必须是唯一的.有两种方式可以链接到这些标签:
\begin{itemize}
\item {} 
标签直接放在章节标题前面, 可以通过 \code{:ref:{}`label-name{}`} 引用.例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{n+nt}{\PYGZus{}my\PYGZhy{}reference\PYGZhy{}label:}

\PYG{g+gh}{Section to cross\PYGZhy{}reference}
\PYG{g+gh}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}

章节内容.

需引用自身, 查看 \PYG{n+na}{:ref:}\PYG{n+nv}{{}`my\PYGZhy{}reference\PYGZhy{}label{}`}.
\end{Verbatim}

角色 \code{:ref:} 会产生这个章节的链接, 链接标题是 ``Section to cross-reference''.
章节与索引可在不同的源文件.

自动标签也可以使用 figures: given

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{n+nt}{\PYGZus{}my\PYGZhy{}figure:}

\PYG{p}{..} \PYG{o+ow}{figure}\PYG{p}{::} whatever

   Figure caption
\end{Verbatim}

参考 \code{:ref:{}`my-figure{}`} 将在图例里插入引用索引，链接文本是 ``Figure caption''.

表格也可以使用，在表格标题上使用指令 {\color{red}\bfseries{}:dudir:{}`table{}`} .

\item {} 
标签不放在章节开头，需要给出明确的链接，使用语法: \code{:ref:{}`Link title \textless{}label-name\textgreater{}{}`}.

\end{itemize}

推荐使用角色 {\hyperref[markup/inline:role\string-ref]{\crossref{\code{ref}}}} 而不是标准的reStructuredText 章节链接
(比如 \code{{}`Section title{}`\_}) ，因为它可以在不同文件间使用，并且即使章节标题变化，所有的生成器仍支持这些索引.

\end{fulllineitems}



\subsubsection{参考文档}
\label{markup/inline:id9}
\DUrole{versionmodified}{0.6 新版功能.}

可以直接链接到文档名.
\index{doc (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-doc}\pysigline{\bfcode{:doc:}}
链接到指定文档; 文档名可以是绝对或相对的.
例如, 参考 \code{:doc:{}`parrot{}`} 出现在文档 \code{sketches/index{}`{}`中, 将会链接到文档 {}`{}`sketches/parrot}.
如果参考是 \code{:doc:{}`/people{}`} 或 \code{:doc:{}`../people{}`}, 将会链接到文档 \code{people}.

如果没有给出链接标题(使用: \code{:doc:{}`Monty Python members
\textless{}/people\textgreater{}{}`}), 链接标题就是文档的标题.

\end{fulllineitems}



\subsubsection{可下载的参考文件}
\label{markup/inline:id10}
\DUrole{versionmodified}{0.6 新版功能.}
\index{download (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-download}\pysigline{\bfcode{:download:}}
该角色可以链接源目录里可以浏览、但不是reST格式的文档，这些文件将被下载.

如果使用该角色，被参考的文件会自动包含到输出里(显然仅是HTML输出).
可下载文件被放在输出目录的子目录 \code{\_downloads} 里;文件名被复制.

示例:

\begin{Verbatim}[commandchars=\\\{\}]
查看 \PYG{n+na}{:download:}\PYG{n+nv}{{}`this example script \PYGZlt{}../example.py\PYGZgt{}{}`}.
\end{Verbatim}

文件名是当前路径的相对路径, 绝对路径则被认为以源目录为根目录的相对路径.

文件 \code{example.py} 被复制到输出目录, 并生成链接.

\end{fulllineitems}



\subsubsection{其他有趣的交叉索引}
\label{markup/inline:id11}
以下角色也会生成索引, 但不对应实体:
\index{envvar (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-envvar}\pysigline{\bfcode{:envvar:}}
环境变量.  会生成索引.  也会产生到指令 {\hyperref[domains:directive\string-envvar]{\crossref{\code{envvar}}}} 的链接，如果指令存在.

\end{fulllineitems}

\index{token (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-token}\pysigline{\bfcode{:token:}}
语法名子 (用来产生到指令 {\hyperref[markup/para:directive\string-productionlist]{\crossref{\code{productionlist}}}} 的链接).

\end{fulllineitems}

\index{keyword (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-keyword}\pysigline{\bfcode{:keyword:}}
Python的关键字.  会创建这些关键字的链接.

\end{fulllineitems}

\index{option (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-option}\pysigline{\bfcode{:option:}}
执行程序的命令行参数.  需包含连字号开头.  产生到指令 {\hyperref[domains:directive\string-option]{\crossref{\code{option}}}} 的链接.

\end{fulllineitems}


以下角色产生术语的索引:
\index{term (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-term}\pysigline{\bfcode{:term:}}
术语索引.  术语由指令 \code{glossary} 创建，包含一列术语的定义.
在同一文件里不能使用 \code{term} 标记,
Python 文档有一个全局的术语文件 \code{glossary.rst}.

如果使用的术语不在术语表里, 将会产生警告.

\end{fulllineitems}



\subsection{其他语义标记}
\label{markup/inline:id12}
下面的这些角色以不同样式格式化文本:
\index{abbr (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-abbr}\pysigline{\bfcode{:abbr:}}
缩写应用.  如果角色后有个括号说明文字，在HTML时会显示成 tool-tip ,仅在LaTeX才会输出.

例如: \code{:abbr:{}`LIFO (last-in, first-out){}`}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{command (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-command}\pysigline{\bfcode{:command:}}
系统级别的命令，例如 \code{rm}.

\end{fulllineitems}

\index{dfn (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-dfn}\pysigline{\bfcode{:dfn:}}
在文本中标记术语定义.  (不产生索引条目)

\end{fulllineitems}

\index{file (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-file}\pysigline{\bfcode{:file:}}
文件或目录名.  可以使用花括号指示变量部分, 例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{... is installed in :file:{}`/usr/lib/python2.\PYGZob{}x\PYGZcb{}/site\PYGZhy{}packages{}` ...}
\end{Verbatim}

在生成文档时, \code{x} 会被Python 的次要版本号替换.

\end{fulllineitems}

\index{guilabel (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-guilabel}\pysigline{\bfcode{:guilabel:}}
表示用户交互接口的标签需使用 \code{guilabel} 标记.  包含基于文本的接口如
使用 \code{curses} 创建的或基于其他文本库的标签.  接口标签必须使用该角色标记，
包括按钮，窗口标题，文件名，菜单，菜单选项，甚至选择列表里的值.

\DUrole{versionmodified}{在 1.0 版更改: }GUI 标签可以使用\&标示快捷方式;
输出时\&不会显示，而是在文本下面加下划线 (例如:
\code{:guilabel:{}`\&Cancel{}`}).  要在输出是包含\&，则使用两个\&\&.

\end{fulllineitems}

\index{kbd (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-kbd}\pysigline{\bfcode{:kbd:}}
标记键值序列.  键值序列一般依赖于平台或特定应用程序的约定.  如果没有相关的约定,
键值序列的名字应该可以修改, 以改善新用户或非英语系使用者的体验.  例如, 一个
\emph{xemacs} 键序被标记为 \code{:kbd:{}`C-x C-f{}`}, 如果没有特定应用程序或平台可供参考，
则同样的键序应该被标记为 \code{:kbd:{}`Control-x Control-f{}`}.

\end{fulllineitems}

\index{mailheader (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-mailheader}\pysigline{\bfcode{:mailheader:}}
RFC 822-样式邮件头的名字.  该标记并不表明邮件头在邮件信息里使用, 而是被用来映射所有相同样式的邮件头.
也被用来定义有邮件头的MIME类型.  在实践中邮件头名通常以相同的方式键入, 遵循 camel-casing 约定，
有多种通用用法时被优选采用. 例如:
\code{:mailheader:{}`Content-Type{}`}.

\end{fulllineitems}

\index{makevar (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-makevar}\pysigline{\bfcode{:makevar:}}
命令 \textbf{\texttt{make}} 的变量名.

\end{fulllineitems}

\index{manpage (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-manpage}\pysigline{\bfcode{:manpage:}}
参考 Unix 手册页，包含章节,例如 \code{:manpage:{}`ls(1){}`}.

\end{fulllineitems}

\index{menuselection (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-menuselection}\pysigline{\bfcode{:menuselection:}}
菜单选项由角色 \code{menuselection} 标记.
标记完整的菜单选项序列，包含子菜单和选择的特定操作，以及所有的子序列.
独立选项的名字使用 \code{-{-}\textgreater{}} 分隔.

例如，标记选项 ``Start \textgreater{} Programs'':

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+na}{:menuselection:}\PYG{n+nv}{{}`Start \PYGZhy{}\PYGZhy{}\PYGZgt{} Programs{}`}
\end{Verbatim}

选项如果包含一些指示, 例如某些操作系统会使用一些标志指示命令会打开一个对话框,
这些指示信息在选项名中会被忽略.

\code{menuselection} 也支持\&, 与 {\hyperref[markup/inline:role\string-guilabel]{\crossref{\code{guilabel}}}} 一样使用.

\end{fulllineitems}

\index{mimetype (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-mimetype}\pysigline{\bfcode{:mimetype:}}
MIME 类型, 或者MIME 类型的元素 (主要次要部分可以分开).

\end{fulllineitems}

\index{newsgroup (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-newsgroup}\pysigline{\bfcode{:newsgroup:}}
Usenet 新闻组.

\end{fulllineitems}

\index{program (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-program}\pysigline{\bfcode{:program:}}
执行程序脚本.  与某些平台的可执行文件名不同, 比如Windows 程序的 \code{.exe} (或其他)
扩展名会被忽略.

\end{fulllineitems}

\index{regexp (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-regexp}\pysigline{\bfcode{:regexp:}}
正则表达式，不包括引用.

\end{fulllineitems}

\index{samp (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-samp}\pysigline{\bfcode{:samp:}}
一块字面量文本，如代码.  文本内可以有花括号变量，如在 {\hyperref[markup/inline:role\string-file]{\crossref{\code{file}}}} 一样.
例如, 在 \code{:samp:{}`print 1+\{variable\}{}`}, \code{variable} 的部分会被强调.

如不需要变量部分，使用标准代码即可.

\end{fulllineitems}


角色 {\hyperref[markup/misc:role\string-index]{\crossref{\code{index}}}} 会产生索引条目.

下面的角色会产生外部链接:
\index{pep (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-pep}\pysigline{\bfcode{:pep:}}
对Python Enhancement Proposal 的参考.  会产生适当的索引条目及文本 ``PEP \emph{number}'' ;
在HTML 文档,该文本是指向在线PEP文档的超链接.  可以链接到特定章节 \code{:pep:{}`number\#anchor{}`}.

\end{fulllineitems}

\index{rfc (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/inline:role-rfc}\pysigline{\bfcode{:rfc:}}
Internet Request for Comments的参考.  也会产生索引条目及文本 ``RFC \emph{number}'' ;
在HTML文档里是一个超链接，指定链接章节 \code{:rfc:{}`number\#anchor{}`}.

\end{fulllineitems}


如果没有特定的角色能够包含需要的超链接，就使用标准reST 标记.


\subsection{替换}
\label{markup/inline:default-substitutions}\label{markup/inline:id13}
文档系统提供三种默认定义的替换，可在配置文件里设置.


\begin{fulllineitems}
\pysigline{\bfcode{\textbar{}release\textbar{}}}
被项目文档的发布版本替换.  这时版本字符串包含完整的标签 alpha/beta/release ,例如 \code{2.5.2b3}.  由 {\color{red}\bfseries{}:confval:{}`release{}`} 设置.

\end{fulllineitems}



\begin{fulllineitems}
\pysigline{\bfcode{\textbar{}version\textbar{}}}
被项目文档的版本替换. 版本字符串仅有主要和次要两部分组成，例如版本2.5.1会表示为 \code{2.5}.  由 {\color{red}\bfseries{}:confval:{}`version{}`} 设置.

\end{fulllineitems}



\begin{fulllineitems}
\pysigline{\bfcode{\textbar{}today\textbar{}}}
替换今天的日期 (文档被读取的日期), 或者配置文件设置的日期.  默认格式为 \code{April 14, 2007}.  可设置 {\color{red}\bfseries{}:confval:{}`today\_fmt{}`} 及 {\color{red}\bfseries{}:confval:{}`today{}`} .

\end{fulllineitems}



\section{未分类标记}
\label{markup/misc:id1}\label{markup/misc::doc}

\subsection{文件范围的元数据}
\label{markup/misc:metadata}\label{markup/misc:id2}
reST 有字段列表''field lists'' 的概念; 字段序列如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nc}{:fieldname:} \PYG{n+nf}{Field content}
\end{Verbatim}

文件开端的字段列表会被文档工具解释为文档源信息,通常记录了作者，出版日期等元数据.
在Sphinx中, 在所有标记前面的字段列表将作为文档元数据放在Sphinx 环境中,不显示在输出文档中;
在文档标题后的字段列表仍然是文档源信息的一部分显示在输出文档中.

此时, 这些元数据字段会被识别:
\begin{description}
\item[{\code{tocdepth}}] \leavevmode
文件目录表的最大深度.

\DUrole{versionmodified}{0.4 新版功能.}

\item[{\code{nocomments}}] \leavevmode
如果设置了, 网页不会显示源文件生成的评论.

\item[{\code{orphan}}] \leavevmode
如果设置, 不在目录结构中的文件产生的警告会被忽略.

\DUrole{versionmodified}{1.0 新版功能.}

\end{description}


\subsection{元信息标记}
\label{markup/misc:id3}\index{sectionauthor (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:directive-sectionauthor}\pysigline{\bfcode{..~sectionauthor::}\code{~name~\textless{}email\textgreater{}}}
当前章节作者标示.  参数是作者名字,可以展示或放在邮件地址中. 地址的主域名通常要小写.
例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{sectionauthor}\PYG{p}{::} Guido van Rossum \PYGZlt{}guido@python.org\PYGZgt{}
\end{Verbatim}

默认这些标记不会出现在输出文档中 (对追述贡献有帮助), 可以设置 {\color{red}\bfseries{}:confval:{}`show\_authors{}`} 的值为真，使其产生一段输出.

\end{fulllineitems}

\index{codeauthor (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:directive-codeauthor}\pysigline{\bfcode{..~codeauthor::}\code{~name~\textless{}email\textgreater{}}}
指令 {\hyperref[markup/misc:directive\string-codeauthor]{\crossref{\code{codeauthor}}}} , 可多次出现，记录代码的作者，
就像 {\hyperref[markup/misc:directive\string-sectionauthor]{\crossref{\code{sectionauthor}}}} 记录文档章节的作者一样.
在 {\color{red}\bfseries{}:confval:{}`show\_authors{}`} 为真时才显示在输出中.

\end{fulllineitems}



\subsection{索引生成标记}
\label{markup/misc:id8}
Sphinx 自动从对象(函数、类及属性)说明中生成索引条目;在 {\hyperref[domains:domains]{\crossref{\DUrole{std,std-ref}{Sphinx Domains}}}} 也有讨论.

这是个明确的标记,使得生成的索引更全面, 索引条目将会包含信息单元的次要信息，如语言参考.
\index{index (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:directive-index}\pysigline{\bfcode{..~index::}\code{~\textless{}entries\textgreater{}}}
指令包含一到多条索引条目.  每个条目有类型和值组成，以冒号分隔.

例如:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{index}\PYG{p}{::}
   single: execution; context
   module: \PYGZus{}\PYGZus{}main\PYGZus{}\PYGZus{}
   module: sys
   triple: module; search; path

\PYG{g+gh}{The execution context}
\PYG{g+gh}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}

\PYG{c+cp}{...}
\end{Verbatim}

这个指令包含5个条目, 产生的索引会链接到页面确切的位置(离线时是相关的页码).

索引指令会在源位置插入参考标签, 并会放在它们实际所映射内容的前面，上面例子中实际映射内容是标题.

条目类型:
\begin{description}
\item[{single}] \leavevmode
创建单一索引条目.  可以使用分号分隔子条目(该符号也用来描述创建了那些条目).

\item[{pair}] \leavevmode
\code{pair: loop; statement} 创建两个索引条目的简写,
命名为 \code{loop; statement} 或 \code{statement; loop}.

\item[{triple}] \leavevmode
例如 \code{triple: module; search; path} 创建三个条目的简写, 它们是 \code{module; search path}, \code{search; path,
module} 及 \code{path; module search}.

\item[{see}] \leavevmode
\code{see: entry; other} 创建可以映射到其他条目的索引.

\item[{seealso}] \leavevmode
如 \code{see}, 但是插入 ``see also'' 代替 ``see''.

\item[{模块, 关键字, 操作符, 对象, 异常, 声明, 内建指令均会创建两个索引条目.}] \leavevmode
例如, \code{module: hashlib{}`{}`会创建条目 {}`{}`module; hashlib} 和 \code{hashlib; module}.
(这是Python特定的，因此不推荐使用)

\end{description}

可以加前缀感叹号表示主要的索引条目.  主要索引会被强调显示.  例如, 有两个文件包含

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{index}\PYG{p}{::} Python
\end{Verbatim}

一个文件包含

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{index}\PYG{p}{::} ! Python
\end{Verbatim}

在反向链接中后面那个的索引会被强调.

索引指令仅包含单一条目，这是简短的用法:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{index}\PYG{p}{::} BNF, grammar, syntax, notation
\end{Verbatim}

创建了4个条目.

\DUrole{versionmodified}{在 1.1 版更改: }添加了 \code{see} and \code{seealso} 类型, 及主条目标记.

\end{fulllineitems}

\index{index (角色)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:role-index}\pysigline{\bfcode{:index:}}
当指令 {\hyperref[markup/misc:directive\string-index]{\crossref{\code{index}}}} 在模块级别并链接到下一段的开头, 仍有相应的角色在使用的地方设置链接标签.

角色的内容可以是一个短语,保留在文本中并作为索引条目使用.
也可以是文本与索引条目的组合，看起来是明确的参考文献标记.
这时, 标记部分如指令条目的描述一样.  例如:

\begin{Verbatim}[commandchars=\\\{\}]
一般的 reST \PYG{n+na}{:index:}\PYG{n+nv}{{}`paragraph{}`} 包含几条
\PYG{n+nc}{:index:{}`index entries \PYGZlt{}pair:} \PYG{n+nf}{index; entry\PYGZgt{}{}`.}
\end{Verbatim}

\DUrole{versionmodified}{1.1 新版功能.}

\end{fulllineitems}



\subsection{包含基于标签的内容}
\label{markup/misc:id9}\label{markup/misc:tags}\index{only (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:directive-only}\pysigline{\bfcode{..~only::}\code{~\textless{}expression\textgreater{}}}
当 \emph{expression} 为真时包含指令的内容.  表达式由标签组成, 如下:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{only}\PYG{p}{::} html and draft
\end{Verbatim}

未定义的标签为假, 定义的为真 (使用 \code{-t} 命令行参数或者在文件 \code{conf.py} 中定义) .
布尔表达式, 可使用括号 (如 \code{html and (latex or draft)}) .

当前生成器的格式(\code{html}, \code{latex} or \code{text})会被设置为标签.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}



\subsection{Tables}
\label{markup/misc:tables}
使用 {\hyperref[rest:rst\string-tables]{\crossref{\DUrole{std,std-ref}{standard reStructuredText tables}}}}.  在HTML中工作良好,
但是输出LaTeX文档时经常会有些问题: 列的宽度经常不能自动正确的显示.
因此, 出现如下指令:
\index{tabularcolumns (指示)}

\begin{fulllineitems}
\phantomsection\label{markup/misc:directive-tabularcolumns}\pysigline{\bfcode{..~tabularcolumns::}\code{~column~spec}}
指令给出了下面文件中表格的列规格.
这个规格是LaTeX 的 \code{tabulary} 封装环境的第二个参数( \code{tabulary} 用来翻译表格).
如下

\begin{Verbatim}[commandchars=\\\{\}]
\textbar{}l\textbar{}l\textbar{}l\textbar{}
\end{Verbatim}

这表示左调整，无分行的列.  如果列包含长文本将会自动被截断,
使用标准构建 \code{p\{width\}} , 或由 tabulary自动定义:

\begin{tabulary}{\linewidth}{|L|L|}
\hline

\code{L}
 & 
左调整，自动宽度
\\
\hline
\code{R}
 & 
右调整，自动宽度
\\
\hline
\code{C}
 & 
居中，自动宽度
\\
\hline
\code{J}
 & 
自调整，自动宽度
\\
\hline\end{tabulary}


根据表格里的内容自动调节宽度, 测量标准为它们占据的总宽度.

默认, Sphinx 使用的列布局是 \code{L} .

\DUrole{versionmodified}{0.3 新版功能.}

\end{fulllineitems}


\begin{notice}{warning}{警告:}
表格包含列表类元素比如对象描述,模块引用等，这些列表不能在 \code{tabulary} 以外设置.
因此需要设置标准 LaTeX \code{tabular} 环境，或者给出 \code{tabularcolumns} 指令.
然后 \code{tabulary} 设置表格, 且必须使用 \code{p\{width\}} 构建包含这些元素的列.

字面模块不能使用 \code{tabulary} , 包含字面模块的表格需使用 \code{tabular}.
当然字面模块使用的字体环境仅支持 \code{p\{width\}} 列, 这也是默认的方式, Sphinx会生成这些表格的列规格.
使用 {\hyperref[markup/misc:directive\string-tabularcolumns]{\crossref{\code{tabularcolumns}}}} 指令可以更好的控制表格.
\end{notice}

更多标记请参考 {\hyperref[domains:domains]{\crossref{\DUrole{std,std-ref}{Sphinx Domains}}}}.


\chapter{Sphinx Domains}
\label{domains:sphinx-domains}\label{domains:standard-rest-markup}\label{domains:domains}\label{domains::doc}
\DUrole{versionmodified}{1.0 新版功能.}


\section{What is a Domain?}
\label{domains:what-is-a-domain}
Originally, Sphinx was conceived for a single project, the documentation of the
Python language.  Shortly afterwards, it was made available for everyone as a
documentation tool, but the documentation of Python modules remained deeply
built in -- the most fundamental directives, like \code{function}, were designed
for Python objects.  Since Sphinx has become somewhat popular, interest
developed in using it for many different purposes: C/C++ projects, JavaScript,
or even reStructuredText markup (like in this documentation).

While this was always possible, it is now much easier to easily support
documentation of projects using different programming languages or even ones not
supported by the main Sphinx distribution, by providing a \textbf{domain} for every
such purpose.

A domain is a collection of markup (reStructuredText {\hyperref[glossary:term\string-directive]{\termref{\DUrole{xref,std,std-term}{directive}}}}s and
{\hyperref[glossary:term\string-role]{\termref{\DUrole{xref,std,std-term}{role}}}}s) to describe and link to {\hyperref[glossary:term\string-object]{\termref{\DUrole{xref,std,std-term}{object}}}}s belonging together,
e.g. elements of a programming language.  Directive and role names in a domain
have names like \code{domain:name}, e.g. \code{py:function}.  Domains can also provide
custom indices (like the Python Module Index).

Having domains means that there are no naming problems when one set of
documentation wants to refer to e.g. C++ and Python classes.  It also means that
extensions that support the documentation of whole new languages are much easier
to write.

This section describes what the domains that come with Sphinx provide.  The
domain API is documented as well, in the section {\hyperref[ext/appapi:domain\string-api]{\crossref{\DUrole{std,std-ref}{Domain API}}}}.


\section{Basic Markup}
\label{domains:basic-markup}\label{domains:basic-domain-markup}
Most domains provide a number of \emph{object description directives}, used to
describe specific objects provided by modules.  Each directive requires one or
more signatures to provide basic information about what is being described, and
the content should be the description.  The basic version makes entries in the
general index; if no index entry is desired, you can give the directive option
flag \code{:noindex:}.  An example using a Python domain directive:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} spam(eggs)
                 ham(eggs)

   Spam or ham the foo.
\end{Verbatim}

This describes the two Python functions \code{spam} and \code{ham}.  (Note that when
signatures become too long, you can break them if you add a backslash to lines
that are continued in the next line.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} filterwarnings(action, message=\PYGZsq{}\PYGZsq{}, category=Warning, \PYGZbs{}
                                module=\PYGZsq{}\PYGZsq{}, lineno=0, append=False)
   \PYG{n+nc}{:noindex:}
\end{Verbatim}

(This example also shows how to use the \code{:noindex:} flag.)

The domains also provide roles that link back to these object descriptions.  For
example, to link to one of the functions described in the example above, you
could say

\begin{Verbatim}[commandchars=\\\{\}]
The function \PYG{n+na}{:py:func:}\PYG{n+nv}{{}`spam{}`} does a similar thing.
\end{Verbatim}

As you can see, both directive and role names contain the domain name and the
directive name.
\paragraph{Default Domain}

To avoid having to writing the domain name all the time when you e.g. only
describe Python objects, a default domain can be selected with either the config
value {\color{red}\bfseries{}:confval:{}`primary\_domain{}`} or this directive:
\index{default-domain (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-default-domain}\pysigline{\bfcode{..~default-domain::}\code{~name}}
Select a new default domain.  While the {\color{red}\bfseries{}:confval:{}`primary\_domain{}`} selects a
global default, this only has an effect within the same file.

\end{fulllineitems}


If no other default is selected, the Python domain (named \code{py}) is the default
one, mostly for compatibility with documentation written for older versions of
Sphinx.

Directives and roles that belong to the default domain can be mentioned without
giving the domain name, i.e.

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{function}\PYG{p}{::} pyfunc()

   Describes a Python function.

Reference to \PYG{n+na}{:func:}\PYG{n+nv}{{}`pyfunc{}`}.
\end{Verbatim}


\subsection{Cross-referencing syntax}
\label{domains:cross-referencing-syntax}
For cross-reference roles provided by domains, the same facilities exist as for
general cross-references.  See {\hyperref[markup/inline:xref\string-syntax]{\crossref{\DUrole{std,std-ref}{交叉索引的语法}}}}.

In short:
\begin{itemize}
\item {} 
You may supply an explicit title and reference target: \code{:role:{}`title
\textless{}target\textgreater{}{}`} will refer to \emph{target}, but the link text will be \emph{title}.

\item {} 
If you prefix the content with \code{!}, no reference/hyperlink will be created.

\item {} 
If you prefix the content with \code{\textasciitilde{}}, the link text will only be the last
component of the target.  For example, \code{:py:meth:{}`\textasciitilde{}Queue.Queue.get{}`} will
refer to \code{Queue.Queue.get} but only display \code{get} as the link text.

\end{itemize}


\section{The Python Domain}
\label{domains:the-python-domain}
The Python domain (name \textbf{py}) provides the following directives for module
declarations:
\index{py:module (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:module}\pysigline{\bfcode{..~py:module::}\code{~name}}
This directive marks the beginning of the description of a module (or package
submodule, in which case the name should be fully qualified, including the
package name).  It does not create content (like e.g. {\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}} does).

This directive will also cause an entry in the global module index.

The \code{platform} option, if present, is a comma-separated list of the
platforms on which the module is available (if it is available on all
platforms, the option should be omitted).  The keys are short identifiers;
examples that are in use include ``IRIX'', ``Mac'', ``Windows'', and ``Unix''.  It is
important to use a key which has already been used when applicable.

The \code{synopsis} option should consist of one sentence describing the
module's purpose -- it is currently only used in the Global Module Index.

The \code{deprecated} option can be given (with no value) to mark a module as
deprecated; it will be designated as such in various locations then.

\end{fulllineitems}

\index{py:currentmodule (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:currentmodule}\pysigline{\bfcode{..~py:currentmodule::}\code{~name}}
This directive tells Sphinx that the classes, functions etc. documented from
here are in the given module (like {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}}), but it will not
create index entries, an entry in the Global Module Index, or a link target
for {\hyperref[domains:role\string-py:mod]{\crossref{\code{py:mod}}}}.  This is helpful in situations where documentation
for things in a module is spread over multiple files or sections -- one
location has the {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}} directive, the others only
{\hyperref[domains:directive\string-py:currentmodule]{\crossref{\code{py:currentmodule}}}}.

\end{fulllineitems}


The following directives are provided for module and class contents:
\index{py:data (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:data}\pysigline{\bfcode{..~py:data::}\code{~name}}
Describes global data in a module, including both variables and values used
as ``defined constants.''  Class and object attributes are not documented
using this environment.

\end{fulllineitems}

\index{py:exception (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:exception}\pysigline{\bfcode{..~py:exception::}\code{~name}}
Describes an exception class.  The signature can, but need not include
parentheses with constructor arguments.

\end{fulllineitems}

\index{py:function (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:function}\pysigline{\bfcode{..~py:function::}\code{~name(signature)}}
Describes a module-level function.  The signature should include the
parameters, enclosing optional parameters in brackets.  Default values can be
given if it enhances clarity; see {\hyperref[domains:signatures]{\crossref{\DUrole{std,std-ref}{Python Signatures}}}}.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} Timer.repeat([repeat=3[, number=1000000]])
\end{Verbatim}

Object methods are not documented using this directive. Bound object methods
placed in the module namespace as part of the public interface of the module
are documented using this, as they are equivalent to normal functions for
most purposes.

The description should include information about the parameters required and
how they are used (especially whether mutable objects passed as parameters
are modified), side effects, and possible exceptions.  A small example may be
provided.

\end{fulllineitems}

\index{py:class (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:class}\pysigline{\bfcode{..~py:class::}\code{~name{[}(signature){]}}}
Describes a class.  The signature can include parentheses with parameters
which will be shown as the constructor arguments.  See also
{\hyperref[domains:signatures]{\crossref{\DUrole{std,std-ref}{Python Signatures}}}}.

Methods and attributes belonging to the class should be placed in this
directive's body.  If they are placed outside, the supplied name should
contain the class name so that cross-references still work.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:class}\PYG{p}{::} Foo
\PYG{p}{   ..} \PYG{o+ow}{py:method}\PYG{p}{::} quux()

\PYGZhy{}\PYGZhy{} or \PYGZhy{}\PYGZhy{}

\PYG{p}{..} \PYG{o+ow}{py:class}\PYG{p}{::} Bar

\PYG{p}{..} \PYG{o+ow}{py:method}\PYG{p}{::} Bar.quux()
\end{Verbatim}

The first way is the preferred one.

\end{fulllineitems}

\index{py:attribute (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:attribute}\pysigline{\bfcode{..~py:attribute::}\code{~name}}
Describes an object data attribute.  The description should include
information about the type of the data to be expected and whether it may be
changed directly.

\end{fulllineitems}

\index{py:method (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:method}\pysigline{\bfcode{..~py:method::}\code{~name(signature)}}
Describes an object method.  The parameters should not include the \code{self}
parameter.  The description should include similar information to that
described for \code{function}.  See also {\hyperref[domains:signatures]{\crossref{\DUrole{std,std-ref}{Python Signatures}}}}.

\end{fulllineitems}

\index{py:staticmethod (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:staticmethod}\pysigline{\bfcode{..~py:staticmethod::}\code{~name(signature)}}
Like {\hyperref[domains:directive\string-py:method]{\crossref{\code{py:method}}}}, but indicates that the method is a static method.

\DUrole{versionmodified}{0.4 新版功能.}

\end{fulllineitems}

\index{py:classmethod (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:classmethod}\pysigline{\bfcode{..~py:classmethod::}\code{~name(signature)}}
Like {\hyperref[domains:directive\string-py:method]{\crossref{\code{py:method}}}}, but indicates that the method is a class method.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{py:decorator (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:decorator}\pysigline{\bfcode{..~py:decorator::}\code{~name}}\pysigline{\bfcode{..~py:decorator::}\code{~name(signature)}}
Describes a decorator function.  The signature should \emph{not} represent the
signature of the actual function, but the usage as a decorator.  For example,
given the functions

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{removename}\PYG{p}{(}\PYG{n}{func}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{func}\PYG{o}{.}\PYG{n}{\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{return} \PYG{n}{func}

\PYG{k}{def} \PYG{n+nf}{setnewname}\PYG{p}{(}\PYG{n}{name}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{def} \PYG{n+nf}{decorator}\PYG{p}{(}\PYG{n}{func}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{func}\PYG{o}{.}\PYG{n}{\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}} \PYG{o}{=} \PYG{n}{name}
        \PYG{k}{return} \PYG{n}{func}
    \PYG{k}{return} \PYG{n}{decorator}
\end{Verbatim}

the descriptions should look like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:decorator}\PYG{p}{::} removename

   Remove name of the decorated function.

\PYG{p}{..} \PYG{o+ow}{py:decorator}\PYG{p}{::} setnewname(name)

   Set name of the decorated function to \PYG{g+ge}{*name*}.
\end{Verbatim}

There is no \code{py:deco} role to link to a decorator that is marked up with
this directive; rather, use the {\hyperref[domains:role\string-py:func]{\crossref{\code{py:func}}}} role.

\end{fulllineitems}

\index{py:decoratormethod (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-py:decoratormethod}\pysigline{\bfcode{..~py:decoratormethod::}\code{~name}}\pysigline{\bfcode{..~py:decoratormethod::}\code{~name(signature)}}
Same as {\hyperref[domains:directive\string-py:decorator]{\crossref{\code{py:decorator}}}}, but for decorators that are methods.

Refer to a decorator method using the {\hyperref[domains:role\string-py:meth]{\crossref{\code{py:meth}}}} role.

\end{fulllineitems}



\subsection{Python Signatures}
\label{domains:signatures}\label{domains:python-signatures}
Signatures of functions, methods and class constructors can be given like they
would be written in Python, with the exception that optional parameters can be
indicated by brackets:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} compile(source[, filename[, symbol]])
\end{Verbatim}

It is customary to put the opening bracket before the comma.  In addition to
this ``nested'' bracket style, a ``flat'' style can also be used, due to the fact
that most optional parameters can be given independently:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} compile(source[, filename, symbol])
\end{Verbatim}

Default values for optional arguments can be given (but if they contain commas,
they will confuse the signature parser).  Python 3-style argument annotations
can also be given as well as return type annotations:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} compile(source : string[, filename, symbol]) \PYGZhy{}\PYGZgt{} ast object
\end{Verbatim}


\subsection{Info field lists}
\label{domains:info-field-lists}
\DUrole{versionmodified}{0.4 新版功能.}

Inside Python object description directives, reST field lists with these fields
are recognized and formatted nicely:
\begin{itemize}
\item {} 
\code{param}, \code{parameter}, \code{arg}, \code{argument}, \code{key}, \code{keyword}:
Description of a parameter.

\item {} 
\code{type}: Type of a parameter.

\item {} 
\code{raises}, \code{raise}, \code{except}, \code{exception}: That (and when) a specific
exception is raised.

\item {} 
\code{var}, \code{ivar}, \code{cvar}: Description of a variable.

\item {} 
\code{returns}, \code{return}: Description of the return value.

\item {} 
\code{rtype}: Return type.

\end{itemize}

The field names must consist of one of these keywords and an argument (except
for \code{returns} and \code{rtype}, which do not need an argument).  This is best
explained by an example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{py:function}\PYG{p}{::} format\PYGZus{}exception(etype, value, tb[, limit=None])

   Format the exception with a traceback.

   \PYG{n+nc}{:param etype:} \PYG{n+nf}{exception type}
   \PYG{n+nc}{:param value:} \PYG{n+nf}{exception value}
   \PYG{n+nc}{:param tb:} \PYG{n+nf}{traceback object}
   \PYG{n+nc}{:param limit:} \PYG{n+nf}{maximum number of stack frames to show}
   \PYG{n+nc}{:type limit:} \PYG{n+nf}{integer or None}
   \PYG{n+nc}{:rtype:} \PYG{n+nf}{list of strings}
\end{Verbatim}

This will render like this:
\begin{quote}


\begin{fulllineitems}
\pysiglinewithargsret{\bfcode{format\_exception}}{\emph{etype}, \emph{value}, \emph{tb}\optional{, \emph{limit=None}}}{}
Format the exception with a traceback.
\begin{quote}\begin{description}
\item[{参数}] \leavevmode\begin{itemize}
\item {} 
\textbf{\texttt{etype}} -- exception type

\item {} 
\textbf{\texttt{value}} -- exception value

\item {} 
\textbf{\texttt{tb}} -- traceback object

\item {} 
\textbf{\texttt{limit}} (\emph{\texttt{integer or None}}) -- maximum number of stack frames to show

\end{itemize}

\item[{返回类型}] \leavevmode
list of strings

\end{description}\end{quote}

\end{fulllineitems}

\end{quote}

It is also possible to combine parameter type and description, if the type is a
single word, like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nc}{:param integer limit:} \PYG{n+nf}{maximum number of stack frames to show}
\end{Verbatim}


\subsection{Cross-referencing Python objects}
\label{domains:cross-referencing-python-objects}\label{domains:python-roles}
The following roles refer to objects in modules and are possibly hyperlinked if
a matching identifier is found:
\index{py:mod (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:mod}\pysigline{\bfcode{:py:mod:}}
Reference a module; a dotted name may be used.  This should also be used for
package names.

\end{fulllineitems}

\index{py:func (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:func}\pysigline{\bfcode{:py:func:}}
Reference a Python function; dotted names may be used.  The role text needs
not include trailing parentheses to enhance readability; they will be added
automatically by Sphinx if the {\color{red}\bfseries{}:confval:{}`add\_function\_parentheses{}`} config
value is true (the default).

\end{fulllineitems}

\index{py:data (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:data}\pysigline{\bfcode{:py:data:}}
Reference a module-level variable.

\end{fulllineitems}

\index{py:const (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:const}\pysigline{\bfcode{:py:const:}}
Reference a ``defined'' constant.  This may be a C-language \code{\#define} or a
Python variable that is not intended to be changed.

\end{fulllineitems}

\index{py:class (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:class}\pysigline{\bfcode{:py:class:}}
Reference a class; a dotted name may be used.

\end{fulllineitems}

\index{py:meth (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:meth}\pysigline{\bfcode{:py:meth:}}
Reference a method of an object.  The role text can include the type name and
the method name; if it occurs within the description of a type, the type name
can be omitted.  A dotted name may be used.

\end{fulllineitems}

\index{py:attr (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:attr}\pysigline{\bfcode{:py:attr:}}
Reference a data attribute of an object.

\end{fulllineitems}

\index{py:exc (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:exc}\pysigline{\bfcode{:py:exc:}}
Reference an exception.  A dotted name may be used.

\end{fulllineitems}

\index{py:obj (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-py:obj}\pysigline{\bfcode{:py:obj:}}
Reference an object of unspecified type.  Useful e.g. as the
{\color{red}\bfseries{}:confval:{}`default\_role{}`}.

\DUrole{versionmodified}{0.4 新版功能.}

\end{fulllineitems}


The name enclosed in this markup can include a module name and/or a class name.
For example, \code{:py:func:{}`filter{}`} could refer to a function named \code{filter} in
the current module, or the built-in function of that name.  In contrast,
\code{:py:func:{}`foo.filter{}`} clearly refers to the \code{filter} function in the
\code{foo} module.

Normally, names in these roles are searched first without any further
qualification, then with the current module name prepended, then with the
current module and class name (if any) prepended.  If you prefix the name with a
dot, this order is reversed.  For example, in the documentation of Python's
\code{codecs} module, \code{:py:func:{}`open{}`} always refers to the built-in
function, while \code{:py:func:{}`.open{}`} refers to \code{codecs.open()}.

A similar heuristic is used to determine whether the name is an attribute of the
currently documented class.

Also, if the name is prefixed with a dot, and no exact match is found, the
target is taken as a suffix and all object names with that suffix are
searched.  For example, \code{:py:meth:{}`.TarFile.close{}`} references the
\code{tarfile.TarFile.close()} function, even if the current module is not
\code{tarfile}.  Since this can get ambiguous, if there is more than one possible
match, you will get a warning from Sphinx.

Note that you can combine the \code{\textasciitilde{}} and \code{.} prefixes:
\code{:py:meth:{}`\textasciitilde{}.TarFile.close{}`} will reference the \code{tarfile.TarFile.close()}
method, but the visible link caption will only be \code{close()}.


\section{The C Domain}
\label{domains:c-domain}\label{domains:the-c-domain}
The C domain (name \textbf{c}) is suited for documentation of C API.
\index{c:function (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-c:function}\pysigline{\bfcode{..~c:function::}\code{~type~name(signature)}}
Describes a C function. The signature should be given as in C, e.g.:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{c:function}\PYG{p}{::} PyObject\PYG{g+ge}{* PyType\PYGZus{}GenericAlloc(PyTypeObject *}type, Py\PYGZus{}ssize\PYGZus{}t nitems)
\end{Verbatim}

This is also used to describe function-like preprocessor macros.  The names
of the arguments should be given so they may be used in the description.

Note that you don't have to backslash-escape asterisks in the signature, as
it is not parsed by the reST inliner.

\end{fulllineitems}

\index{c:member (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-c:member}\pysigline{\bfcode{..~c:member::}\code{~type~name}}
Describes a C struct member. Example signature:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{c:member}\PYG{p}{::} PyObject* PyTypeObject.tp\PYGZus{}bases
\end{Verbatim}

The text of the description should include the range of values allowed, how
the value should be interpreted, and whether the value can be changed.
References to structure members in text should use the \code{member} role.

\end{fulllineitems}

\index{c:macro (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-c:macro}\pysigline{\bfcode{..~c:macro::}\code{~name}}
Describes a ``simple'' C macro.  Simple macros are macros which are used for
code expansion, but which do not take arguments so cannot be described as
functions.  This is not to be used for simple constant definitions.  Examples
of its use in the Python documentation include \code{PyObject\_HEAD} and
\code{Py\_BEGIN\_ALLOW\_THREADS}.

\end{fulllineitems}

\index{c:type (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-c:type}\pysigline{\bfcode{..~c:type::}\code{~name}}
Describes a C type (whether defined by a typedef or struct). The signature
should just be the type name.

\end{fulllineitems}

\index{c:var (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-c:var}\pysigline{\bfcode{..~c:var::}\code{~type~name}}
Describes a global C variable.  The signature should include the type, such
as:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{c:var}\PYG{p}{::} PyObject* PyClass\PYGZus{}Type
\end{Verbatim}

\end{fulllineitems}



\subsection{Cross-referencing C constructs}
\label{domains:c-roles}\label{domains:cross-referencing-c-constructs}
The following roles create cross-references to C-language constructs if they are
defined in the documentation:
\index{c:data (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-c:data}\pysigline{\bfcode{:c:data:}}
Reference a C-language variable.

\end{fulllineitems}

\index{c:func (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-c:func}\pysigline{\bfcode{:c:func:}}
Reference a C-language function. Should include trailing parentheses.

\end{fulllineitems}

\index{c:macro (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-c:macro}\pysigline{\bfcode{:c:macro:}}
Reference a ``simple'' C macro, as defined above.

\end{fulllineitems}

\index{c:type (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-c:type}\pysigline{\bfcode{:c:type:}}
Reference a C-language type.

\end{fulllineitems}



\section{The C++ Domain}
\label{domains:id9}
The C++ domain (name \textbf{cpp}) supports documenting C++ projects.

The following directives are available:
\index{cpp:class (指示)}\index{cpp:function (指示)}\index{cpp:member (指示)}\index{cpp:type (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-cpp:class}\pysigline{\bfcode{..~cpp:class::}\code{~signatures}}\phantomsection\label{domains:directive-cpp:function}\pysigline{\bfcode{..~cpp:function::}\code{~signatures}}\phantomsection\label{domains:directive-cpp:member}\pysigline{\bfcode{..~cpp:member::}\code{~signatures}}\phantomsection\label{domains:directive-cpp:type}\pysigline{\bfcode{..~cpp:type::}\code{~signatures}}
Describe a C++ object.  Full signature specification is supported -- give the
signature as you would in the declaration.  Here some examples:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{cpp:function}\PYG{p}{::} bool namespaced::theclass::method(int arg1, std::string arg2)

   Describes a method with parameters and types.

\PYG{p}{..} \PYG{o+ow}{cpp:function}\PYG{p}{::} bool namespaced::theclass::method(arg1, arg2)

   Describes a method without types.

\PYG{p}{..} \PYG{o+ow}{cpp:function}\PYG{p}{::} const T \PYGZam{}array\PYGZlt{}T\PYGZgt{}::operator[]() const

   Describes the constant indexing operator of a templated array.

\PYG{p}{..} \PYG{o+ow}{cpp:function}\PYG{p}{::} operator bool() const

   Describe a casting operator here.

\PYG{p}{..} \PYG{o+ow}{cpp:function}\PYG{p}{::} constexpr void foo(std::string \PYGZam{}bar[2]) noexcept

   Describe a constexpr function here.

\PYG{p}{..} \PYG{o+ow}{cpp:member}\PYG{p}{::} std::string theclass::name

\PYG{p}{..} \PYG{o+ow}{cpp:member}\PYG{p}{::} std::string theclass::name[N][M]

\PYG{p}{..} \PYG{o+ow}{cpp:type}\PYG{p}{::} theclass::const\PYGZus{}iterator
\end{Verbatim}

Will be rendered like this:
\begin{quote}
\index{namespaced::theclass::method (C++ 函数)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2N10namespaced8theclass6methodEiNSt6stringE}\pysiglinewithargsret{bool \code{namespaced::theclass::}\bfcode{method}}{int \emph{arg1}, std::string \emph{arg2}}{}
Describes a method with parameters and types.

\end{fulllineitems}

\index{namespaced::theclass::method (C++ 函数)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2N10namespaced8theclass6methodE4arg14arg2}\pysiglinewithargsret{bool \code{namespaced::theclass::}\bfcode{method}}{arg1, arg2}{}
Describes a method without types.

\end{fulllineitems}

\index{array\textless{}T\textgreater{}::operator{[}{]} (C++ 函数)}

\begin{fulllineitems}
\pysigline{template\textless{}\textgreater{}}\phantomsection\label{domains:_CPPv2IENK5arrayI1TEixEv}\pysiglinewithargsret{\strong{const} T \&\code{array\textless{}T\textgreater{}::}\bfcode{operator{[}{]}}}{}{ \strong{const}}
Describes the constant indexing operator of a templated array.

\end{fulllineitems}

\index{operator bool (C++ 函数)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2NKcvbEv}\pysiglinewithargsret{\code{}\bfcode{operator~bool}}{}{ \strong{const}}
Describe a casting operator here.

\end{fulllineitems}

\index{foo (C++ 函数)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv23fooA2_RNSt6stringE}\pysiglinewithargsret{\strong{constexpr} void \code{}\bfcode{foo}}{std::string \&\emph{bar}{[}2{]}}{ \strong{noexcept}}
Describe a constexpr function here.

\end{fulllineitems}

\index{theclass::name (C++ 成员)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2N8theclass4nameE}\pysigline{std::string \code{theclass::}\bfcode{name}}
\end{fulllineitems}

\index{theclass::name (C++ 成员)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2N8theclass4nameE}\pysigline{std::string \code{theclass::}\bfcode{name}{[}N{]}{[}M{]}}
\end{fulllineitems}

\index{theclass::const\_iterator (C++ 类型)}

\begin{fulllineitems}
\phantomsection\label{domains:_CPPv2N8theclass14const_iteratorE}\pysigline{\strong{type }\code{theclass::}\bfcode{const\_iterator}}
\end{fulllineitems}

\end{quote}

\end{fulllineitems}

\index{cpp:namespace (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-cpp:namespace}\pysigline{\bfcode{..~cpp:namespace::}\code{~namespace}}
Select the current C++ namespace for the following objects.

\end{fulllineitems}

\phantomsection\label{domains:cpp-roles}
These roles link to the given object types:
\index{cpp:class (角色)}\index{cpp:func (角色)}\index{cpp:member (角色)}\index{cpp:type (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-cpp:class}\pysigline{\bfcode{:cpp:class:}}\phantomsection\label{domains:role-cpp:func}\pysigline{\bfcode{:cpp:func:}}\phantomsection\label{domains:role-cpp:member}\pysigline{\bfcode{:cpp:member:}}\phantomsection\label{domains:role-cpp:type}\pysigline{\bfcode{:cpp:type:}}
Reference a C++ object.  You can give the full signature (and need to, for
overloaded functions.)

\begin{notice}{note}{注解:}
Sphinx' syntax to give references a custom title can interfere with
linking to template classes, if nothing follows the closing angle
bracket, i.e. if the link looks like this: \code{:cpp:class:{}`MyClass\textless{}T\textgreater{}{}`}.
This is interpreted as a link to \code{T} with a title of \code{MyClass}.
In this case, please escape the opening angle bracket with a backslash,
like this: \code{:cpp:class:{}`MyClass\textbackslash{}\textless{}T\textgreater{}{}`}.
\end{notice}

\end{fulllineitems}


\begin{notice}{note}{Note on References}

It is currently impossible to link to a specific version of an
overloaded method.  Currently the C++ domain is the first domain
that has basic support for overloaded methods and until there is more
data for comparison we don't want to select a bad syntax to reference a
specific overload.  Currently Sphinx will link to the first overloaded
version of the method / function.
\end{notice}


\section{The Standard Domain}
\label{domains:the-standard-domain}
The so-called ``standard'' domain collects all markup that doesn't warrant a
domain of its own.  Its directives and roles are not prefixed with a domain
name.

The standard domain is also where custom object descriptions, added using the
{\hyperref[ext/appapi:sphinx.application.Sphinx.add_object_type]{\crossref{\code{add\_object\_type()}}}} API, are placed.

There is a set of directives allowing documenting command-line programs:
\index{option (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-option}\pysigline{\bfcode{..~option::}\code{~name~args,~name~args,~...}}
Describes a command line option or switch.  Option argument names should be
enclosed in angle brackets.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{option}\PYG{p}{::} \PYGZhy{}m \PYGZlt{}module\PYGZgt{}, \PYGZhy{}\PYGZhy{}module \PYGZlt{}module\PYGZgt{}

   Run a module as a script.
\end{Verbatim}

The directive will create a cross-reference target named after the \emph{first}
option, referencable by {\hyperref[markup/inline:role\string-option]{\crossref{\code{option}}}} (in the example case, you'd use
something like \code{:option:{}`-m{}`}).

\end{fulllineitems}

\index{envvar (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-envvar}\pysigline{\bfcode{..~envvar::}\code{~name}}
Describes an environment variable that the documented code or program uses or
defines.  Referencable by {\hyperref[markup/inline:role\string-envvar]{\crossref{\code{envvar}}}}.

\end{fulllineitems}

\index{program (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-program}\pysigline{\bfcode{..~program::}\code{~name}}
Like {\hyperref[domains:directive\string-py:currentmodule]{\crossref{\code{py:currentmodule}}}}, this directive produces no output.  Instead, it
serves to notify Sphinx that all following {\hyperref[domains:directive\string-option]{\crossref{\code{option}}}} directives
document options for the program called \emph{name}.

If you use {\hyperref[domains:directive\string-program]{\crossref{\code{program}}}}, you have to qualify the references in your
{\hyperref[markup/inline:role\string-option]{\crossref{\code{option}}}} roles by the program name, so if you have the following
situation

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{program}\PYG{p}{::} rm

\PYG{p}{..} \PYG{o+ow}{option}\PYG{p}{::} \PYGZhy{}r

   Work recursively.

\PYG{p}{..} \PYG{o+ow}{program}\PYG{p}{::} svn

\PYG{p}{..} \PYG{o+ow}{option}\PYG{p}{::} \PYGZhy{}r revision

   Specify the revision to work upon.
\end{Verbatim}

then \code{:option:{}`rm -r{}`} would refer to the first option, while
\code{:option:{}`svn -r{}`} would refer to the second one.

The program name may contain spaces (in case you want to document subcommands
like \code{svn add} and \code{svn commit} separately).

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}


There is also a very generic object description directive, which is not tied to
any domain:
\index{describe (指示)}\index{object (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-describe}\pysigline{\bfcode{..~describe::}\code{~text}}\phantomsection\label{domains:directive-object}\pysigline{\bfcode{..~object::}\code{~text}}
This directive produces the same formatting as the specific ones provided by
domains, but does not create index entries or cross-referencing targets.
Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{describe}\PYG{p}{::} PAPER

   You can set this variable to select a paper size.
\end{Verbatim}

\end{fulllineitems}



\section{The JavaScript Domain}
\label{domains:the-javascript-domain}
The JavaScript domain (name \textbf{js}) provides the following directives:
\index{js:function (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-js:function}\pysigline{\bfcode{..~js:function::}\code{~name(signature)}}
Describes a JavaScript function or method.  If you want to describe
arguments as optional use square brackets as {\hyperref[domains:signatures]{\crossref{\DUrole{std,std-ref}{documented}}}} for Python signatures.

You can use fields to give more details about arguments and their expected
types, errors which may be thrown by the function, and the value being
returned:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{js:function}\PYG{p}{::} \PYGZdl{}.getJSON(href, callback[, errback])

   \PYG{n+nc}{:param string href:} \PYG{n+nf}{An URI to the location of the resource.}
   \PYG{n+nc}{:param callback:} \PYG{n+nf}{Get\PYGZsq{}s called with the object.}
   :param errback:
       Get\PYGZsq{}s called in case the request fails. And a lot of other
       text so we need multiple lines
   \PYG{n+nc}{:throws SomeError:} \PYG{n+nf}{For whatever reason in that case.}
   \PYG{n+nc}{:returns:} \PYG{n+nf}{Something}
\end{Verbatim}

This is rendered as:
\begin{quote}
\index{\$.getJSON() (\$ 方法)}

\begin{fulllineitems}
\phantomsection\label{domains:_S_.getJSON}\pysiglinewithargsret{\code{\$.}\bfcode{getJSON}}{\emph{href}, \emph{callback}\optional{, \emph{errback}}}{}~\begin{quote}\begin{description}
\item[{参数}] \leavevmode\begin{itemize}
\item {} 
\textbf{\texttt{href}} (\emph{\texttt{string}}) -- An URI to the location of the resource.

\item {} 
\textbf{\texttt{callback}} -- Get's called with the object.

\item {} 
\textbf{\texttt{errback}} -- Get's called in case the request fails. And a lot of other
text so we need multiple lines.

\end{itemize}

\item[{抛出}] \leavevmode
\textbf{\texttt{SomeError}} -- For whatever reason in that case.

\item[{返回}] \leavevmode
Something

\end{description}\end{quote}

\end{fulllineitems}

\end{quote}

\end{fulllineitems}

\index{js:class (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-js:class}\pysigline{\bfcode{..~js:class::}\code{~name}}
Describes a constructor that creates an object.  This is basically like
a function but will show up with a \titleref{class} prefix:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{js:class}\PYG{p}{::} MyAnimal(name[, age])

   \PYG{n+nc}{:param string name:} \PYG{n+nf}{The name of the animal}
   \PYG{n+nc}{:param number age:} \PYG{n+nf}{an optional age for the animal}
\end{Verbatim}

This is rendered as:
\begin{quote}
\index{MyAnimal() (类)}

\begin{fulllineitems}
\phantomsection\label{domains:MyAnimal}\pysiglinewithargsret{\strong{class }\bfcode{MyAnimal}}{\emph{name}\optional{, \emph{age}}}{}~\begin{quote}\begin{description}
\item[{参数}] \leavevmode\begin{itemize}
\item {} 
\textbf{\texttt{name}} (\emph{\texttt{string}}) -- The name of the animal

\item {} 
\textbf{\texttt{age}} (\emph{\texttt{number}}) -- an optional age for the animal

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\end{quote}

\end{fulllineitems}

\index{js:data (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-js:data}\pysigline{\bfcode{..~js:data::}\code{~name}}
Describes a global variable or constant.

\end{fulllineitems}

\index{js:attribute (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-js:attribute}\pysigline{\bfcode{..~js:attribute::}\code{~object.name}}
Describes the attribute \emph{name} of \emph{object}.

\end{fulllineitems}

\phantomsection\label{domains:js-roles}
These roles are provided to refer to the described objects:
\index{js:func (角色)}\index{js:class (角色)}\index{js:data (角色)}\index{js:attr (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-js:func}\pysigline{\bfcode{:js:func:}}\phantomsection\label{domains:role-js:class}\pysigline{\bfcode{:js:class:}}\phantomsection\label{domains:role-js:data}\pysigline{\bfcode{:js:data:}}\phantomsection\label{domains:role-js:attr}\pysigline{\bfcode{:js:attr:}}
\end{fulllineitems}



\section{The reStructuredText domain}
\label{domains:the-restructuredtext-domain}
The reStructuredText domain (name \textbf{rst}) provides the following directives:
\index{rst:directive (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-rst:directive}\pysigline{\bfcode{..~rst:directive::}\code{~name}}
Describes a reST directive.  The \emph{name} can be a single directive name or
actual directive syntax (\titleref{..} prefix and \titleref{::} suffix) with arguments that
will be rendered differently.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{rst:directive}\PYG{p}{::} foo

   Foo description.

\PYG{p}{..} \PYG{o+ow}{rst:directive}\PYG{p}{::} .. bar:: baz

   Bar description.
\end{Verbatim}

will be rendered as:
\begin{quote}
\index{foo (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-foo}\pysigline{\bfcode{..~foo::}}
Foo description.

\end{fulllineitems}

\index{bar (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-bar}\pysigline{\bfcode{..~bar::}\code{~baz}}
Bar description.

\end{fulllineitems}

\end{quote}

\end{fulllineitems}

\index{rst:role (指示)}

\begin{fulllineitems}
\phantomsection\label{domains:directive-rst:role}\pysigline{\bfcode{..~rst:role::}\code{~name}}
Describes a reST role.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{rst:role}\PYG{p}{::} foo

   Foo description.
\end{Verbatim}

will be rendered as:
\begin{quote}
\index{foo (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-foo}\pysigline{\bfcode{:foo:}}
Foo description.

\end{fulllineitems}

\end{quote}

\end{fulllineitems}

\phantomsection\label{domains:rst-roles}
These roles are provided to refer to the described objects:
\index{rst:dir (角色)}\index{rst:role (角色)}

\begin{fulllineitems}
\phantomsection\label{domains:role-rst:dir}\pysigline{\bfcode{:rst:dir:}}\phantomsection\label{domains:role-rst:role}\pysigline{\bfcode{:rst:role:}}
\end{fulllineitems}



\section{More domains}
\label{domains:more-domains}
The \href{https://bitbucket.org/birkenfeld/sphinx-contrib/}{sphinx-contrib} repository contains more domains available as extensions;
currently a Ruby and an Erlang domain.


\chapter{Available builders}
\label{builders:module-sphinx.builders}\label{builders:builders}\label{builders:sphinx-contrib}\label{builders:available-builders}\label{builders::doc}\index{sphinx.builders (模块)}
These are the built-in Sphinx builders.  More builders can be added by
{\hyperref[extensions:extensions]{\crossref{\DUrole{std,std-ref}{extensions}}}}.

The builder's ``name'' must be given to the \textbf{-b} command-line option of
\textbf{\texttt{sphinx-build}} to select a builder.
\phantomsection\label{builders:module-sphinx.builders.html}\index{sphinx.builders.html (模块)}\index{StandaloneHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.StandaloneHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{StandaloneHTMLBuilder}}
This is the standard HTML builder.  Its output is a directory with HTML
files, complete with style sheets and optionally the reST sources.  There are
quite a few configuration values that customize the output of this builder,
see the chapter {\hyperref[config:html\string-options]{\crossref{\DUrole{std,std-ref}{Options for HTML output}}}} for details.

Its name is \code{html}.

\end{fulllineitems}

\index{DirectoryHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.DirectoryHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{DirectoryHTMLBuilder}}
This is a subclass of the standard HTML builder.  Its output is a directory
with HTML files, where each file is called \code{index.html} and placed in a
subdirectory named like its page name.  For example, the document
\code{markup/rest.rst} will not result in an output file \code{markup/rest.html},
but \code{markup/rest/index.html}.  When generating links between pages, the
\code{index.html} is omitted, so that the URL would look like \code{markup/rest/}.

Its name is \code{dirhtml}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{SingleFileHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SingleFileHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{SingleFileHTMLBuilder}}
This is an HTML builder that combines the whole project in one output file.
(Obviously this only works with smaller projects.)  The file is named like
the master document.  No indices will be generated.

Its name is \code{singlehtml}.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.htmlhelp}\index{sphinx.builders.htmlhelp (模块)}\index{HTMLHelpBuilder (sphinx.builders.htmlhelp 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.htmlhelp.HTMLHelpBuilder}\pysigline{\strong{class }\code{sphinx.builders.htmlhelp.}\bfcode{HTMLHelpBuilder}}
This builder produces the same output as the standalone HTML builder, but
also generates HTML Help support files that allow the Microsoft HTML Help
Workshop to compile them into a CHM file.

Its name is \code{htmlhelp}.

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.qthelp}\index{sphinx.builders.qthelp (模块)}\index{QtHelpBuilder (sphinx.builders.qthelp 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.qthelp.QtHelpBuilder}\pysigline{\strong{class }\code{sphinx.builders.qthelp.}\bfcode{QtHelpBuilder}}
This builder produces the same output as the standalone HTML builder, but
also generates \href{http://doc.trolltech.com/4.6/qthelp-framework.html}{Qt help} collection support files that allow
the Qt collection generator to compile them.

Its name is \code{qthelp}.

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.devhelp}\index{sphinx.builders.devhelp (模块)}\index{DevhelpBuilder (sphinx.builders.devhelp 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.devhelp.DevhelpBuilder}\pysigline{\strong{class }\code{sphinx.builders.devhelp.}\bfcode{DevhelpBuilder}}
This builder produces the same output as the standalone HTML builder, but
also generates \href{http://live.gnome.org/devhelp}{GNOME Devhelp}
support file that allows the GNOME Devhelp reader to view them.

Its name is \code{devhelp}.

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.epub}\index{sphinx.builders.epub (模块)}\index{EpubBuilder (sphinx.builders.epub 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.epub.EpubBuilder}\pysigline{\strong{class }\code{sphinx.builders.epub.}\bfcode{EpubBuilder}}
This builder produces the same output as the standalone HTML builder, but
also generates an \emph{epub} file for ebook readers.  See {\hyperref[faq:epub\string-faq]{\crossref{\DUrole{std,std-ref}{Epub info}}}} for
details about it.  For definition of the epub format, have a look at
\url{http://www.idpf.org/specs.htm} or \url{http://en.wikipedia.org/wiki/EPUB}.

Some ebook readers do not show the link targets of references.  Therefore
this builder adds the targets after the link when necessary.  The display
of the URLs can be customized by adding CSS rules for the class
\code{link-target}.

Its name is \code{epub}.

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.latex}\index{sphinx.builders.latex (模块)}\index{LaTeXBuilder (sphinx.builders.latex 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.latex.LaTeXBuilder}\pysigline{\strong{class }\code{sphinx.builders.latex.}\bfcode{LaTeXBuilder}}
This builder produces a bunch of LaTeX files in the output directory.  You
have to specify which documents are to be included in which LaTeX files via
the {\color{red}\bfseries{}:confval:{}`latex\_documents{}`} configuration value.  There are a few
configuration values that customize the output of this builder, see the
chapter {\hyperref[config:latex\string-options]{\crossref{\DUrole{std,std-ref}{Options for LaTeX output}}}} for details.

\begin{notice}{note}{注解:}
The produced LaTeX file uses several LaTeX packages that may not be
present in a ``minimal'' TeX distribution installation.  For TeXLive,
the following packages need to be installed:
\begin{itemize}
\item {} 
latex-recommended

\item {} 
latex-extra

\item {} 
fonts-recommended

\end{itemize}
\end{notice}

Its name is \code{latex}.

\end{fulllineitems}


Note that a direct PDF builder using ReportLab is available in \href{http://rst2pdf.googlecode.com}{rst2pdf} version 0.12 or greater.  You need to add
\code{'rst2pdf.pdfbuilder'} to your {\color{red}\bfseries{}:confval:{}`extensions{}`} to enable it, its name is
\code{pdf}.  Refer to the \href{http://lateral.netmanagers.com.ar/static/manual.pdf}{rst2pdf manual} for details.
\phantomsection\label{builders:module-sphinx.builders.text}\index{sphinx.builders.text (模块)}\index{TextBuilder (sphinx.builders.text 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.text.TextBuilder}\pysigline{\strong{class }\code{sphinx.builders.text.}\bfcode{TextBuilder}}
This builder produces a text file for each reST file -- this is almost the
same as the reST source, but with much of the markup stripped for better
readability.

Its name is \code{text}.

\DUrole{versionmodified}{0.4 新版功能.}

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.manpage}\index{sphinx.builders.manpage (模块)}\index{ManualPageBuilder (sphinx.builders.manpage 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.manpage.ManualPageBuilder}\pysigline{\strong{class }\code{sphinx.builders.manpage.}\bfcode{ManualPageBuilder}}
This builder produces manual pages in the groff format.  You have to specify
which documents are to be included in which manual pages via the
{\color{red}\bfseries{}:confval:{}`man\_pages{}`} configuration value.

Its name is \code{man}.

\begin{notice}{note}{注解:}
This builder requires the docutils manual page writer, which is only
available as of docutils 0.6.
\end{notice}

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.texinfo}\index{sphinx.builders.texinfo (模块)}\index{TexinfoBuilder (sphinx.builders.texinfo 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.texinfo.TexinfoBuilder}\pysigline{\strong{class }\code{sphinx.builders.texinfo.}\bfcode{TexinfoBuilder}}
This builder produces Texinfo files that can be processed into Info files by
the \textbf{\texttt{makeinfo}} program.  You have to specify which documents are to
be included in which Texinfo files via the {\color{red}\bfseries{}:confval:{}`texinfo\_documents{}`}
configuration value.

The Info format is the basis of the on-line help system used by GNU Emacs and
the terminal-based program \textbf{\texttt{info}}.  See {\hyperref[faq:texinfo\string-faq]{\crossref{\DUrole{std,std-ref}{Texinfo info}}}} for more
details.  The Texinfo format is the official documentation system used by the
GNU project.  More information on Texinfo can be found at
\url{http://www.gnu.org/software/texinfo/}.

Its name is \code{texinfo}.

\DUrole{versionmodified}{1.1 新版功能.}

\end{fulllineitems}

\index{SerializingHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SerializingHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{SerializingHTMLBuilder}}
This builder uses a module that implements the Python serialization API
(\titleref{pickle}, \titleref{simplejson}, \titleref{phpserialize}, and others) to dump the generated
HTML documentation.  The pickle builder is a subclass of it.

A concrete subclass of this builder serializing to the \href{http://pypi.python.org/pypi/phpserialize}{PHP serialization}
format could look like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{phpserialize}

\PYG{k}{class} \PYG{n+nc}{PHPSerializedBuilder}\PYG{p}{(}\PYG{n}{SerializingHTMLBuilder}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{phpserialized}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{implementation} \PYG{o}{=} \PYG{n}{phpserialize}
    \PYG{n}{out\PYGZus{}suffix} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.file.phpdump}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{globalcontext\PYGZus{}filename} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{globalcontext.phpdump}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{searchindex\PYGZus{}filename} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{searchindex.phpdump}\PYG{l+s+s1}{\PYGZsq{}}
\end{Verbatim}
\index{implementation (sphinx.builders.html.SerializingHTMLBuilder 属性)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SerializingHTMLBuilder.implementation}\pysigline{\bfcode{implementation}}
A module that implements \titleref{dump()}, \titleref{load()}, \titleref{dumps()} and \titleref{loads()}
functions that conform to the functions with the same names from the
pickle module.  Known modules implementing this interface are
\titleref{simplejson} (or \titleref{json} in Python 2.6), \titleref{phpserialize}, \titleref{plistlib},
and others.

\end{fulllineitems}

\index{out\_suffix (sphinx.builders.html.SerializingHTMLBuilder 属性)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SerializingHTMLBuilder.out_suffix}\pysigline{\bfcode{out\_suffix}}
The suffix for all regular files.

\end{fulllineitems}

\index{globalcontext\_filename (sphinx.builders.html.SerializingHTMLBuilder 属性)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SerializingHTMLBuilder.globalcontext_filename}\pysigline{\bfcode{globalcontext\_filename}}
The filename for the file that contains the ``global context''.  This
is a dict with some general configuration values such as the name
of the project.

\end{fulllineitems}

\index{searchindex\_filename (sphinx.builders.html.SerializingHTMLBuilder 属性)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.SerializingHTMLBuilder.searchindex_filename}\pysigline{\bfcode{searchindex\_filename}}
The filename for the search index Sphinx generates.

\end{fulllineitems}


See {\hyperref[builders:serialization\string-details]{\crossref{\DUrole{std,std-ref}{Serialization builder details}}}} for details about the output format.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\index{PickleHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.PickleHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{PickleHTMLBuilder}}
This builder produces a directory with pickle files containing mostly HTML
fragments and TOC information, for use of a web application (or custom
postprocessing tool) that doesn't use the standard HTML templates.

See {\hyperref[builders:serialization\string-details]{\crossref{\DUrole{std,std-ref}{Serialization builder details}}}} for details about the output format.

Its name is \code{pickle}.  (The old name \code{web} still works as well.)

The file suffix is \code{.fpickle}.  The global context is called
\code{globalcontext.pickle}, the search index \code{searchindex.pickle}.

\end{fulllineitems}

\index{JSONHTMLBuilder (sphinx.builders.html 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.html.JSONHTMLBuilder}\pysigline{\strong{class }\code{sphinx.builders.html.}\bfcode{JSONHTMLBuilder}}
This builder produces a directory with JSON files containing mostly HTML
fragments and TOC information, for use of a web application (or custom
postprocessing tool) that doesn't use the standard HTML templates.

See {\hyperref[builders:serialization\string-details]{\crossref{\DUrole{std,std-ref}{Serialization builder details}}}} for details about the output format.

Its name is \code{json}.

The file suffix is \code{.fjson}.  The global context is called
\code{globalcontext.json}, the search index \code{searchindex.json}.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.gettext}\index{sphinx.builders.gettext (模块)}\index{MessageCatalogBuilder (sphinx.builders.gettext 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.gettext.MessageCatalogBuilder}\pysigline{\strong{class }\code{sphinx.builders.gettext.}\bfcode{MessageCatalogBuilder}}
This builder produces gettext-style message catalogs.  Each top-level file or
subdirectory grows a single \code{.pot} catalog template.

See the documentation on {\hyperref[intl:intl]{\crossref{\DUrole{std,std-ref}{Internationalization}}}} for further reference.

Its name is \code{gettext}.

\DUrole{versionmodified}{1.1 新版功能.}

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.changes}\index{sphinx.builders.changes (模块)}\index{ChangesBuilder (sphinx.builders.changes 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.changes.ChangesBuilder}\pysigline{\strong{class }\code{sphinx.builders.changes.}\bfcode{ChangesBuilder}}
This builder produces an HTML overview of all {\hyperref[markup/para:directive\string-versionadded]{\crossref{\code{versionadded}}}},
{\hyperref[markup/para:directive\string-versionchanged]{\crossref{\code{versionchanged}}}} and {\hyperref[markup/para:directive\string-deprecated]{\crossref{\code{deprecated}}}} directives for the current
{\color{red}\bfseries{}:confval:{}`version{}`}.  This is useful to generate a ChangeLog file, for
example.

Its name is \code{changes}.

\end{fulllineitems}

\phantomsection\label{builders:module-sphinx.builders.linkcheck}\index{sphinx.builders.linkcheck (模块)}\index{CheckExternalLinksBuilder (sphinx.builders.linkcheck 中的类)}

\begin{fulllineitems}
\phantomsection\label{builders:sphinx.builders.linkcheck.CheckExternalLinksBuilder}\pysigline{\strong{class }\code{sphinx.builders.linkcheck.}\bfcode{CheckExternalLinksBuilder}}
This builder scans all documents for external links, tries to open them with
\code{urllib2}, and writes an overview which ones are broken and redirected
to standard output and to \code{output.txt} in the output directory.

Its name is \code{linkcheck}.

\end{fulllineitems}


Built-in Sphinx extensions that offer more builders are:
\begin{itemize}
\item {} 
{\hyperref[ext/doctest:module\string-sphinx.ext.doctest]{\crossref{\code{doctest}}}}

\item {} 
{\hyperref[ext/coverage:module\string-sphinx.ext.coverage]{\crossref{\code{coverage}}}}

\end{itemize}


\section{Serialization builder details}
\label{builders:serialization-builder-details}\label{builders:serialization-details}
All serialization builders outputs one file per source file and a few special
files.  They also copy the reST source files in the directory \code{\_sources}
under the output directory.

The {\hyperref[builders:sphinx.builders.html.PickleHTMLBuilder]{\crossref{\code{PickleHTMLBuilder}}}} is a builtin subclass that implements the pickle
serialization interface.

The files per source file have the extensions of
{\hyperref[builders:sphinx.builders.html.SerializingHTMLBuilder.out_suffix]{\crossref{\code{out\_suffix}}}}, and are arranged in directories
just as the source files are.  They unserialize to a dictionary (or dictionary
like structure) with these keys:
\begin{description}
\item[{\code{body}}] \leavevmode
The HTML ``body'' (that is, the HTML rendering of the source file), as rendered
by the HTML translator.

\item[{\code{title}}] \leavevmode
The title of the document, as HTML (may contain markup).

\item[{\code{toc}}] \leavevmode
The table of contents for the file, rendered as an HTML \code{\textless{}ul\textgreater{}}.

\item[{\code{display\_toc}}] \leavevmode
A boolean that is \code{True} if the \code{toc} contains more than one entry.

\item[{\code{current\_page\_name}}] \leavevmode
The document name of the current file.

\item[{\code{parents}, \code{prev} and \code{next}}] \leavevmode
Information about related chapters in the TOC tree.  Each relation is a
dictionary with the keys \code{link} (HREF for the relation) and \code{title}
(title of the related document, as HTML).  \code{parents} is a list of
relations, while \code{prev} and \code{next} are a single relation.

\item[{\code{sourcename}}] \leavevmode
The name of the source file under \code{\_sources}.

\end{description}

The special files are located in the root output directory.  They are:
\begin{description}
\item[{{\hyperref[builders:sphinx.builders.html.SerializingHTMLBuilder.globalcontext_filename]{\crossref{\code{SerializingHTMLBuilder.globalcontext\_filename}}}}}] \leavevmode
A pickled dict with these keys:
\begin{description}
\item[{\code{project}, \code{copyright}, \code{release}, \code{version}}] \leavevmode
The same values as given in the configuration file.

\item[{\code{style}}] \leavevmode
{\color{red}\bfseries{}:confval:{}`html\_style{}`}.

\item[{\code{last\_updated}}] \leavevmode
Date of last build.

\item[{\code{builder}}] \leavevmode
Name of the used builder, in the case of pickles this is always
\code{'pickle'}.

\item[{\code{titles}}] \leavevmode
A dictionary of all documents' titles, as HTML strings.

\end{description}

\item[{{\hyperref[builders:sphinx.builders.html.SerializingHTMLBuilder.searchindex_filename]{\crossref{\code{SerializingHTMLBuilder.searchindex\_filename}}}}}] \leavevmode
An index that can be used for searching the documentation.  It is a pickled
list with these entries:
\begin{itemize}
\item {} 
A list of indexed docnames.

\item {} 
A list of document titles, as HTML strings, in the same order as the first
list.

\item {} 
A dict mapping word roots (processed by an English-language stemmer) to a
list of integers, which are indices into the first list.

\end{itemize}

\item[{\code{environment.pickle}}] \leavevmode
The build environment.  This is always a pickle file, independent of the
builder and a copy of the environment that was used when the builder was
started.

Unlike the other pickle files this pickle file requires that the \code{sphinx}
package is available on unpickling.

\end{description}


\chapter{The build configuration file}
\label{config:module-conf}\label{config:build-config}\label{config:the-build-configuration-file}\label{config::doc}\index{conf (模块)}
The {\hyperref[glossary:term\string-configuration\string-directory]{\termref{\DUrole{xref,std,std-term}{configuration directory}}}} must contain a file named \code{conf.py}.
This file (containing Python code) is called the ``build configuration file'' and
contains all configuration needed to customize Sphinx input and output behavior.

The configuration file is executed as Python code at build time (using
\code{execfile()}, and with the current directory set to its containing
directory), and therefore can execute arbitrarily complex code.  Sphinx then
reads simple names from the file's namespace as its configuration.

Important points to note:
\begin{itemize}
\item {} 
If not otherwise documented, values must be strings, and their default is the
empty string.

\item {} 
The term ``fully-qualified name'' refers to a string that names an importable
Python object inside a module; for example, the FQN
\code{"sphinx.builders.Builder"} means the \code{Builder} class in the
\code{sphinx.builders} module.

\item {} 
Remember that document names use \code{/} as the path separator and don't contain
the file name extension.

\item {} 
Since \code{conf.py} is read as a Python file, the usual rules apply for
encodings and Unicode support: declare the encoding using an encoding cookie
(a comment like \code{\# -*- coding: utf-8 -*-}) and use Unicode string literals
when you include non-ASCII characters in configuration values.

\item {} 
The contents of the config namespace are pickled (so that Sphinx can find out
when configuration changes), so it may not contain unpickleable values --
delete them from the namespace with \code{del} if appropriate.  Modules are
removed automatically, so you don't need to \code{del} your imports after use.

\item {} 
There is a special object named \code{tags} available in the config file.
It can be used to query and change the tags (see {\hyperref[markup/misc:tags]{\crossref{\DUrole{std,std-ref}{包含基于标签的内容}}}}).  Use
\code{tags.has('tag')} to query, \code{tags.add('tag')} and \code{tags.remove('tag')}
to change.

\end{itemize}


\section{General configuration}
\label{config:general-configuration}

\section{Project information}
\label{config:project-information}

\section{Options for internationalization}
\label{config:options-for-internationalization}\label{config:intl-options}
These options influence Sphinx' \emph{Native Language Support}.  See the
documentation on {\hyperref[intl:intl]{\crossref{\DUrole{std,std-ref}{Internationalization}}}} for details.


\section{Options for HTML output}
\label{config:options-for-html-output}\label{config:html-options}
These options influence HTML as well as HTML Help output, and other builders
that use Sphinx' HTMLWriter class.


\section{Options for epub output}
\label{config:epub-options}\label{config:options-for-epub-output}
These options influence the epub output.  As this builder derives from the HTML
builder, the HTML options also apply where appropriate.  The actual values for
some of the options is not really important, they just have to be entered into
the \href{http://dublincore.org/}{Dublin Core metadata}.


\section{Options for LaTeX output}
\label{config:options-for-latex-output}\label{config:latex-options}
These options influence LaTeX output.


\section{Options for text output}
\label{config:text-options}\label{config:options-for-text-output}
These options influence text output.


\section{Options for manual page output}
\label{config:man-options}\label{config:options-for-manual-page-output}
These options influence manual page output.


\section{Options for Texinfo output}
\label{config:texinfo-options}\label{config:options-for-texinfo-output}
These options influence Texinfo output.


\section{Options for the linkcheck builder}
\label{config:options-for-the-linkcheck-builder}

\chapter{Internationalization}
\label{intl:intl}\label{intl:internationalization}\label{intl::doc}
\DUrole{versionmodified}{1.1 新版功能.}

Complementary to translations provided for Sphinx-generated messages such as
navigation bars, Sphinx provides mechanisms facilitating \emph{document} translations
in itself.  See the {\hyperref[config:intl\string-options]{\crossref{\DUrole{std,std-ref}{Options for internationalization}}}} for details on configuration.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics[width=1.000\linewidth]{{translation}.png}
\caption{Workflow visualization of translations in Sphinx.  (The stick-figure is taken
from an \href{http://xkcd.com/779/}{XKCD comic}.)}\label{intl:id13}\end{figure}

\textbf{gettext} \footnote[1]{\sphinxAtStartFootnote%
See the \href{http://www.gnu.org/software/gettext/manual/gettext.html\#Introduction}{GNU gettext utilites}
for details on that software suite.
} is an established standard for internationalization and
localization.  It naïvely maps messages in a program to a translated string.
Sphinx uses these facilities to translate whole documents.

Initially project maintainers have to collect all translatable strings (also
referred to as \emph{messages}) to make them known to translators.  Sphinx extracts
these through invocation of \code{sphinx-build -b gettext}.

Every single element in the doctree will end up in a single message which
results in lists being equally split into different chunks while large
paragraphs will remain as coarsely-grained as they were in the original
document.  This grants seamless document updates while still providing a little
bit of context for translators in free-text passages.  It is the maintainer's
task to split up paragraphs which are too large as there is no sane automated
way to do that.

After Sphinx successfully ran the
{\hyperref[builders:sphinx.builders.gettext.MessageCatalogBuilder]{\crossref{\code{MessageCatalogBuilder}}}} you will find a collection
of \code{.pot} files in your output directory.  These are \textbf{catalog templates}
and contain messages in your original language \emph{only}.

They can be delivered to translators which will transform them to \code{.po} files
--- so called \textbf{message catalogs} --- containing a mapping from the original
messages to foreign-language strings.

Gettext compiles them into a binary format known as \textbf{binary catalogs} through
\textbf{\texttt{msgfmt}} for efficiency reasons.  If you make these files discoverable
with {\color{red}\bfseries{}:confval:{}`locale\_dirs{}`} for your {\color{red}\bfseries{}:confval:{}`language{}`}, Sphinx will pick them
up automatically.

An example: you have a document \code{usage.rst} in your Sphinx project.  The
gettext builder will put its messages into \code{usage.pot}.  Imagine you have
Spanish translations \footnote[2]{\sphinxAtStartFootnote%
Because nobody expects the Spanish Inquisition!
} on your hands in \code{usage.po} --- for your builds to
be translated you need to follow these instructions:
\begin{itemize}
\item {} 
Compile your message catalog to a locale directory, say \code{translated}, so it
ends up in \code{./translated/es/LC\_MESSAGES/usage.mo} in your source directory
(where \code{es} is the language code for Spanish.)

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{msgfmt} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{usage.po}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{o} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{translated/es/LC\PYGZus{}MESSAGES/usage.mo}\PYG{l+s+s2}{\PYGZdq{}}
\end{Verbatim}

\item {} 
Set {\color{red}\bfseries{}:confval:{}`locale\_dirs{}`} to \code{{[}"translated/"{]}}.

\item {} 
Set {\color{red}\bfseries{}:confval:{}`language{}`} to \code{es} (also possible via \code{-D}).

\item {} 
Run your desired build.

\end{itemize}


\chapter{HTML theming support}
\label{theming:html-theming-support}\label{theming::doc}
\DUrole{versionmodified}{0.6 新版功能.}

Sphinx supports changing the appearance of its HTML output via \emph{themes}.  A
theme is a collection of HTML templates, stylesheet(s) and other static files.
Additionally, it has a configuration file which specifies from which theme to
inherit, which highlighting style to use, and what options exist for customizing
the theme's look and feel.

Themes are meant to be project-unaware, so they can be used for different
projects without change.


\section{Using a theme}
\label{theming:using-a-theme}
Using an existing theme is easy.  If the theme is builtin to Sphinx, you only
need to set the {\color{red}\bfseries{}:confval:{}`html\_theme{}`} config value.  With the
{\color{red}\bfseries{}:confval:{}`html\_theme\_options{}`} config value you can set theme-specific options
that change the look and feel.  For example, you could have the following in
your \code{conf.py}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{html\PYGZus{}theme} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{default}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{html\PYGZus{}theme\PYGZus{}options} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rightsidebar}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{true}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{relbarbgcolor}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{\PYGZcb{}}
\end{Verbatim}

That would give you the default theme, but with a sidebar on the right side and
a black background for the relation bar (the bar with the navigation links at
the page's top and bottom).

If the theme does not come with Sphinx, it can be in two forms: either a
directory (containing \code{theme.conf} and other needed files), or a zip file
with the same contents.  Either of them must be put where Sphinx can find it;
for this there is the config value {\color{red}\bfseries{}:confval:{}`html\_theme\_path{}`}.  It gives a list
of directories, relative to the directory containing \code{conf.py}, that can
contain theme directories or zip files.  For example, if you have a theme in the
file \code{blue.zip}, you can put it right in the directory containing
\code{conf.py} and use this configuration:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{html\PYGZus{}theme} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{blue}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{html\PYGZus{}theme\PYGZus{}path} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
\end{Verbatim}


\section{Builtin themes}
\label{theming:builtin-themes}\label{theming:id7}
\begin{tabular}{|p{0.475\linewidth}|p{0.475\linewidth}|}
\hline

\textbf{Theme overview}
 & \\
\hline
\includegraphics{{default}.png}

\emph{default}
 & 
\includegraphics{{sphinxdoc}.png}

\emph{sphinxdoc}
\\
\hline
\includegraphics{{scrolls}.png}

\emph{scrolls}
 & 
\includegraphics{{agogo}.png}

\emph{agogo}
\\
\hline
\includegraphics{{traditional}.png}

\emph{traditional}
 & 
\includegraphics{{nature}.png}

\emph{nature}
\\
\hline
\includegraphics{{haiku}.png}

\emph{haiku}
 & 
\includegraphics{{pyramid}.png}

\emph{pyramid}
\\
\hline\end{tabular}


Sphinx comes with a selection of themes to choose from.

These themes are:
\begin{itemize}
\item {} 
\textbf{basic} -- This is a basically unstyled layout used as the base for the
other themes, and usable as the base for custom themes as well.  The HTML
contains all important elements like sidebar and relation bar.  There are
these options (which are inherited by the other themes):
\begin{itemize}
\item {} 
\textbf{nosidebar} (true or false): Don't include the sidebar.  Defaults to
false.

\item {} 
\textbf{sidebarwidth} (an integer): Width of the sidebar in pixels.  (Do not
include \code{px} in the value.)  Defaults to 230 pixels.

\end{itemize}

\item {} 
\textbf{default} -- This is the default theme, which looks like \href{http://docs.python.org/}{the Python
documentation}.  It can be customized via these
options:
\begin{itemize}
\item {} 
\textbf{rightsidebar} (true or false): Put the sidebar on the right side.
Defaults to false.

\item {} 
\textbf{stickysidebar} (true or false): Make the sidebar ``fixed'' so that it
doesn't scroll out of view for long body content.  This may not work well
with all browsers.  Defaults to false.

\item {} 
\textbf{collapsiblesidebar} (true or false): Add an \emph{experimental} JavaScript
snippet that makes the sidebar collapsible via a button on its side.
\emph{Doesn't work together with ``rightsidebar'' or ``stickysidebar''.} Defaults to
false.

\item {} 
\textbf{externalrefs} (true or false): Display external links differently from
internal links.  Defaults to false.

\end{itemize}

There are also various color and font options that can change the color scheme
without having to write a custom stylesheet:
\begin{itemize}
\item {} 
\textbf{footerbgcolor} (CSS color): Background color for the footer line.

\item {} 
\textbf{footertextcolor} (CSS color): Text color for the footer line.

\item {} 
\textbf{sidebarbgcolor} (CSS color): Background color for the sidebar.

\item {} 
\textbf{sidebarbtncolor} (CSS color): Background color for the sidebar collapse
button (used when \emph{collapsiblesidebar} is true).

\item {} 
\textbf{sidebartextcolor} (CSS color): Text color for the sidebar.

\item {} 
\textbf{sidebarlinkcolor} (CSS color): Link color for the sidebar.

\item {} 
\textbf{relbarbgcolor} (CSS color): Background color for the relation bar.

\item {} 
\textbf{relbartextcolor} (CSS color): Text color for the relation bar.

\item {} 
\textbf{relbarlinkcolor} (CSS color): Link color for the relation bar.

\item {} 
\textbf{bgcolor} (CSS color): Body background color.

\item {} 
\textbf{textcolor} (CSS color): Body text color.

\item {} 
\textbf{linkcolor} (CSS color): Body link color.

\item {} 
\textbf{visitedlinkcolor} (CSS color): Body color for visited links.

\item {} 
\textbf{headbgcolor} (CSS color): Background color for headings.

\item {} 
\textbf{headtextcolor} (CSS color): Text color for headings.

\item {} 
\textbf{headlinkcolor} (CSS color): Link color for headings.

\item {} 
\textbf{codebgcolor} (CSS color): Background color for code blocks.

\item {} 
\textbf{codetextcolor} (CSS color): Default text color for code blocks, if not
set differently by the highlighting style.

\item {} 
\textbf{bodyfont} (CSS font-family): Font for normal text.

\item {} 
\textbf{headfont} (CSS font-family): Font for headings.

\end{itemize}

\item {} 
\textbf{sphinxdoc} -- The theme used for this documentation.  It features a sidebar
on the right side.  There are currently no options beyond \emph{nosidebar} and
\emph{sidebarwidth}.

\item {} 
\textbf{scrolls} -- A more lightweight theme, based on \href{http://jinja.pocoo.org/}{the Jinja documentation}.  The following color options are available:
\begin{itemize}
\item {} 
\textbf{headerbordercolor}

\item {} 
\textbf{subheadlinecolor}

\item {} 
\textbf{linkcolor}

\item {} 
\textbf{visitedlinkcolor}

\item {} 
\textbf{admonitioncolor}

\end{itemize}

\item {} 
\textbf{agogo} -- A theme created by Andi Albrecht.  The following options are
supported:
\begin{itemize}
\item {} 
\textbf{bodyfont} (CSS font family): Font for normal text.

\item {} 
\textbf{headerfont} (CSS font family): Font for headings.

\item {} 
\textbf{pagewidth} (CSS length): Width of the page content, default 70em.

\item {} 
\textbf{documentwidth} (CSS length): Width of the document (without sidebar),
default 50em.

\item {} 
\textbf{sidebarwidth} (CSS length): Width of the sidebar, default 20em.

\item {} 
\textbf{bgcolor} (CSS color): Background color.

\item {} 
\textbf{headerbg} (CSS value for ``background''): background for the header area,
default a grayish gradient.

\item {} 
\textbf{footerbg} (CSS value for ``background''): background for the footer area,
default a light gray gradient.

\item {} 
\textbf{linkcolor} (CSS color): Body link color.

\item {} 
\textbf{headercolor1}, \textbf{headercolor2} (CSS color): colors for \textless{}h1\textgreater{} and \textless{}h2\textgreater{}
headings.

\item {} 
\textbf{headerlinkcolor} (CSS color): Color for the backreference link in
headings.

\item {} 
\textbf{textalign} (CSS \emph{text-align} value): Text alignment for the body, default
is \code{justify}.

\end{itemize}

\item {} 
\textbf{nature} -- A greenish theme.  There are currently no options beyond
\emph{nosidebar} and \emph{sidebarwidth}.

\item {} 
\textbf{pyramid} -- A theme from the Pyramid web framework project, designed by
Blaise Laflamme.  There are currently no options beyond \emph{nosidebar} and
\emph{sidebarwidth}.

\item {} 
\textbf{haiku} -- A theme without sidebar inspired by the \href{http://www.haiku-os.org/docs/userguide/en/contents.html}{Haiku OS user guide}.  The following
options are supported:
\begin{itemize}
\item {} 
\textbf{full\_logo} (true or false, default false): If this is true, the header
will only show the {\color{red}\bfseries{}:confval:{}`html\_logo{}`}.  Use this for large logos.  If this
is false, the logo (if present) will be shown floating right, and the
documentation title will be put in the header.

\item {} 
\textbf{textcolor}, \textbf{headingcolor}, \textbf{linkcolor}, \textbf{visitedlinkcolor},
\textbf{hoverlinkcolor} (CSS colors): Colors for various body elements.

\end{itemize}

\item {} 
\textbf{traditional} -- A theme resembling the old Python documentation.  There are
currently no options beyond \emph{nosidebar} and \emph{sidebarwidth}.

\item {} 
\textbf{epub} -- A theme for the epub builder.  There are currently no options.
This theme tries to save visual space which is a sparse resource on ebook
readers.

\end{itemize}


\section{Creating themes}
\label{theming:creating-themes}
As said, themes are either a directory or a zipfile (whose name is the theme
name), containing the following:
\begin{itemize}
\item {} 
A \code{theme.conf} file, see below.

\item {} 
HTML templates, if needed.

\item {} 
A \code{static/} directory containing any static files that will be copied to the
output static directory on build.  These can be images, styles, script files.

\end{itemize}

The \code{theme.conf} file is in INI format \footnote[1]{\sphinxAtStartFootnote%
It is not an executable Python file, as opposed to \code{conf.py},
because that would pose an unnecessary security risk if themes are
shared.
} (readable by the standard
Python \code{ConfigParser} module) and has the following structure:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{[theme]}
\PYG{n+na}{inherit} \PYG{o}{=} \PYG{l+s}{base theme}
\PYG{n+na}{stylesheet} \PYG{o}{=} \PYG{l+s}{main CSS name}
\PYG{n+na}{pygments\PYGZus{}style} \PYG{o}{=} \PYG{l+s}{stylename}

\PYG{k}{[options]}
\PYG{n+na}{variable} \PYG{o}{=} \PYG{l+s}{default value}
\end{Verbatim}
\begin{itemize}
\item {} 
The \textbf{inherit} setting gives the name of a ``base theme'', or \code{none}.  The
base theme will be used to locate missing templates (most themes will not have
to supply most templates if they use \code{basic} as the base theme), its options
will be inherited, and all of its static files will be used as well.

\item {} 
The \textbf{stylesheet} setting gives the name of a CSS file which will be
referenced in the HTML header.  If you need more than one CSS file, either
include one from the other via CSS' \code{@import}, or use a custom HTML template
that adds \code{\textless{}link rel="stylesheet"\textgreater{}} tags as necessary.  Setting the
{\color{red}\bfseries{}:confval:{}`html\_style{}`} config value will override this setting.

\item {} 
The \textbf{pygments\_style} setting gives the name of a Pygments style to use for
highlighting.  This can be overridden by the user in the
{\color{red}\bfseries{}:confval:{}`pygments\_style{}`} config value.

\item {} 
The \textbf{options} section contains pairs of variable names and default values.
These options can be overridden by the user in {\color{red}\bfseries{}:confval:{}`html\_theme\_options{}`}
and are accessible from all templates as \code{theme\_\textless{}name\textgreater{}}.

\end{itemize}


\subsection{Templating}
\label{theming:templating}
The {\hyperref[templating::doc]{\crossref{\DUrole{doc}{guide to templating}}}} is helpful if you want to write your
own templates.  What is important to keep in mind is the order in which Sphinx
searches for templates:
\begin{itemize}
\item {} 
First, in the user's \code{templates\_path} directories.

\item {} 
Then, in the selected theme.

\item {} 
Then, in its base theme, its base's base theme, etc.

\end{itemize}

When extending a template in the base theme with the same name, use the theme
name as an explicit directory: \code{\{\% extends "basic/layout.html" \%\}}.  From a
user \code{templates\_path} template, you can still use the ``exclamation mark''
syntax as described in the templating document.


\subsection{Static templates}
\label{theming:static-templates}
Since theme options are meant for the user to configure a theme more easily,
without having to write a custom stylesheet, it is necessary to be able to
template static files as well as HTML files.  Therefore, Sphinx supports
so-called ``static templates'', like this:

If the name of a file in the \code{static/} directory of a theme (or in the user's
static path, for that matter) ends with \code{\_t}, it will be processed by the
template engine.  The \code{\_t} will be left from the final file name.  For
example, the \emph{default} theme has a file \code{static/default.css\_t} which uses
templating to put the color options into the stylesheet.  When a documentation
is built with the default theme, the output directory will contain a
\code{\_static/default.css} file where all template tags have been processed.


\chapter{Templating}
\label{templating:id1}\label{templating:templating}\label{templating::doc}
Sphinx uses the \href{http://jinja.pocoo.org}{Jinja} templating engine for its HTML
templates.  Jinja is a text-based engine, and inspired by Django templates, so
anyone having used Django will already be familiar with it.  It also has
excellent documentation for those who need to make themselves familiar with it.


\section{Do I need to use Sphinx' templates to produce HTML?}
\label{templating:do-i-need-to-use-sphinx-templates-to-produce-html}
No.  You have several other options:
\begin{itemize}
\item {} 
You can write a \code{TemplateBridge} subclass that
calls your template engine of choice, and set the {\color{red}\bfseries{}:confval:{}`template\_bridge{}`}
configuration value accordingly.

\item {} 
You can {\hyperref[ext/builderapi:writing\string-builders]{\crossref{\DUrole{std,std-ref}{write a custom builder}}}} that derives from
{\hyperref[builders:sphinx.builders.html.StandaloneHTMLBuilder]{\crossref{\code{StandaloneHTMLBuilder}}}} and calls your template
engine of choice.

\item {} 
You can use the {\hyperref[builders:sphinx.builders.html.PickleHTMLBuilder]{\crossref{\code{PickleHTMLBuilder}}}} that produces
pickle files with the page contents, and postprocess them using a custom tool,
or use them in your Web application.

\end{itemize}


\section{Jinja/Sphinx Templating Primer}
\label{templating:jinja-sphinx-templating-primer}
The default templating language in Sphinx is Jinja.  It's Django/Smarty inspired
and easy to understand.  The most important concept in Jinja is \emph{template
inheritance}, which means that you can overwrite only specific blocks within a
template, customizing it while also keeping the changes at a minimum.

To customize the output of your documentation you can override all the templates
(both the layout templates and the child templates) by adding files with the
same name as the original filename into the template directory of the structure
the Sphinx quickstart generated for you.

Sphinx will look for templates in the folders of {\color{red}\bfseries{}:confval:{}`templates\_path{}`}
first, and if it can't find the template it's looking for there, it falls back
to the selected theme's templates.

A template contains \textbf{variables}, which are replaced with values when the
template is evaluated, \textbf{tags}, which control the logic of the template and
\textbf{blocks} which are used for template inheritance.

Sphinx' \emph{basic} theme provides base templates with a couple of blocks it will
fill with data.  These are located in the \code{themes/basic} subdirectory of
the Sphinx installation directory, and used by all builtin Sphinx themes.
Templates with the same name in the {\color{red}\bfseries{}:confval:{}`templates\_path{}`} override templates
supplied by the selected theme.

For example, to add a new link to the template area containing related links all
you have to do is to add a new template called \code{layout.html} with the
following contents:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{extends} \PYG{l+s+s2}{\PYGZdq{}!layout.html\PYGZdq{}} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{rootrellink} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{li}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{n+nt}{a} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}http://project.invalid/\PYGZdq{}}\PYG{p}{\PYGZgt{}}Project Homepage\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{a}\PYG{p}{\PYGZgt{}} \PYG{n+ni}{\PYGZam{}raquo;}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{li}\PYG{p}{\PYGZgt{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nb}{super}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

By prefixing the name of the overridden template with an exclamation mark,
Sphinx will load the layout template from the underlying HTML theme.

\textbf{Important}: If you override a block, call \code{\{\{ super() \}\}} somewhere to
render the block's content in the extended template -- unless you don't want
that content to show up.


\section{Working with the builtin templates}
\label{templating:working-with-the-builtin-templates}
The builtin \textbf{basic} theme supplies the templates that all builtin Sphinx
themes are based on.  It has the following elements you can override or use:


\subsection{Blocks}
\label{templating:blocks}
The following blocks exist in the \code{layout.html} template:
\begin{description}
\item[{\titleref{doctype}}] \leavevmode
The doctype of the output format.  By default this is XHTML 1.0 Transitional
as this is the closest to what Sphinx and Docutils generate and it's a good
idea not to change it unless you want to switch to HTML 5 or a different but
compatible XHTML doctype.

\item[{\titleref{linktags}}] \leavevmode
This block adds a couple of \code{\textless{}link\textgreater{}} tags to the head section of the
template.

\item[{\titleref{extrahead}}] \leavevmode
This block is empty by default and can be used to add extra contents into
the \code{\textless{}head\textgreater{}} tag of the generated HTML file.  This is the right place to
add references to JavaScript or extra CSS files.

\item[{\titleref{relbar1} / \titleref{relbar2}}] \leavevmode
This block contains the \emph{relation bar}, the list of related links (the
parent documents on the left, and the links to index, modules etc. on the
right).  \titleref{relbar1} appears before the document, \titleref{relbar2} after the
document.  By default, both blocks are filled; to show the relbar only
before the document, you would override \titleref{relbar2} like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{relbar2} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

\item[{\titleref{rootrellink} / \titleref{relbaritems}}] \leavevmode
Inside the relbar there are three sections: The \titleref{rootrellink}, the links
from the documentation and the custom \titleref{relbaritems}.  The \titleref{rootrellink} is a
block that by default contains a list item pointing to the master document
by default, the \titleref{relbaritems} is an empty block.  If you override them to
add extra links into the bar make sure that they are list items and end with
the {\hyperref[templating:reldelim1]{\crossref{\code{reldelim1}}}}.

\item[{\titleref{document}}] \leavevmode
The contents of the document itself.  It contains the block ``body'' where the
individual content is put by subtemplates like \code{page.html}.

\item[{\titleref{sidebar1} / \titleref{sidebar2}}] \leavevmode
A possible location for a sidebar.  \titleref{sidebar1} appears before the document
and is empty by default, \titleref{sidebar2} after the document and contains the
default sidebar.  If you want to swap the sidebar location override this and
call the \titleref{sidebar} helper:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{sidebar1} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}\PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{sidebar}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{sidebar2} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

(The \titleref{sidebar2} location for the sidebar is needed by the \code{sphinxdoc.css}
stylesheet, for example.)

\item[{\titleref{sidebarlogo}}] \leavevmode
The logo location within the sidebar.  Override this if you want to place
some content at the top of the sidebar.

\item[{\titleref{footer}}] \leavevmode
The block for the footer div.  If you want a custom footer or markup before
or after it, override this one.

\end{description}

The following four blocks are \emph{only} used for pages that do not have assigned a
list of custom sidebars in the {\color{red}\bfseries{}:confval:{}`html\_sidebars{}`} config value.  Their use
is deprecated in favor of separate sidebar templates, which can be included via
{\color{red}\bfseries{}:confval:{}`html\_sidebars{}`}.
\begin{description}
\item[{\titleref{sidebartoc}}] \leavevmode
The table of contents within the sidebar.

\DUrole{versionmodified}{1.0 版后已移除.}

\item[{\titleref{sidebarrel}}] \leavevmode
The relation links (previous, next document) within the sidebar.

\DUrole{versionmodified}{1.0 版后已移除.}

\item[{\titleref{sidebarsourcelink}}] \leavevmode
The ``Show source'' link within the sidebar (normally only shown if this is
enabled by {\color{red}\bfseries{}:confval:{}`html\_show\_sourcelink{}`}).

\DUrole{versionmodified}{1.0 版后已移除.}

\item[{\titleref{sidebarsearch}}] \leavevmode
The search box within the sidebar.  Override this if you want to place some
content at the bottom of the sidebar.

\DUrole{versionmodified}{1.0 版后已移除.}

\end{description}


\subsection{Configuration Variables}
\label{templating:configuration-variables}
Inside templates you can set a couple of variables used by the layout template
using the \code{\{\% set \%\}} tag:
\index{reldelim1 (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:reldelim1}\pysigline{\bfcode{reldelim1}}
The delimiter for the items on the left side of the related bar.  This
defaults to \code{' \&raquo;'} Each item in the related bar ends with the value
of this variable.

\end{fulllineitems}

\index{reldelim2 (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:reldelim2}\pysigline{\bfcode{reldelim2}}
The delimiter for the items on the right side of the related bar.  This
defaults to \code{' \textbar{}'}.  Each item except of the last one in the related bar
ends with the value of this variable.

\end{fulllineitems}


Overriding works like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{extends} \PYG{l+s+s2}{\PYGZdq{}!layout.html\PYGZdq{}} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{set} \PYG{n+nv}{reldelim1} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{} \PYGZam{}gt;\PYGZsq{}} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}
\index{script\_files (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:script_files}\pysigline{\bfcode{script\_files}}
Add additional script files here, like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{set} \PYG{n+nv}{script\PYGZus{}files} \PYG{o}{=} \PYG{n+nv}{script\PYGZus{}files} \PYG{o}{+} \PYG{o}{[}\PYG{l+s+s2}{\PYGZdq{}\PYGZus{}static/myscript.js\PYGZdq{}}\PYG{o}{]} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

\end{fulllineitems}

\index{css\_files (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:css_files}\pysigline{\bfcode{css\_files}}
Similar to {\hyperref[templating:script_files]{\crossref{\code{script\_files}}}}, for CSS files.

\end{fulllineitems}



\subsection{Helper Functions}
\label{templating:helper-functions}
Sphinx provides various Jinja functions as helpers in the template.  You can use
them to generate links or output multiply used elements.
\index{pathto() (內置函数)}

\begin{fulllineitems}
\phantomsection\label{templating:pathto}\pysiglinewithargsret{\bfcode{pathto}}{\emph{document}}{}
Return the path to a Sphinx document as a URL.  Use this to refer to built
documents.

\end{fulllineitems}

\index{pathto() (內置函数)}

\begin{fulllineitems}
\pysiglinewithargsret{\bfcode{pathto}}{\emph{file}, \emph{1}}{}
Return the path to a \emph{file} which is a filename relative to the root of the
generated output.  Use this to refer to static files.

\end{fulllineitems}

\index{hasdoc() (內置函数)}

\begin{fulllineitems}
\phantomsection\label{templating:hasdoc}\pysiglinewithargsret{\bfcode{hasdoc}}{\emph{document}}{}
Check if a document with the name \emph{document} exists.

\end{fulllineitems}

\index{sidebar() (內置函数)}

\begin{fulllineitems}
\phantomsection\label{templating:sidebar}\pysiglinewithargsret{\bfcode{sidebar}}{}{}
Return the rendered sidebar.

\end{fulllineitems}

\index{relbar() (內置函数)}

\begin{fulllineitems}
\phantomsection\label{templating:relbar}\pysiglinewithargsret{\bfcode{relbar}}{}{}
Return the rendered relation bar.

\end{fulllineitems}



\subsection{Global Variables}
\label{templating:global-variables}
These global variables are available in every template and are safe to use.
There are more, but most of them are an implementation detail and might change
in the future.
\index{builder (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:builder}\pysigline{\bfcode{builder}}
The name of the builder (e.g. \code{html} or \code{htmlhelp}).

\end{fulllineitems}

\index{copyright (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:copyright}\pysigline{\bfcode{copyright}}
The value of {\color{red}\bfseries{}:confval:{}`copyright{}`}.

\end{fulllineitems}

\index{docstitle (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:docstitle}\pysigline{\bfcode{docstitle}}
The title of the documentation (the value of {\color{red}\bfseries{}:confval:{}`html\_title{}`}).

\end{fulllineitems}

\index{embedded (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:embedded}\pysigline{\bfcode{embedded}}
True if the built HTML is meant to be embedded in some viewing application
that handles navigation, not the web browser, such as for HTML help or Qt
help formats.  In this case, the sidebar is not included.

\end{fulllineitems}

\index{favicon (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:favicon}\pysigline{\bfcode{favicon}}
The path to the HTML favicon in the static path, or \code{'{'}}.

\end{fulllineitems}

\index{file\_suffix (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:file_suffix}\pysigline{\bfcode{file\_suffix}}
The value of the builder's {\hyperref[builders:sphinx.builders.html.SerializingHTMLBuilder.out_suffix]{\crossref{\code{out\_suffix}}}}
attribute, i.e. the file name extension that the output files will get.  For
a standard HTML builder, this is usually \code{.html}.

\end{fulllineitems}

\index{has\_source (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:has_source}\pysigline{\bfcode{has\_source}}
True if the reST document sources are copied (if {\color{red}\bfseries{}:confval:{}`html\_copy\_source{}`}
is true).

\end{fulllineitems}

\index{last\_updated (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:last_updated}\pysigline{\bfcode{last\_updated}}
The build date.

\end{fulllineitems}

\index{logo (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:logo}\pysigline{\bfcode{logo}}
The path to the HTML logo image in the static path, or \code{'{'}}.

\end{fulllineitems}

\index{master\_doc (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:master_doc}\pysigline{\bfcode{master\_doc}}
The value of {\color{red}\bfseries{}:confval:{}`master\_doc{}`}, for usage with {\hyperref[templating:pathto]{\crossref{\code{pathto()}}}}.

\end{fulllineitems}

\index{next (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:next}\pysigline{\bfcode{next}}
The next document for the navigation.  This variable is either false or has
two attributes \titleref{link} and \titleref{title}.  The title contains HTML markup.  For
example, to generate a link to the next page, you can use this snippet:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{if} \PYG{n+nv}{next} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{a} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{next}\PYG{n+nv}{.link}\PYG{o}{\textbar{}}\PYG{n+nf}{e} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}\PYG{l+s}{\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{next}\PYG{n+nv}{.title} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{a}\PYG{p}{\PYGZgt{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endif} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

\end{fulllineitems}

\index{pagename (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:pagename}\pysigline{\bfcode{pagename}}
The ``page name'' of the current file, i.e. either the document name if the
file is generated from a reST source, or the equivalent hierarchical name
relative to the output directory (\code{{[}directory/{]}filename\_without\_extension}).

\end{fulllineitems}

\index{parents (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:parents}\pysigline{\bfcode{parents}}
A list of parent documents for navigation, structured like the {\hyperref[templating:next]{\crossref{\code{next}}}}
item.

\end{fulllineitems}

\index{prev (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:prev}\pysigline{\bfcode{prev}}
Like {\hyperref[templating:next]{\crossref{\code{next}}}}, but for the previous page.

\end{fulllineitems}

\index{project (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:project}\pysigline{\bfcode{project}}
The value of {\color{red}\bfseries{}:confval:{}`project{}`}.

\end{fulllineitems}

\index{release (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:release}\pysigline{\bfcode{release}}
The value of {\color{red}\bfseries{}:confval:{}`release{}`}.

\end{fulllineitems}

\index{rellinks (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:rellinks}\pysigline{\bfcode{rellinks}}
A list of links to put at the left side of the relbar, next to ``next'' and
``prev''.  This usually contains links to the general index and other indices,
such as the Python module index.  If you add something yourself, it must be a
tuple \code{(pagename, link title, accesskey, link text)}.

\end{fulllineitems}

\index{shorttitle (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:shorttitle}\pysigline{\bfcode{shorttitle}}
The value of {\color{red}\bfseries{}:confval:{}`html\_short\_title{}`}.

\end{fulllineitems}

\index{show\_source (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:show_source}\pysigline{\bfcode{show\_source}}
True if {\color{red}\bfseries{}:confval:{}`html\_show\_sourcelink{}`} is true.

\end{fulllineitems}

\index{sphinx\_version (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:sphinx_version}\pysigline{\bfcode{sphinx\_version}}
The version of Sphinx used to build.

\end{fulllineitems}

\index{style (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:style}\pysigline{\bfcode{style}}
The name of the main stylesheet, as given by the theme or
{\color{red}\bfseries{}:confval:{}`html\_style{}`}.

\end{fulllineitems}

\index{title (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:title}\pysigline{\bfcode{title}}
The title of the current document, as used in the \code{\textless{}title\textgreater{}} tag.

\end{fulllineitems}

\index{use\_opensearch (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:use_opensearch}\pysigline{\bfcode{use\_opensearch}}
The value of {\color{red}\bfseries{}:confval:{}`html\_use\_opensearch{}`}.

\end{fulllineitems}

\index{version (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:version}\pysigline{\bfcode{version}}
The value of {\color{red}\bfseries{}:confval:{}`version{}`}.

\end{fulllineitems}


In addition to these values, there are also all \textbf{theme options} available
(prefixed by \code{theme\_}), as well as the values given by the user in
{\color{red}\bfseries{}:confval:{}`html\_context{}`}.

In documents that are created from source files (as opposed to
automatically-generated files like the module index, or documents that already
are in HTML form), these variables are also available:
\index{meta (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:meta}\pysigline{\bfcode{meta}}
Document metadata (a dictionary), see {\hyperref[markup/misc:metadata]{\crossref{\DUrole{std,std-ref}{文件范围的元数据}}}}.

\end{fulllineitems}

\index{sourcename (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:sourcename}\pysigline{\bfcode{sourcename}}
The name of the copied source file for the current document.  This is only
nonempty if the {\color{red}\bfseries{}:confval:{}`html\_copy\_source{}`} value is true.

\end{fulllineitems}

\index{toc (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:toc}\pysigline{\bfcode{toc}}
The local table of contents for the current page, rendered as HTML bullet
lists.

\end{fulllineitems}

\index{toctree (內置变量)}

\begin{fulllineitems}
\phantomsection\label{templating:toctree}\pysigline{\bfcode{toctree}}
A callable yielding the global TOC tree containing the current page, rendered
as HTML bullet lists.  Optional keyword arguments:
\begin{itemize}
\item {} 
\code{collapse} (true by default): if true, all TOC entries that are not
ancestors of the current page are collapsed

\item {} 
\code{maxdepth} (defaults to the max depth selected in the toctree directive):
the maximum depth of the tree; set it to \code{-1} to allow unlimited depth

\item {} 
\code{titles\_only} (false by default): if true, put only toplevel document
titles in the tree

\end{itemize}

\end{fulllineitems}



\chapter{Sphinx Extensions}
\label{extensions:sphinx-extensions}\label{extensions:extensions}\label{extensions:module-sphinx.application}\label{extensions::doc}\index{sphinx.application (模块)}
Since many projects will need special features in their documentation, Sphinx is
designed to be extensible on several levels.

This is what you can do in an extension: First, you can add new
{\hyperref[glossary:term\string-builder]{\termref{\DUrole{xref,std,std-term}{builder}}}}s to support new output formats or actions on the parsed
documents.  Then, it is possible to register custom reStructuredText roles and
directives, extending the markup.  And finally, there are so-called ``hook
points'' at strategic places throughout the build process, where an extension can
register a hook and run specialized code.

An extension is simply a Python module.  When an extension is loaded, Sphinx
imports this module and executes its \code{setup()} function, which in turn
notifies Sphinx of everything the extension offers -- see the extension tutorial
for examples.

The configuration file itself can be treated as an extension if it contains a
\code{setup()} function.  All other extensions to load must be listed in the
{\color{red}\bfseries{}:confval:{}`extensions{}`} configuration value.


\section{Tutorial: Writing a simple extension}
\label{ext/tutorial:tutorial-writing-a-simple-extension}\label{ext/tutorial:exttut}\label{ext/tutorial::doc}
This section is intended as a walkthrough for the creation of custom extensions.
It covers the basics of writing and activating an extensions, as well as
commonly used features of extensions.

As an example, we will cover a ``todo'' extension that adds capabilities to
include todo entries in the documentation, and collecting these in a central
place.  (A similar ``todo'' extension is distributed with Sphinx.)


\subsection{Build Phases}
\label{ext/tutorial:build-phases}
One thing that is vital in order to understand extension mechanisms is the way
in which a Sphinx project is built: this works in several phases.

\textbf{Phase 0: Initialization}
\begin{quote}

In this phase, almost nothing interesting for us happens.  The source
directory is searched for source files, and extensions are initialized.
Should a stored build environment exist, it is loaded, otherwise a new one is
created.
\end{quote}

\textbf{Phase 1: Reading}
\begin{quote}

In Phase 1, all source files (and on subsequent builds, those that are new or
changed) are read and parsed.  This is the phase where directives and roles
are encountered by the docutils, and the corresponding functions are called.
The output of this phase is a \emph{doctree} for each source files, that is a tree
of docutils nodes.  For document elements that aren't fully known until all
existing files are read, temporary nodes are created.

During reading, the build environment is updated with all meta- and cross
reference data of the read documents, such as labels, the names of headings,
described Python objects and index entries.  This will later be used to
replace the temporary nodes.

The parsed doctrees are stored on the disk, because it is not possible to
hold all of them in memory.
\end{quote}

\textbf{Phase 2: Consistency checks}
\begin{quote}

Some checking is done to ensure no surprises in the built documents.
\end{quote}

\textbf{Phase 3: Resolving}
\begin{quote}

Now that the metadata and cross-reference data of all existing documents is
known, all temporary nodes are replaced by nodes that can be converted into
output.  For example, links are created for object references that exist, and
simple literal nodes are created for those that don't.
\end{quote}

\textbf{Phase 4: Writing}
\begin{quote}

This phase converts the resolved doctrees to the desired output format, such
as HTML or LaTeX.  This happens via a so-called docutils writer that visits
the individual nodes of each doctree and produces some output in the process.
\end{quote}

\begin{notice}{note}{注解:}
Some builders deviate from this general build plan, for example, the builder
that checks external links does not need anything more than the parsed
doctrees and therefore does not have phases 2--4.
\end{notice}


\subsection{Extension Design}
\label{ext/tutorial:extension-design}
We want the extension to add the following to Sphinx:
\begin{itemize}
\item {} 
A ``todo'' directive, containing some content that is marked with ``TODO'', and
only shown in the output if a new config value is set.  (Todo entries should
not be in the output by default.)

\item {} 
A ``todolist'' directive that creates a list of all todo entries throughout the
documentation.

\end{itemize}

For that, we will need to add the following elements to Sphinx:
\begin{itemize}
\item {} 
New directives, called \code{todo} and \code{todolist}.

\item {} 
New document tree nodes to represent these directives, conventionally also
called \code{todo} and \code{todolist}.  We wouldn't need new nodes if the new
directives only produced some content representable by existing nodes.

\item {} 
A new config value \code{todo\_include\_todos} (config value names should start
with the extension name, in order to stay unique) that controls whether todo
entries make it into the output.

\item {} 
New event handlers: one for the {\color{red}\bfseries{}:event:{}`doctree-resolved{}`} event, to replace
the todo and todolist nodes, and one for {\color{red}\bfseries{}:event:{}`env-purge-doc{}`} (the reason
for that will be covered later).

\end{itemize}


\subsection{The Setup Function}
\label{ext/tutorial:the-setup-function}
The new elements are added in the extension's setup function.  Let us create a
new Python module called \code{todo.py} and add the setup function:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{setup}\PYG{p}{(}\PYG{n}{app}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}config\PYGZus{}value}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo\PYGZus{}include\PYGZus{}todos}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{k+kc}{False}\PYG{p}{,} \PYG{k+kc}{False}\PYG{p}{)}

    \PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}node}\PYG{p}{(}\PYG{n}{todolist}\PYG{p}{)}
    \PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}node}\PYG{p}{(}\PYG{n}{todo}\PYG{p}{,}
                 \PYG{n}{html}\PYG{o}{=}\PYG{p}{(}\PYG{n}{visit\PYGZus{}todo\PYGZus{}node}\PYG{p}{,} \PYG{n}{depart\PYGZus{}todo\PYGZus{}node}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{latex}\PYG{o}{=}\PYG{p}{(}\PYG{n}{visit\PYGZus{}todo\PYGZus{}node}\PYG{p}{,} \PYG{n}{depart\PYGZus{}todo\PYGZus{}node}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{text}\PYG{o}{=}\PYG{p}{(}\PYG{n}{visit\PYGZus{}todo\PYGZus{}node}\PYG{p}{,} \PYG{n}{depart\PYGZus{}todo\PYGZus{}node}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}directive}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{TodoDirective}\PYG{p}{)}
    \PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}directive}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todolist}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{TodolistDirective}\PYG{p}{)}
    \PYG{n}{app}\PYG{o}{.}\PYG{n}{connect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doctree\PYGZhy{}resolved}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{process\PYGZus{}todo\PYGZus{}nodes}\PYG{p}{)}
    \PYG{n}{app}\PYG{o}{.}\PYG{n}{connect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{env\PYGZhy{}purge\PYGZhy{}doc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{purge\PYGZus{}todos}\PYG{p}{)}
\end{Verbatim}

The calls in this function refer to classes and functions not yet written.  What
the individual calls do is the following:
\begin{itemize}
\item {} 
{\hyperref[ext/appapi:sphinx.application.Sphinx.add_config_value]{\crossref{\code{add\_config\_value()}}}} lets Sphinx know that it should recognize the
new \emph{config value} \code{todo\_include\_todos}, whose default value should be
\code{False} (this also tells Sphinx that it is a boolean value).

If the third argument was \code{True}, all documents would be re-read if the
config value changed its value.  This is needed for config values that
influence reading (build phase 1).

\item {} 
{\hyperref[ext/appapi:sphinx.application.Sphinx.add_node]{\crossref{\code{add\_node()}}}} adds a new \emph{node class} to the build system.  It also
can specify visitor functions for each supported output format.  These visitor
functions are needed when the new nodes stay until phase 4 -- since the
\code{todolist} node is always replaced in phase 3, it doesn't need any.

We need to create the two node classes \code{todo} and \code{todolist} later.

\item {} 
{\hyperref[ext/appapi:sphinx.application.Sphinx.add_directive]{\crossref{\code{add\_directive()}}}} adds a new \emph{directive}, given by name and class.

The handler functions are created later.

\item {} 
Finally, {\hyperref[ext/appapi:sphinx.application.Sphinx.connect]{\crossref{\code{connect()}}}} adds an \emph{event handler} to the event whose
name is given by the first argument.  The event handler function is called
with several arguments which are documented with the event.

\end{itemize}


\subsection{The Node Classes}
\label{ext/tutorial:the-node-classes}
Let's start with the node classes:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{docutils} \PYG{k}{import} \PYG{n}{nodes}

\PYG{k}{class} \PYG{n+nc}{todo}\PYG{p}{(}\PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Admonition}\PYG{p}{,} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Element}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{pass}

\PYG{k}{class} \PYG{n+nc}{todolist}\PYG{p}{(}\PYG{n}{nodes}\PYG{o}{.}\PYG{n}{General}\PYG{p}{,} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Element}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{pass}

\PYG{k}{def} \PYG{n+nf}{visit\PYGZus{}todo\PYGZus{}node}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{node}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{visit\PYGZus{}admonition}\PYG{p}{(}\PYG{n}{node}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{depart\PYGZus{}todo\PYGZus{}node}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{node}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{depart\PYGZus{}admonition}\PYG{p}{(}\PYG{n}{node}\PYG{p}{)}
\end{Verbatim}

Node classes usually don't have to do anything except inherit from the standard
docutils classes defined in \code{docutils.nodes}.  \code{todo} inherits from
\code{Admonition} because it should be handled like a note or warning, \code{todolist}
is just a ``general'' node.


\subsection{The Directive Classes}
\label{ext/tutorial:the-directive-classes}
A directive class is a class deriving usually from
\code{docutils.parsers.rst.Directive}.  Since the class-based directive interface
doesn't exist yet in Docutils 0.4, Sphinx has another base class called
\code{sphinx.util.compat.Directive} that you can derive your directive from, and it
will work with both Docutils 0.4 and 0.5 upwards.  The directive interface is
covered in detail in the docutils documentation; the important thing is that the
class has a method \code{run} that returns a list of nodes.

The \code{todolist} directive is quite simple:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sphinx}\PYG{n+nn}{.}\PYG{n+nn}{util}\PYG{n+nn}{.}\PYG{n+nn}{compat} \PYG{k}{import} \PYG{n}{Directive}

\PYG{k}{class} \PYG{n+nc}{TodolistDirective}\PYG{p}{(}\PYG{n}{Directive}\PYG{p}{)}\PYG{p}{:}

    \PYG{k}{def} \PYG{n+nf}{run}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{p}{[}\PYG{n}{todolist}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}
\end{Verbatim}

An instance of our \code{todolist} node class is created and returned.  The
todolist directive has neither content nor arguments that need to be handled.

The \code{todo} directive function looks like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sphinx}\PYG{n+nn}{.}\PYG{n+nn}{util}\PYG{n+nn}{.}\PYG{n+nn}{compat} \PYG{k}{import} \PYG{n}{make\PYGZus{}admonition}

\PYG{k}{class} \PYG{n+nc}{TodoDirective}\PYG{p}{(}\PYG{n}{Directive}\PYG{p}{)}\PYG{p}{:}

    \PYG{c+c1}{\PYGZsh{} this enables content in the directive}
    \PYG{n}{has\PYGZus{}content} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{def} \PYG{n+nf}{run}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{env} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{state}\PYG{o}{.}\PYG{n}{document}\PYG{o}{.}\PYG{n}{settings}\PYG{o}{.}\PYG{n}{env}

        \PYG{n}{targetid} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{todo\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{env}\PYG{o}{.}\PYG{n}{new\PYGZus{}serialno}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{targetnode} \PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{target}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ids}\PYG{o}{=}\PYG{p}{[}\PYG{n}{targetid}\PYG{p}{]}\PYG{p}{)}

        \PYG{n}{ad} \PYG{o}{=} \PYG{n}{make\PYGZus{}admonition}\PYG{p}{(}\PYG{n}{todo}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{name}\PYG{p}{,} \PYG{p}{[}\PYG{n}{\PYGZus{}}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Todo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{options}\PYG{p}{,}
                             \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{content}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{lineno}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{content\PYGZus{}offset}\PYG{p}{,}
                             \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{block\PYGZus{}text}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{state}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{state\PYGZus{}machine}\PYG{p}{)}

        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n+nb}{hasattr}\PYG{p}{(}\PYG{n}{env}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo\PYGZus{}all\PYGZus{}todos}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{env}\PYG{o}{.}\PYG{n}{todo\PYGZus{}all\PYGZus{}todos} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{n}{env}\PYG{o}{.}\PYG{n}{todo\PYGZus{}all\PYGZus{}todos}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{\PYGZob{}}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{env}\PYG{o}{.}\PYG{n}{docname}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lineno}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{lineno}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{ad}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{deepcopy}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{target}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{targetnode}\PYG{p}{,}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}

        \PYG{k}{return} \PYG{p}{[}\PYG{n}{targetnode}\PYG{p}{]} \PYG{o}{+} \PYG{n}{ad}
\end{Verbatim}

Several important things are covered here. First, as you can see, you can refer
to the build environment instance using \code{self.state.document.settings.env}.

Then, to act as a link target (from the todolist), the todo directive needs to
return a target node in addition to the todo node.  The target ID (in HTML, this
will be the anchor name) is generated by using \code{env.new\_serialno} which is
returns a new integer directive on each call and therefore leads to unique
target names.  The target node is instantiated without any text (the first two
arguments).

An admonition is created using a standard docutils function (wrapped in Sphinx
for docutils cross-version compatibility).  The first argument gives the node
class, in our case \code{todo}.  The third argument gives the admonition title (use
\code{arguments} here to let the user specify the title).  A list of nodes is
returned from \code{make\_admonition}.

Then, the todo node is added to the environment.  This is needed to be able to
create a list of all todo entries throughout the documentation, in the place
where the author puts a \code{todolist} directive.  For this case, the environment
attribute \code{todo\_all\_todos} is used (again, the name should be unique, so it is
prefixed by the extension name).  It does not exist when a new environment is
created, so the directive must check and create it if necessary.  Various
information about the todo entry's location are stored along with a copy of the
node.

In the last line, the nodes that should be put into the doctree are returned:
the target node and the admonition node.

The node structure that the directive returns looks like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{target} \PYG{n}{node}        \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{todo} \PYG{n}{node}          \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
  \PYGZbs{}\PYG{n}{\PYGZus{}\PYGZus{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
     \PYG{o}{\textbar{}} \PYG{n}{admonition} \PYG{n}{title}   \PYG{o}{\textbar{}}
     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
     \PYG{o}{\textbar{}} \PYG{n}{paragraph}          \PYG{o}{\textbar{}}
     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
     \PYG{o}{\textbar{}} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}                \PYG{o}{\textbar{}}
     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{Verbatim}


\subsection{The Event Handlers}
\label{ext/tutorial:the-event-handlers}
Finally, let's look at the event handlers.  First, the one for the
{\color{red}\bfseries{}:event:{}`env-purge-doc{}`} event:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{purge\PYGZus{}todos}\PYG{p}{(}\PYG{n}{app}\PYG{p}{,} \PYG{n}{env}\PYG{p}{,} \PYG{n}{docname}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{o+ow}{not} \PYG{n+nb}{hasattr}\PYG{p}{(}\PYG{n}{env}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo\PYGZus{}all\PYGZus{}todos}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return}
    \PYG{n}{env}\PYG{o}{.}\PYG{n}{todo\PYGZus{}all\PYGZus{}todos} \PYG{o}{=} \PYG{p}{[}\PYG{n}{todo} \PYG{k}{for} \PYG{n}{todo} \PYG{o+ow}{in} \PYG{n}{env}\PYG{o}{.}\PYG{n}{todo\PYGZus{}all\PYGZus{}todos}
                          \PYG{k}{if} \PYG{n}{todo}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{docname}\PYG{p}{]}
\end{Verbatim}

Since we store information from source files in the environment, which is
persistent, it may become out of date when the source file changes.  Therefore,
before each source file is read, the environment's records of it are cleared,
and the {\color{red}\bfseries{}:event:{}`env-purge-doc{}`} event gives extensions a chance to do the same.
Here we clear out all todos whose docname matches the given one from the
\code{todo\_all\_todos} list.  If there are todos left in the document, they will be
added again during parsing.

The other handler belongs to the {\color{red}\bfseries{}:event:{}`doctree-resolved{}`} event.  This event is
emitted at the end of phase 3 and allows custom resolving to be done:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{process\PYGZus{}todo\PYGZus{}nodes}\PYG{p}{(}\PYG{n}{app}\PYG{p}{,} \PYG{n}{doctree}\PYG{p}{,} \PYG{n}{fromdocname}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{app}\PYG{o}{.}\PYG{n}{config}\PYG{o}{.}\PYG{n}{todo\PYGZus{}include\PYGZus{}todos}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{node} \PYG{o+ow}{in} \PYG{n}{doctree}\PYG{o}{.}\PYG{n}{traverse}\PYG{p}{(}\PYG{n}{todo}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{node}\PYG{o}{.}\PYG{n}{parent}\PYG{o}{.}\PYG{n}{remove}\PYG{p}{(}\PYG{n}{node}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Replace all todolist nodes with a list of the collected todos.}
    \PYG{c+c1}{\PYGZsh{} Augment each todo with a backlink to the original location.}
    \PYG{n}{env} \PYG{o}{=} \PYG{n}{app}\PYG{o}{.}\PYG{n}{builder}\PYG{o}{.}\PYG{n}{env}

    \PYG{k}{for} \PYG{n}{node} \PYG{o+ow}{in} \PYG{n}{doctree}\PYG{o}{.}\PYG{n}{traverse}\PYG{p}{(}\PYG{n}{todolist}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{app}\PYG{o}{.}\PYG{n}{config}\PYG{o}{.}\PYG{n}{todo\PYGZus{}include\PYGZus{}todos}\PYG{p}{:}
            \PYG{n}{node}\PYG{o}{.}\PYG{n}{replace\PYGZus{}self}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}
            \PYG{k}{continue}

        \PYG{n}{content} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

        \PYG{k}{for} \PYG{n}{todo\PYGZus{}info} \PYG{o+ow}{in} \PYG{n}{env}\PYG{o}{.}\PYG{n}{todo\PYGZus{}all\PYGZus{}todos}\PYG{p}{:}
            \PYG{n}{para} \PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{paragraph}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{filename} \PYG{o}{=} \PYG{n}{env}\PYG{o}{.}\PYG{n}{doc2path}\PYG{p}{(}\PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{base}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)}
            \PYG{n}{description} \PYG{o}{=} \PYG{p}{(}
                \PYG{n}{\PYGZus{}}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(The original entry is located in }\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{, line }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{ and can be found }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{\PYGZpc{}}
                \PYG{p}{(}\PYG{n}{filename}\PYG{p}{,} \PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lineno}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{para} \PYG{o}{+}\PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Text}\PYG{p}{(}\PYG{n}{description}\PYG{p}{,} \PYG{n}{description}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Create a reference}
            \PYG{n}{newnode} \PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{reference}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{innernode} \PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{emphasis}\PYG{p}{(}\PYG{n}{\PYGZus{}}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{here}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{here}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{newnode}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{refdocname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
            \PYG{n}{newnode}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{refuri}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{app}\PYG{o}{.}\PYG{n}{builder}\PYG{o}{.}\PYG{n}{get\PYGZus{}relative\PYGZus{}uri}\PYG{p}{(}
                \PYG{n}{fromdocname}\PYG{p}{,} \PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
            \PYG{n}{newnode}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{refuri}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{target}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{refid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
            \PYG{n}{newnode}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{innernode}\PYG{p}{)}
            \PYG{n}{para} \PYG{o}{+}\PYG{o}{=} \PYG{n}{newnode}
            \PYG{n}{para} \PYG{o}{+}\PYG{o}{=} \PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Text}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Insert into the todolist}
            \PYG{n}{content}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{todo\PYGZus{}info}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{todo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
            \PYG{n}{content}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{para}\PYG{p}{)}

        \PYG{n}{node}\PYG{o}{.}\PYG{n}{replace\PYGZus{}self}\PYG{p}{(}\PYG{n}{content}\PYG{p}{)}
\end{Verbatim}

It is a bit more involved.  If our new ``todo\_include\_todos'' config value is
false, all todo and todolist nodes are removed from the documents.

If not, todo nodes just stay where and how they are.  Todolist nodes are
replaced by a list of todo entries, complete with backlinks to the location
where they come from.  The list items are composed of the nodes from the todo
entry and docutils nodes created on the fly: a paragraph for each entry,
containing text that gives the location, and a link (reference node containing
an italic node) with the backreference.  The reference URI is built by
\code{app.builder.get\_relative\_uri} which creates a suitable URI depending on the
used builder, and appending the todo node's (the target's) ID as the anchor
name.


\section{Extension API}
\label{ext/appapi:extension-api}\label{ext/appapi::doc}
Each Sphinx extension is a Python module with at least a \code{setup()} function.
This function is called at initialization time with one argument, the
application object representing the Sphinx process.  This application object has
the following public API:
\index{setup\_extension() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.setup_extension}\pysiglinewithargsret{\code{Sphinx.}\bfcode{setup\_extension}}{\emph{name}}{}
Load the extension given by the module \emph{name}.  Use this if your extension
needs the features provided by another extension.

\end{fulllineitems}

\index{add\_builder() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_builder}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_builder}}{\emph{builder}}{}
Register a new builder.  \emph{builder} must be a class that inherits from
{\hyperref[ext/builderapi:sphinx.builders.Builder]{\crossref{\code{Builder}}}}.

\end{fulllineitems}

\index{add\_config\_value() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_config_value}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_config\_value}}{\emph{name}, \emph{default}, \emph{rebuild}}{}
Register a configuration value.  This is necessary for Sphinx to recognize
new values and set default values accordingly.  The \emph{name} should be prefixed
with the extension name, to avoid clashes.  The \emph{default} value can be any
Python object.  The string value \emph{rebuild} must be one of those values:
\begin{itemize}
\item {} 
\code{'env'} if a change in the setting only takes effect when a document is
parsed -- this means that the whole environment must be rebuilt.

\item {} 
\code{'html'} if a change in the setting needs a full rebuild of HTML
documents.

\item {} 
\code{'{'}} if a change in the setting will not need any special rebuild.

\end{itemize}

\DUrole{versionmodified}{在 0.4 版更改: }If the \emph{default} value is a callable, it will be called with the config
object as its argument in order to get the default value.  This can be
used to implement config values whose default depends on other values.

\DUrole{versionmodified}{在 0.6 版更改: }Changed \emph{rebuild} from a simple boolean (equivalent to \code{'{'}} or
\code{'env'}) to a string.  However, booleans are still accepted and
converted internally.

\end{fulllineitems}

\index{add\_domain() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_domain}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_domain}}{\emph{domain}}{}
Make the given \emph{domain} (which must be a class; more precisely, a subclass of
\code{Domain}) known to Sphinx.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{override\_domain() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.override_domain}\pysiglinewithargsret{\code{Sphinx.}\bfcode{override\_domain}}{\emph{domain}}{}
Make the given \emph{domain} class known to Sphinx, assuming that there is already
a domain with its \code{.name}.  The new domain must be a subclass of the
existing one.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{add\_index\_to\_domain() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_index_to_domain}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_index\_to\_domain}}{\emph{domain}, \emph{index}}{}
Add a custom \emph{index} class to the domain named \emph{domain}.  \emph{index} must be a
subclass of \code{Index}.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{add\_event() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_event}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_event}}{\emph{name}}{}
Register an event called \emph{name}.  This is needed to be able to emit it.

\end{fulllineitems}

\index{add\_node() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_node}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_node}}{\emph{node}, \emph{**kwds}}{}
Register a Docutils node class.  This is necessary for Docutils internals.
It may also be used in the future to validate nodes in the parsed documents.

Node visitor functions for the Sphinx HTML, LaTeX, text and manpage writers
can be given as keyword arguments: the keyword must be one or more of
\code{'html'}, \code{'latex'}, \code{'text'}, \code{'man'}, \code{'texinfo'}, the value a
2-tuple of \code{(visit, depart)} methods.  \code{depart} can be \code{None} if the
\code{visit} function raises \code{docutils.nodes.SkipNode}.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{class} \PYG{n+nc}{math}\PYG{p}{(}\PYG{n}{docutils}\PYG{o}{.}\PYG{n}{nodes}\PYG{o}{.}\PYG{n}{Element}\PYG{p}{)}\PYG{p}{:} \PYG{k}{pass}

\PYG{k}{def} \PYG{n+nf}{visit\PYGZus{}math\PYGZus{}html}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{node}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{body}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{starttag}\PYG{p}{(}\PYG{n}{node}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{math}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{depart\PYGZus{}math\PYGZus{}html}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{node}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{body}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}/math\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{app}\PYG{o}{.}\PYG{n}{add\PYGZus{}node}\PYG{p}{(}\PYG{n}{math}\PYG{p}{,} \PYG{n}{html}\PYG{o}{=}\PYG{p}{(}\PYG{n}{visit\PYGZus{}math\PYGZus{}html}\PYG{p}{,} \PYG{n}{depart\PYGZus{}math\PYGZus{}html}\PYG{p}{)}\PYG{p}{)}
\end{Verbatim}

Obviously, translators for which you don't specify visitor methods will choke
on the node when encountered in a document to translate.

\DUrole{versionmodified}{在 0.5 版更改: }Added the support for keyword arguments giving visit functions.

\end{fulllineitems}

\index{add\_directive() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_directive}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_directive}}{\emph{name}, \emph{func}, \emph{content}, \emph{arguments}, \emph{**options}}{}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_directive}}{\emph{name}, \emph{directiveclass}}{}
Register a Docutils directive.  \emph{name} must be the prospective directive
name.  There are two possible ways to write a directive:
\begin{itemize}
\item {} 
In the docutils 0.4 style, \emph{obj} is the directive function.  \emph{content},
\emph{arguments} and \emph{options} are set as attributes on the function and
determine whether the directive has content, arguments and options,
respectively.  \textbf{This style is deprecated.}

\item {} 
In the docutils 0.5 style, \emph{directiveclass} is the directive class.  It
must already have attributes named \emph{has\_content}, \emph{required\_arguments},
\emph{optional\_arguments}, \emph{final\_argument\_whitespace} and \emph{option\_spec} that
correspond to the options for the function way.  See \href{http://docutils.sourceforge.net/docs/howto/rst-directives.html}{the Docutils docs} for
details.

The directive class must inherit from the class
\code{docutils.parsers.rst.Directive}.

\end{itemize}

For example, the (already existing) {\hyperref[markup/code:directive\string-literalinclude]{\crossref{\code{literalinclude}}}} directive would be
added like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{docutils.parsers.rst} \PYG{k+kn}{import} \PYG{n}{directives}
\PYG{n}{add\PYGZus{}directive}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{literalinclude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{literalinclude\PYGZus{}directive}\PYG{p}{,}
              \PYG{n}{content} \PYG{o}{=} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{arguments} \PYG{o}{=} \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
              \PYG{n}{linenos} \PYG{o}{=} \PYG{n}{directives}\PYG{o}{.}\PYG{n}{flag}\PYG{p}{,}
              \PYG{n}{language} \PYG{o}{=} \PYG{n}{direcitves}\PYG{o}{.}\PYG{n}{unchanged}\PYG{p}{,}
              \PYG{n}{encoding} \PYG{o}{=} \PYG{n}{directives}\PYG{o}{.}\PYG{n}{encoding}\PYG{p}{)}
\end{Verbatim}

\DUrole{versionmodified}{在 0.6 版更改: }Docutils 0.5-style directive classes are now supported.

\end{fulllineitems}

\index{add\_directive\_to\_domain() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_directive_to_domain}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_directive\_to\_domain}}{\emph{domain}, \emph{name}, \emph{func}, \emph{content}, \emph{arguments}, \emph{**options}}{}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_directive\_to\_domain}}{\emph{domain}, \emph{name}, \emph{directiveclass}}{}
Like {\hyperref[ext/appapi:sphinx.application.Sphinx.add_directive]{\crossref{\code{add\_directive()}}}}, but the directive is added to the domain named
\emph{domain}.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{add\_role() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_role}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_role}}{\emph{name}, \emph{role}}{}
Register a Docutils role.  \emph{name} must be the role name that occurs in the
source, \emph{role} the role function (see the \href{http://docutils.sourceforge.net/docs/howto/rst-roles.html}{Docutils documentation} on details).

\end{fulllineitems}

\index{add\_role\_to\_domain() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_role_to_domain}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_role\_to\_domain}}{\emph{domain}, \emph{name}, \emph{role}}{}
Like {\hyperref[ext/appapi:sphinx.application.Sphinx.add_role]{\crossref{\code{add\_role()}}}}, but the role is added to the domain named \emph{domain}.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{add\_generic\_role() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_generic_role}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_generic\_role}}{\emph{name}, \emph{nodeclass}}{}
Register a Docutils role that does nothing but wrap its contents in the
node given by \emph{nodeclass}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{add\_object\_type() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_object_type}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_object\_type}}{\emph{directivename}, \emph{rolename}, \emph{indextemplate='`}, \emph{parse\_node=None}, \emph{ref\_nodeclass=None}, \emph{objname='`}, \emph{doc\_field\_types={[}{]}}}{}
This method is a very convenient way to add a new {\hyperref[glossary:term\string-object]{\termref{\DUrole{xref,std,std-term}{object}}}} type that
can be cross-referenced.  It will do this:
\begin{itemize}
\item {} 
Create a new directive (called \emph{directivename}) for documenting an object.
It will automatically add index entries if \emph{indextemplate} is nonempty; if
given, it must contain exactly one instance of \code{\%s}.  See the example
below for how the template will be interpreted.

\item {} 
Create a new role (called \emph{rolename}) to cross-reference to these
object descriptions.

\item {} 
If you provide \emph{parse\_node}, it must be a function that takes a string and
a docutils node, and it must populate the node with children parsed from
the string.  It must then return the name of the item to be used in
cross-referencing and index entries.  See the \code{conf.py} file in the
source for this documentation for an example.

\item {} 
The \emph{objname} (if not given, will default to \emph{directivename}) names the
type of object.  It is used when listing objects, e.g. in search results.

\end{itemize}

For example, if you have this call in a custom Sphinx extension:

\begin{Verbatim}[commandchars=\\\{\}]
app.add\PYGZus{}object\PYGZus{}type(\PYGZsq{}directive\PYGZsq{}, \PYGZsq{}dir\PYGZsq{}, \PYGZsq{}pair: \PYGZpc{}s; directive\PYGZsq{})
\end{Verbatim}

you can use this markup in your documents:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{rst:directive}\PYG{p}{::} function

   Document a function.

\PYG{n+nt}{\PYGZlt{}...\PYGZgt{}}

See also the \PYG{n+na}{:rst:dir:}\PYG{n+nv}{{}`function{}`} directive.
\end{Verbatim}

For the directive, an index entry will be generated as if you had prepended

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{index}\PYG{p}{::} pair: function; directive
\end{Verbatim}

The reference node will be of class \code{literal} (so it will be rendered in a
proportional font, as appropriate for code) unless you give the \emph{ref\_nodeclass}
argument, which must be a docutils node class (most useful are
\code{docutils.nodes.emphasis} or \code{docutils.nodes.strong} -- you can also use
\code{docutils.nodes.generated} if you want no further text decoration).

For the role content, you have the same syntactical possibilities as for
standard Sphinx roles (see {\hyperref[markup/inline:xref\string-syntax]{\crossref{\DUrole{std,std-ref}{交叉索引的语法}}}}).

This method is also available under the deprecated alias
\code{add\_description\_unit}.

\end{fulllineitems}

\index{add\_crossref\_type() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_crossref_type}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_crossref\_type}}{\emph{directivename}, \emph{rolename}, \emph{indextemplate='`}, \emph{ref\_nodeclass=None}, \emph{objname='`}}{}
This method is very similar to {\hyperref[ext/appapi:sphinx.application.Sphinx.add_object_type]{\crossref{\code{add\_object\_type()}}}} except that the
directive it generates must be empty, and will produce no output.

That means that you can add semantic targets to your sources, and refer to
them using custom roles instead of generic ones (like {\hyperref[markup/inline:role\string-ref]{\crossref{\code{ref}}}}).  Example
call:

\begin{Verbatim}[commandchars=\\\{\}]
app.add\PYGZus{}crossref\PYGZus{}type(\PYGZsq{}topic\PYGZsq{}, \PYGZsq{}topic\PYGZsq{}, \PYGZsq{}single: \PYGZpc{}s\PYGZsq{}, docutils.nodes.emphasis)
\end{Verbatim}

Example usage:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{topic}\PYG{p}{::} application API

\PYG{g+gh}{The application API}
\PYG{g+gh}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}

\PYG{n+nt}{\PYGZlt{}...\PYGZgt{}}

See also \PYG{n+na}{:topic:}\PYG{n+nv}{{}`this section \PYGZlt{}application API\PYGZgt{}{}`}.
\end{Verbatim}

(Of course, the element following the \code{topic} directive needn't be a
section.)

\end{fulllineitems}

\index{add\_transform() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_transform}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_transform}}{\emph{transform}}{}
Add the standard docutils \code{Transform} subclass \emph{transform} to the list
of transforms that are applied after Sphinx parses a reST document.

\end{fulllineitems}

\index{add\_javascript() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_javascript}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_javascript}}{\emph{filename}}{}
Add \emph{filename} to the list of JavaScript files that the default HTML template
will include.  The filename must be relative to the HTML static path, see
{\color{red}\bfseries{}:confval:{}`the docs for the config value \textless{}html\_static\_path\textgreater{}{}`}.  A full URI with
scheme, like \code{http://example.org/foo.js}, is also supported.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\index{add\_stylesheet() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_stylesheet}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_stylesheet}}{\emph{filename}}{}
Add \emph{filename} to the list of CSS files that the default HTML template will
include.  Like for {\hyperref[ext/appapi:sphinx.application.Sphinx.add_javascript]{\crossref{\code{add\_javascript()}}}}, the filename must be relative to
the HTML static path, or a full URI with scheme.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{add\_lexer() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_lexer}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_lexer}}{\emph{alias}, \emph{lexer}}{}
Use \emph{lexer}, which must be an instance of a Pygments lexer class, to
highlight code blocks with the given language \emph{alias}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{add\_autodocumenter() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_autodocumenter}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_autodocumenter}}{\emph{cls}}{}
Add \emph{cls} as a new documenter class for the {\hyperref[ext/autodoc:module\string-sphinx.ext.autodoc]{\crossref{\code{sphinx.ext.autodoc}}}}
extension.  It must be a subclass of \code{sphinx.ext.autodoc.Documenter}.
This allows to auto-document new types of objects.  See the source of the
autodoc module for examples on how to subclass \code{Documenter}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{add\_autodoc\_attrgetter() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_autodoc_attrgetter}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_autodoc\_attrgetter}}{\emph{type}, \emph{getter}}{}
Add \emph{getter}, which must be a function with an interface compatible to the
\code{getattr()} builtin, as the autodoc attribute getter for objects that are
instances of \emph{type}.  All cases where autodoc needs to get an attribute of a
type are then handled by this function instead of \code{getattr()}.

\DUrole{versionmodified}{0.6 新版功能.}

\end{fulllineitems}

\index{add\_search\_language() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.add_search_language}\pysiglinewithargsret{\code{Sphinx.}\bfcode{add\_search\_language}}{\emph{cls}}{}
Add \emph{cls}, which must be a subclass of \code{sphinx.search.SearchLanguage},
as a support language for building the HTML full-text search index.  The
class must have a \emph{lang} attribute that indicates the language it should be
used for.  See {\color{red}\bfseries{}:confval:{}`html\_search\_language{}`}.

\DUrole{versionmodified}{1.1 新版功能.}

\end{fulllineitems}

\index{connect() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.connect}\pysiglinewithargsret{\code{Sphinx.}\bfcode{connect}}{\emph{event}, \emph{callback}}{}
Register \emph{callback} to be called when \emph{event} is emitted.  For details on
available core events and the arguments of callback functions, please see
{\hyperref[ext/appapi:events]{\crossref{\DUrole{std,std-ref}{Sphinx core events}}}}.

The method returns a ``listener ID'' that can be used as an argument to
{\hyperref[ext/appapi:sphinx.application.Sphinx.disconnect]{\crossref{\code{disconnect()}}}}.

\end{fulllineitems}

\index{disconnect() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.disconnect}\pysiglinewithargsret{\code{Sphinx.}\bfcode{disconnect}}{\emph{listener\_id}}{}
Unregister callback \emph{listener\_id}.

\end{fulllineitems}

\index{emit() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.emit}\pysiglinewithargsret{\code{Sphinx.}\bfcode{emit}}{\emph{event}, \emph{*arguments}}{}
Emit \emph{event} and pass \emph{arguments} to the callback functions.  Return the
return values of all callbacks as a list.  Do not emit core Sphinx events
in extensions!

\end{fulllineitems}

\index{emit\_firstresult() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.emit_firstresult}\pysiglinewithargsret{\code{Sphinx.}\bfcode{emit\_firstresult}}{\emph{event}, \emph{*arguments}}{}
Emit \emph{event} and pass \emph{arguments} to the callback functions.  Return the
result of the first callback that doesn't return \code{None}.

\DUrole{versionmodified}{0.5 新版功能.}

\end{fulllineitems}

\index{require\_sphinx() (sphinx.application.Sphinx 方法)}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.Sphinx.require_sphinx}\pysiglinewithargsret{\code{Sphinx.}\bfcode{require\_sphinx}}{\emph{version}}{}
Compare \emph{version} (which must be a \code{major.minor} version string,
e.g. \code{'1.1'}) with the version of the running Sphinx, and abort the build
when it is too old.

\DUrole{versionmodified}{1.0 新版功能.}

\end{fulllineitems}

\index{ExtensionError}

\begin{fulllineitems}
\phantomsection\label{ext/appapi:sphinx.application.ExtensionError}\pysigline{\strong{exception }\code{sphinx.application.}\bfcode{ExtensionError}}
All these functions raise this exception if something went wrong with the
extension API.

\end{fulllineitems}


Examples of using the Sphinx extension API can be seen in the \code{sphinx.ext}
package.


\subsection{Sphinx core events}
\label{ext/appapi:sphinx-core-events}\label{ext/appapi:events}
These events are known to the core.  The arguments shown are given to the
registered event handlers.


\subsection{The template bridge}
\label{ext/appapi:the-template-bridge}\label{ext/appapi:template-bridge}

\subsection{Domain API}
\label{ext/appapi:id5}\label{ext/appapi:module-sphinx.domains}\label{ext/appapi:domain-api}\index{sphinx.domains (模块)}

\section{Writing new builders}
\label{ext/builderapi:writing-builders}\label{ext/builderapi:writing-new-builders}\label{ext/builderapi::doc}\index{Builder (sphinx.builders 中的类)}

\begin{fulllineitems}
\phantomsection\label{ext/builderapi:sphinx.builders.Builder}\pysigline{\strong{class }\code{sphinx.builders.}\bfcode{Builder}}
This is the base class for all builders.

These methods are predefined and will be called from the application:

These methods can be overridden in concrete builder classes:

\end{fulllineitems}



\section{Builtin Sphinx extensions}
\label{extensions:builtin-sphinx-extensions}
These extensions are built in and can be activated by respective entries in the
{\color{red}\bfseries{}:confval:{}`extensions{}`} configuration value:


\subsection{\texttt{sphinx.ext.autodoc} -- Include documentation from docstrings}
\label{ext/autodoc:module-sphinx.ext.autodoc}\label{ext/autodoc:sphinx-ext-autodoc-include-documentation-from-docstrings}\label{ext/autodoc::doc}\index{sphinx.ext.autodoc (模块)}
\index{automatic!documentation}\index{documentation!automatic}\index{docstring}
This extension can import the modules you are documenting, and pull in
documentation from docstrings in a semi-automatic way.

\begin{notice}{note}{注解:}
For Sphinx (actually, the Python interpreter that executes Sphinx) to find
your module, it must be importable.  That means that the module or the
package must be in one of the directories on \code{sys.path} -- adapt your
\code{sys.path} in the configuration file accordingly.
\end{notice}

For this to work, the docstrings must of course be written in correct
reStructuredText.  You can then use all of the usual Sphinx markup in the
docstrings, and it will end up correctly in the documentation.  Together with
hand-written documentation, this technique eases the pain of having to maintain
two locations for documentation, while at the same time avoiding
auto-generated-looking pure API documentation.

\code{autodoc} provides several directives that are versions of the usual
{\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}}, {\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}} and so forth.  On parsing time, they
import the corresponding module and extract the docstring of the given objects,
inserting them into the page source under a suitable {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}},
{\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}} etc.  directive.

\begin{notice}{note}{注解:}
Just as {\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}} respects the current {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}},
{\hyperref[ext/autodoc:directive\string-autoclass]{\crossref{\code{autoclass}}}} will also do so.  Likewise, {\hyperref[ext/autodoc:directive\string-automethod]{\crossref{\code{automethod}}}} will
respect the current {\hyperref[domains:directive\string-py:class]{\crossref{\code{py:class}}}}.
\end{notice}
\index{automodule (指示)}\index{autoclass (指示)}\index{autoexception (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/autodoc:directive-automodule}\pysigline{\bfcode{..~automodule::}}\phantomsection\label{ext/autodoc:directive-autoclass}\pysigline{\bfcode{..~autoclass::}}\phantomsection\label{ext/autodoc:directive-autoexception}\pysigline{\bfcode{..~autoexception::}}
Document a module, class or exception.  All three directives will by default
only insert the docstring of the object itself:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle
\end{Verbatim}

will produce source like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{class}\PYG{p}{::} Noodle

   Noodle\PYGZsq{}s docstring.
\end{Verbatim}

The ``auto'' directives can also contain content of their own, it will be
inserted into the resulting non-auto directive source after the docstring
(but before any automatic member documentation).

Therefore, you can also mix automatic and non-automatic member documentation,
like so:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle
   \PYG{n+nc}{:members:} \PYG{n+nf}{eat, slurp}

\PYG{p}{   ..} \PYG{o+ow}{method}\PYG{p}{::} boil(time=10)

      Boil the noodle \PYG{g+ge}{*time*} minutes.
\end{Verbatim}

\textbf{Options and advanced usage}
\begin{itemize}
\item {} 
If you want to automatically document members, there's a \code{members}
option:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{automodule}\PYG{p}{::} noodle
   \PYG{n+nc}{:members:}
\end{Verbatim}

will document all module members (recursively), and

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle
   \PYG{n+nc}{:members:}
\end{Verbatim}

will document all non-private member functions and properties (that is,
those whose name doesn't start with \code{\_}).

For modules, \code{\_\_all\_\_} will be respected when looking for members; the
order of the members will also be the order in \code{\_\_all\_\_}.

You can also give an explicit list of members; only these will then be
documented:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle
   \PYG{n+nc}{:members:} \PYG{n+nf}{eat, slurp}
\end{Verbatim}

\item {} 
If you want to make the \code{members} option (or other flag options described
below) the default, see {\color{red}\bfseries{}:confval:{}`autodoc\_default\_flags{}`}.

\item {} 
Members without docstrings will be left out, unless you give the
\code{undoc-members} flag option:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{automodule}\PYG{p}{::} noodle
   \PYG{n+nc}{:members:}
   \PYG{n+nc}{:undoc\PYGZhy{}members:}
\end{Verbatim}

\item {} 
``Private'' members (that is, those named like \code{\_private} or \code{\_\_private})
will be included if the \code{private-members} flag option is given.

\DUrole{versionmodified}{1.1 新版功能.}

\item {} 
Python ``special'' members (that is, those named like \code{\_\_special\_\_}) will
be included if the \code{special-members} flag option is given:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} my.Class
   \PYG{n+nc}{:members:}
   \PYG{n+nc}{:private\PYGZhy{}members:}
   \PYG{n+nc}{:special\PYGZhy{}members:}
\end{Verbatim}

would document both ``private'' and ``special'' members of the class.

\DUrole{versionmodified}{1.1 新版功能.}

\item {} 
For classes and exceptions, members inherited from base classes will be
left out when documenting all members, unless you give the
\code{inherited-members} flag option, in addition to \code{members}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle
   \PYG{n+nc}{:members:}
   \PYG{n+nc}{:inherited\PYGZhy{}members:}
\end{Verbatim}

This can be combined with \code{undoc-members} to document \emph{all} available
members of the class or module.

Note: this will lead to markup errors if the inherited members come from a
module whose docstrings are not reST formatted.

\DUrole{versionmodified}{0.3 新版功能.}

\item {} 
It's possible to override the signature for explicitly documented callable
objects (functions, methods, classes) with the regular syntax that will
override the signature gained from introspection:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autoclass}\PYG{p}{::} Noodle(type)

\PYG{p}{   ..} \PYG{o+ow}{automethod}\PYG{p}{::} eat(persona)
\end{Verbatim}

This is useful if the signature from the method is hidden by a decorator.

\DUrole{versionmodified}{0.4 新版功能.}

\item {} 
The {\hyperref[ext/autodoc:directive\string-automodule]{\crossref{\code{automodule}}}}, {\hyperref[ext/autodoc:directive\string-autoclass]{\crossref{\code{autoclass}}}} and
{\hyperref[ext/autodoc:directive\string-autoexception]{\crossref{\code{autoexception}}}} directives also support a flag option called
\code{show-inheritance}.  When given, a list of base classes will be inserted
just below the class signature (when used with {\hyperref[ext/autodoc:directive\string-automodule]{\crossref{\code{automodule}}}}, this
will be inserted for every class that is documented in the module).

\DUrole{versionmodified}{0.4 新版功能.}

\item {} 
All autodoc directives support the \code{noindex} flag option that has the
same effect as for standard {\hyperref[domains:directive\string-py:function]{\crossref{\code{py:function}}}} etc. directives: no
index entries are generated for the documented object (and all
autodocumented members).

\DUrole{versionmodified}{0.4 新版功能.}

\item {} 
{\hyperref[ext/autodoc:directive\string-automodule]{\crossref{\code{automodule}}}} also recognizes the \code{synopsis}, \code{platform} and
\code{deprecated} options that the standard {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}} directive
supports.

\DUrole{versionmodified}{0.5 新版功能.}

\item {} 
{\hyperref[ext/autodoc:directive\string-automodule]{\crossref{\code{automodule}}}} and {\hyperref[ext/autodoc:directive\string-autoclass]{\crossref{\code{autoclass}}}} also has an \code{member-order}
option that can be used to override the global value of
{\color{red}\bfseries{}:confval:{}`autodoc\_member\_order{}`} for one directive.

\DUrole{versionmodified}{0.6 新版功能.}

\item {} 
The directives supporting member documentation also have a
\code{exclude-members} option that can be used to exclude single member names
from documentation, if all members are to be documented.

\DUrole{versionmodified}{0.6 新版功能.}

\end{itemize}

\begin{notice}{note}{注解:}
In an {\hyperref[ext/autodoc:directive\string-automodule]{\crossref{\code{automodule}}}} directive with the \code{members} option set, only
module members whose \code{\_\_module\_\_} attribute is equal to the module name
as given to \code{automodule} will be documented.  This is to prevent
documentation of imported classes or functions.
\end{notice}

\end{fulllineitems}

\index{autofunction (指示)}\index{autodata (指示)}\index{automethod (指示)}\index{autoattribute (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/autodoc:directive-autofunction}\pysigline{\bfcode{..~autofunction::}}\phantomsection\label{ext/autodoc:directive-autodata}\pysigline{\bfcode{..~autodata::}}\phantomsection\label{ext/autodoc:directive-automethod}\pysigline{\bfcode{..~automethod::}}\phantomsection\label{ext/autodoc:directive-autoattribute}\pysigline{\bfcode{..~autoattribute::}}
These work exactly like {\hyperref[ext/autodoc:directive\string-autoclass]{\crossref{\code{autoclass}}}} etc., but do not offer the options
used for automatic member documentation.

For module data members and class attributes, documentation can either be put
into a special-formatted comment, or in a docstring \emph{after} the definition.
Comments need to be either on a line of their own \emph{before} the definition, or
immediately after the assignment \emph{on the same line}.  The latter form is
restricted to one line only.

This means that in the following class definition, all attributes can be
autodocumented:

\begin{Verbatim}[commandchars=\\\{\}]
class Foo:
    \PYGZdq{}\PYGZdq{}\PYGZdq{}Docstring for class Foo.\PYGZdq{}\PYGZdq{}\PYGZdq{}

    \PYGZsh{}: Doc comment for class attribute Foo.bar.
    \PYGZsh{}: It can have multiple lines.
    bar = 1

    flox = 1.5   \PYGZsh{}: Doc comment for Foo.flox. One line only.

    baz = 2
    \PYGZdq{}\PYGZdq{}\PYGZdq{}Docstring for class attribute Foo.baz.\PYGZdq{}\PYGZdq{}\PYGZdq{}

    def \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}(self):
        \PYGZsh{}: Doc comment for instance attribute qux.
        self.qux = 3

        self.spam = 4
        \PYGZdq{}\PYGZdq{}\PYGZdq{}Docstring for instance attribute spam.\PYGZdq{}\PYGZdq{}\PYGZdq{}
\end{Verbatim}

\DUrole{versionmodified}{在 0.6 版更改: }{\hyperref[ext/autodoc:directive\string-autodata]{\crossref{\code{autodata}}}} and {\hyperref[ext/autodoc:directive\string-autoattribute]{\crossref{\code{autoattribute}}}} can now extract docstrings.

\DUrole{versionmodified}{在 1.1 版更改: }Comment docs are now allowed on the same line after an assignment.

\begin{notice}{note}{注解:}
If you document decorated functions or methods, keep in mind that autodoc
retrieves its docstrings by importing the module and inspecting the
\code{\_\_doc\_\_} attribute of the given function or method.  That means that if
a decorator replaces the decorated function with another, it must copy the
original \code{\_\_doc\_\_} to the new function.

From Python 2.5, \code{functools.wraps()} can be used to create
well-behaved decorating functions.
\end{notice}

\end{fulllineitems}


There are also new config values that you can set:


\subsubsection{Docstring preprocessing}
\label{ext/autodoc:docstring-preprocessing}
autodoc provides the following additional events:

The {\hyperref[ext/autodoc:module\string-sphinx.ext.autodoc]{\crossref{\code{sphinx.ext.autodoc}}}} module provides factory functions for commonly
needed docstring processing in event {\color{red}\bfseries{}:event:{}`autodoc-process-docstring{}`}:


\subsubsection{Skipping members}
\label{ext/autodoc:skipping-members}
autodoc allows the user to define a custom method for determining whether a
member should be included in the documentation by using the following event:


\subsection{\texttt{sphinx.ext.autosummary} -- Generate autodoc summaries}
\label{ext/autosummary:module-sphinx.ext.autosummary}\label{ext/autosummary:sphinx-ext-autosummary-generate-autodoc-summaries}\label{ext/autosummary::doc}\index{sphinx.ext.autosummary (模块)}
\DUrole{versionmodified}{0.6 新版功能.}

This extension generates function/method/attribute summary lists, similar to
those output e.g. by Epydoc and other API doc generation tools.  This is
especially useful when your docstrings are long and detailed, and putting each
one of them on a separate page makes them easier to read.

The {\hyperref[ext/autosummary:module\string-sphinx.ext.autosummary]{\crossref{\code{sphinx.ext.autosummary}}}} extension does this in two parts:
\begin{enumerate}
\item {} 
There is an {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} directive for generating summary listings that
contain links to the documented items, and short summary blurbs extracted
from their docstrings.

\item {} 
Optionally, the convenience script \textbf{\texttt{sphinx-autogen}} or the new
{\color{red}\bfseries{}:confval:{}`autosummary\_generate{}`} config value can be used to generate short
``stub'' files for the entries listed in the {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} directives.
These files by default contain only the corresponding {\hyperref[ext/autodoc:module\string-sphinx.ext.autodoc]{\crossref{\code{sphinx.ext.autodoc}}}}
directive, but can be customized with templates.

\end{enumerate}
\index{autosummary (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:directive-autosummary}\pysigline{\bfcode{..~autosummary::}}
Insert a table that contains links to documented items, and a short summary
blurb (the first sentence of the docstring) for each of them.

The {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} directive can also optionally serve as a
{\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}} entry for the included items. Optionally, stub
\code{.rst} files for these items can also be automatically generated.

For example,

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{currentmodule}\PYG{p}{::} sphinx

\PYG{p}{..} \PYG{o+ow}{autosummary}\PYG{p}{::}

   environment.BuildEnvironment
   util.relative\PYGZus{}uri
\end{Verbatim}

produces a table like this:
\begin{quote}
\end{quote}

Autosummary preprocesses the docstrings and signatures with the same
{\color{red}\bfseries{}:event:{}`autodoc-process-docstring{}`} and {\color{red}\bfseries{}:event:{}`autodoc-process-signature{}`}
hooks as {\hyperref[ext/autodoc:module\string-sphinx.ext.autodoc]{\crossref{\code{autodoc}}}}.

\textbf{Options}
\begin{itemize}
\item {} 
If you want the {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} table to also serve as a {\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}}
entry, use the \code{toctree} option, for example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autosummary}\PYG{p}{::}
   \PYG{n+nc}{:toctree:} \PYG{n+nf}{DIRNAME}

   sphinx.environment.BuildEnvironment
   sphinx.util.relative\PYGZus{}uri
\end{Verbatim}

The \code{toctree} option also signals to the \textbf{\texttt{sphinx-autogen}} script
that stub pages should be generated for the entries listed in this
directive.  The option accepts a directory name as an argument;
\textbf{\texttt{sphinx-autogen}} will by default place its output in this
directory. If no argument is given, output is placed in the same directory
as the file that contains the directive.

\item {} 
If you don't want the {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} to show function signatures in the
listing, include the \code{nosignatures} option:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autosummary}\PYG{p}{::}
   \PYG{n+nc}{:nosignatures:}

   sphinx.environment.BuildEnvironment
   sphinx.util.relative\PYGZus{}uri
\end{Verbatim}

\item {} 
You can specify a custom template with the \code{template} option.
For example,

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{autosummary}\PYG{p}{::}
   \PYG{n+nc}{:template:} \PYG{n+nf}{mytemplate.rst}

   sphinx.environment.BuildEnvironment
\end{Verbatim}

would use the template \code{mytemplate.rst} in your
{\color{red}\bfseries{}:confval:{}`templates\_path{}`} to generate the pages for all entries
listed. See {\hyperref[ext/autosummary:customizing\string-templates]{\crossref{Customizing templates}}} below.

\DUrole{versionmodified}{1.0 新版功能.}

\end{itemize}

\end{fulllineitems}



\subsubsection{\textbf{\texttt{sphinx-autogen}} -- generate autodoc stub pages}
\label{ext/autosummary:sphinx-autogen-generate-autodoc-stub-pages}
The \textbf{\texttt{sphinx-autogen}} script can be used to conveniently generate stub
documentation pages for items included in {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} listings.

For example, the command

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sphinx\PYGZhy{}autogen \PYGZhy{}o generated *.rst
\end{Verbatim}

will read all {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} tables in the \code{*.rst} files that have the
\code{:toctree:} option set, and output corresponding stub pages in directory
\code{generated} for all documented items.  The generated pages by default contain
text of the form:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+gh}{sphinx.util.relative\PYGZus{}uri}
\PYG{g+gh}{========================}

\PYG{p}{..} \PYG{o+ow}{autofunction}\PYG{p}{::} sphinx.util.relative\PYGZus{}uri
\end{Verbatim}

If the \code{-o} option is not given, the script will place the output files in the
directories specified in the \code{:toctree:} options.


\subsubsection{Generating stub pages automatically}
\label{ext/autosummary:generating-stub-pages-automatically}
If you do not want to create stub pages with \textbf{\texttt{sphinx-autogen}}, you can
also use this new config value:


\subsubsection{Customizing templates}
\label{ext/autosummary:customizing-templates}
\DUrole{versionmodified}{1.0 新版功能.}

You can customize the stub page templates, in a similar way as the HTML Jinja
templates, see {\hyperref[templating:templating]{\crossref{\DUrole{std,std-ref}{Templating}}}}. (\code{TemplateBridge}
is not supported.)

\begin{notice}{note}{注解:}
If you find yourself spending much time tailoring the stub templates, this
may indicate that it's a better idea to write custom narrative documentation
instead.
\end{notice}

Autosummary uses the following template files:
\begin{itemize}
\item {} 
\code{autosummary/base.rst} -- fallback template

\item {} 
\code{autosummary/module.rst} -- template for modules

\item {} 
\code{autosummary/class.rst} -- template for classes

\item {} 
\code{autosummary/function.rst} -- template for functions

\item {} 
\code{autosummary/attribute.rst} -- template for class attributes

\item {} 
\code{autosummary/method.rst} -- template for class methods

\end{itemize}

The following variables available in the templates:
\index{name (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:name}\pysigline{\bfcode{name}}
Name of the documented object, excluding the module and class parts.

\end{fulllineitems}

\index{objname (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:objname}\pysigline{\bfcode{objname}}
Name of the documented object, excluding the module parts.

\end{fulllineitems}

\index{fullname (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:fullname}\pysigline{\bfcode{fullname}}
Full name of the documented object, including module and class parts.

\end{fulllineitems}

\index{module (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:module}\pysigline{\bfcode{module}}
Name of the module the documented object belongs to.

\end{fulllineitems}

\index{class (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:class}\pysigline{\bfcode{class}}
Name of the class the documented object belongs to.  Only available for
methods and attributes.

\end{fulllineitems}

\index{underline (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:underline}\pysigline{\bfcode{underline}}
A string containing \code{len(full\_name) * '='}.

\end{fulllineitems}

\index{members (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:members}\pysigline{\bfcode{members}}
List containing names of all members of the module or class.  Only available
for modules and classes.

\end{fulllineitems}

\index{functions (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:functions}\pysigline{\bfcode{functions}}
List containing names of ``public'' functions in the module.  Here, ``public''
here means that the name does not start with an underscore. Only available
for modules.

\end{fulllineitems}

\index{classes (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:classes}\pysigline{\bfcode{classes}}
List containing names of ``public'' classes in the module.  Only available for
modules.

\end{fulllineitems}

\index{exceptions (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:exceptions}\pysigline{\bfcode{exceptions}}
List containing names of ``public'' exceptions in the module.  Only available
for modules.

\end{fulllineitems}

\index{methods (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:methods}\pysigline{\bfcode{methods}}
List containing names of ``public'' methods in the class.  Only available for
classes.

\end{fulllineitems}

\index{attributes (內置变量)}

\begin{fulllineitems}
\phantomsection\label{ext/autosummary:attributes}\pysigline{\bfcode{attributes}}
List containing names of ``public'' attributes in the class.  Only available
for classes.

\end{fulllineitems}


\begin{notice}{note}{注解:}
You can use the {\hyperref[ext/autosummary:directive\string-autosummary]{\crossref{\code{autosummary}}}} directive in the stub pages.
Stub pages are generated also based on these directives.
\end{notice}


\subsection{\texttt{sphinx.ext.doctest} -- Test snippets in the documentation}
\label{ext/doctest:module-sphinx.ext.doctest}\label{ext/doctest:sphinx-ext-doctest-test-snippets-in-the-documentation}\label{ext/doctest::doc}\index{sphinx.ext.doctest (模块)}
\index{automatic!testing}\index{testing!automatic}\index{doctest}\index{testing!snippets}\index{snippets!testing}
This extension allows you to test snippets in the documentation in a natural
way.  It works by collecting specially-marked up code blocks and running them as
doctest tests.

Within one document, test code is partitioned in \emph{groups}, where each group
consists of:
\begin{itemize}
\item {} 
zero or more \emph{setup code} blocks (e.g. importing the module to test)

\item {} 
one or more \emph{test} blocks

\end{itemize}

When building the docs with the \code{doctest} builder, groups are collected for
each document and run one after the other, first executing setup code blocks,
then the test blocks in the order they appear in the file.

There are two kinds of test blocks:
\begin{itemize}
\item {} 
\emph{doctest-style} blocks mimic interactive sessions by interleaving Python code
(including the interpreter prompt) and output.

\item {} 
\emph{code-output-style} blocks consist of an ordinary piece of Python code, and
optionally, a piece of output for that code.

\end{itemize}

The doctest extension provides four directives.  The \emph{group} argument is
interpreted as follows: if it is empty, the block is assigned to the group named
\code{default}.  If it is \code{*}, the block is assigned to all groups (including the
\code{default} group).  Otherwise, it must be a comma-separated list of group
names.
\index{testsetup (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/doctest:directive-testsetup}\pysigline{\bfcode{..~testsetup::}\code{~{[}group{]}}}
A setup code block.  This code is not shown in the output for other builders,
but executed before the doctests of the group(s) it belongs to.

\end{fulllineitems}

\index{testcleanup (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/doctest:directive-testcleanup}\pysigline{\bfcode{..~testcleanup::}\code{~{[}group{]}}}
A cleanup code block.  This code is not shown in the output for other
builders, but executed after the doctests of the group(s) it belongs to.

\DUrole{versionmodified}{1.1 新版功能.}

\end{fulllineitems}

\index{doctest (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/doctest:directive-doctest}\pysigline{\bfcode{..~doctest::}\code{~{[}group{]}}}
A doctest-style code block.  You can use standard \code{doctest} flags for
controlling how actual output is compared with what you give as output.  By
default, these options are enabled: \code{ELLIPSIS} (allowing you to put
ellipses in the expected output that match anything in the actual output),
\code{IGNORE\_EXCEPTION\_DETAIL} (not comparing tracebacks),
\code{DONT\_ACCEPT\_TRUE\_FOR\_1} (by default, doctest accepts ``True'' in the output
where ``1'' is given -- this is a relic of pre-Python 2.2 times).

This directive supports two options:
\begin{itemize}
\item {} 
\code{hide}, a flag option, hides the doctest block in other builders.  By
default it is shown as a highlighted doctest block.

\item {} 
\code{options}, a string option, can be used to give a comma-separated list of
doctest flags that apply to each example in the tests.  (You still can give
explicit flags per example, with doctest comments, but they will show up in
other builders too.)

\end{itemize}

Note that like with standard doctests, you have to use \code{\textless{}BLANKLINE\textgreater{}} to
signal a blank line in the expected output.  The \code{\textless{}BLANKLINE\textgreater{}} is removed
when building presentation output (HTML, LaTeX etc.).

Also, you can give inline doctest options, like in doctest:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZgt{}\PYGZgt{}\PYGZgt{} datetime.date.now()   \PYGZsh{} doctest: +SKIP
datetime.date(2008, 1, 1)
\end{Verbatim}

They will be respected when the test is run, but stripped from presentation
output.

\end{fulllineitems}

\index{testcode (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/doctest:directive-testcode}\pysigline{\bfcode{..~testcode::}\code{~{[}group{]}}}
A code block for a code-output-style test.

This directive supports one option:
\begin{itemize}
\item {} 
\code{hide}, a flag option, hides the code block in other builders.  By
default it is shown as a highlighted code block.

\end{itemize}

\begin{notice}{note}{注解:}
Code in a \code{testcode} block is always executed all at once, no matter how
many statements it contains.  Therefore, output will \emph{not} be generated
for bare expressions -- use \code{print}.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{testcode}\PYG{p}{::}

   1+1        \PYGZsh{} this will give no output!
   print 2+2  \PYGZsh{} this will give output

\PYG{p}{..} \PYG{o+ow}{testoutput}\PYG{p}{::}

   4
\end{Verbatim}

Also, please be aware that since the doctest module does not support
mixing regular output and an exception message in the same snippet, this
applies to testcode/testoutput as well.
\end{notice}

\end{fulllineitems}

\index{testoutput (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/doctest:directive-testoutput}\pysigline{\bfcode{..~testoutput::}\code{~{[}group{]}}}
The corresponding output, or the exception message, for the last
{\hyperref[ext/doctest:directive\string-testcode]{\crossref{\code{testcode}}}} block.

This directive supports two options:
\begin{itemize}
\item {} 
\code{hide}, a flag option, hides the output block in other builders.  By
default it is shown as a literal block without highlighting.

\item {} 
\code{options}, a string option, can be used to give doctest flags
(comma-separated) just like in normal doctest blocks.

\end{itemize}

Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{testcode}\PYG{p}{::}

   print \PYGZsq{}Output     text.\PYGZsq{}

\PYG{p}{..} \PYG{o+ow}{testoutput}\PYG{p}{::}
   \PYG{n+nc}{:hide:}
   \PYG{n+nc}{:options:} \PYG{n+nf}{\PYGZhy{}ELLIPSIS, +NORMALIZE\PYGZus{}WHITESPACE}

   Output text.
\end{Verbatim}

\end{fulllineitems}


The following is an example for the usage of the directives.  The test via
{\hyperref[ext/doctest:directive\string-doctest]{\crossref{\code{doctest}}}} and the test via {\hyperref[ext/doctest:directive\string-testcode]{\crossref{\code{testcode}}}} and {\hyperref[ext/doctest:directive\string-testoutput]{\crossref{\code{testoutput}}}} are
equivalent.

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+gh}{The parrot module}
\PYG{g+gh}{=================}

\PYG{p}{..} \PYG{o+ow}{testsetup}\PYG{p}{::} *

   import parrot

The parrot module is a module about parrots.

Doctest example:

\PYG{p}{..} \PYG{o+ow}{doctest}\PYG{p}{::}

   \PYGZgt{}\PYGZgt{}\PYGZgt{} parrot.voom(3000)
   This parrot wouldn\PYGZsq{}t voom if you put 3000 volts through it!

Test\PYGZhy{}Output example:

\PYG{p}{..} \PYG{o+ow}{testcode}\PYG{p}{::}

   parrot.voom(3000)

This would output:

\PYG{p}{..} \PYG{o+ow}{testoutput}\PYG{p}{::}

   This parrot wouldn\PYGZsq{}t voom if you put 3000 volts through it!
\end{Verbatim}

There are also these config values for customizing the doctest extension:


\subsection{\texttt{sphinx.ext.intersphinx} -- Link to other projects' documentation}
\label{ext/intersphinx:sphinx-ext-intersphinx-link-to-other-projects-documentation}\label{ext/intersphinx:module-sphinx.ext.intersphinx}\label{ext/intersphinx::doc}\index{sphinx.ext.intersphinx (模块)}
\index{automatic!linking}\index{linking!automatic}
\DUrole{versionmodified}{0.5 新版功能.}

This extension can generate automatic links to the documentation of objects in
other projects.

Usage is simple: whenever Sphinx encounters a cross-reference that has no
matching target in the current documentation set, it looks for targets in the
documentation sets configured in {\color{red}\bfseries{}:confval:{}`intersphinx\_mapping{}`}.  A reference
like \code{:py:class:{}`zipfile.ZipFile{}`} can then link to the Python documentation
for the ZipFile class, without you having to specify where it is located
exactly.

When using the ``new'' format (see below), you can even force lookup in a foreign
set by prefixing the link target appropriately.  A link like \code{:ref:{}`comparison
manual \textless{}python:comparisons\textgreater{}{}`} will then link to the label ``comparisons'' in the
doc set ``python'', if it exists.

Behind the scenes, this works as follows:
\begin{itemize}
\item {} 
Each Sphinx HTML build creates a file named \code{objects.inv} that contains
a mapping from object names to URIs relative to the HTML set's root.

\item {} 
Projects using the Intersphinx extension can specify the location of such
mapping files in the {\color{red}\bfseries{}:confval:{}`intersphinx\_mapping{}`} config value.  The mapping
will then be used to resolve otherwise missing references to objects into
links to the other documentation.

\item {} 
By default, the mapping file is assumed to be at the same location as the rest
of the documentation; however, the location of the mapping file can also be
specified individually, e.g. if the docs should be buildable without Internet
access.

\end{itemize}

To use intersphinx linking, add \code{'sphinx.ext.intersphinx'} to your
{\color{red}\bfseries{}:confval:{}`extensions{}`} config value, and use these new config values to activate
linking:


\subsection{Math support in Sphinx}
\label{ext/math:module-sphinx.ext.mathbase}\label{ext/math:math-support-in-sphinx}\label{ext/math::doc}\index{sphinx.ext.mathbase (模块)}
\DUrole{versionmodified}{0.5 新版功能.}

Since mathematical notation isn't natively supported by HTML in any way, Sphinx
supports math in documentation with several extensions.

The basic math support is contained in {\hyperref[ext/math:module\string-sphinx.ext.mathbase]{\crossref{\code{sphinx.ext.mathbase}}}}. Other math
support extensions should, if possible, reuse that support too.

\begin{notice}{note}{注解:}
{\hyperref[ext/math:module\string-sphinx.ext.mathbase]{\crossref{\code{mathbase}}}} is not meant to be added to the {\color{red}\bfseries{}:confval:{}`extensions{}`} config
value, instead, use either {\hyperref[ext/math:module\string-sphinx.ext.pngmath]{\crossref{\code{sphinx.ext.pngmath}}}} or
{\hyperref[ext/math:module\string-sphinx.ext.mathjax]{\crossref{\code{sphinx.ext.mathjax}}}} as described below.
\end{notice}

The input language for mathematics is LaTeX markup.  This is the de-facto
standard for plain-text math notation and has the added advantage that no
further translation is necessary when building LaTeX output.

{\hyperref[ext/math:module\string-sphinx.ext.mathbase]{\crossref{\code{mathbase}}}} defines these new markup elements:
\index{math (角色)}

\begin{fulllineitems}
\phantomsection\label{ext/math:role-math}\pysigline{\bfcode{:math:}}
Role for inline math.  Use like this:

\begin{Verbatim}[commandchars=\\\{\}]
Since Pythagoras, we know that \PYG{n+na}{:math:}\PYG{n+nv}{{}`a\PYGZca{}2 + b\PYGZca{}2 = c\PYGZca{}2{}`}.
\end{Verbatim}

\end{fulllineitems}

\index{math (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/math:directive-math}\pysigline{\bfcode{..~math::}}
Directive for displayed math (math that takes the whole line for itself).

The directive supports multiple equations, which should be separated by a
blank line:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{math}\PYG{p}{::}

   (a + b)\PYGZca{}2 = a\PYGZca{}2 + 2ab + b\PYGZca{}2

   (a \PYGZhy{} b)\PYGZca{}2 = a\PYGZca{}2 \PYGZhy{} 2ab + b\PYGZca{}2
\end{Verbatim}

In addition, each single equation is set within a \code{split} environment,
which means that you can have multiple aligned lines in an equation,
aligned at \code{\&} and separated by \code{\textbackslash{}\textbackslash{}}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{math}\PYG{p}{::}

   (a + b)\PYGZca{}2  \PYGZam{}=  (a + b)(a + b) \PYGZbs{}\PYGZbs{}
              \PYGZam{}=  a\PYGZca{}2 + 2ab + b\PYGZca{}2
\end{Verbatim}

For more details, look into the documentation of the \href{http://www.ams.org/publications/authors/tex/amslatex}{AmSMath LaTeX
package}.

When the math is only one line of text, it can also be given as a directive
argument:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{math}\PYG{p}{::} (a + b)\PYGZca{}2 = a\PYGZca{}2 + 2ab + b\PYGZca{}2
\end{Verbatim}

Normally, equations are not numbered.  If you want your equation to get a
number, use the \code{label} option.  When given, it selects an internal label
for the equation, by which it can be cross-referenced, and causes an equation
number to be issued.  See \code{eqref} for an example.  The numbering
style depends on the output format.

There is also an option \code{nowrap} that prevents any wrapping of the given
math in a math environment.  When you give this option, you must make sure
yourself that the math is properly set up.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{math}\PYG{p}{::}
   \PYG{n+nc}{:nowrap:}

   \PYGZbs{}begin\PYGZob{}eqnarray\PYGZcb{}
      y    \PYGZam{} = \PYGZam{} ax\PYGZca{}2 + bx + c \PYGZbs{}\PYGZbs{}
      f(x) \PYGZam{} = \PYGZam{} x\PYGZca{}2 + 2xy + y\PYGZca{}2
   \PYGZbs{}end\PYGZob{}eqnarray\PYGZcb{}
\end{Verbatim}

\end{fulllineitems}

\index{eq (角色)}

\begin{fulllineitems}
\phantomsection\label{ext/math:role-eq}\pysigline{\bfcode{:eq:}}
Role for cross-referencing equations via their label.  This currently works
only within the same document.  Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{math}\PYG{p}{::} e\PYGZca{}\PYGZob{}i\PYGZbs{}pi\PYGZcb{} + 1 = 0
   \PYG{n+nc}{:label:} \PYG{n+nf}{euler}

Euler\PYGZsq{}s identity, equation \PYG{n+na}{:eq:}\PYG{n+nv}{{}`euler{}`}, was elected one of the most
beautiful mathematical formulas.
\end{Verbatim}

\end{fulllineitems}



\subsubsection{\texttt{sphinx.ext.pngmath} -- Render math as PNG images}
\label{ext/math:sphinx-ext-pngmath-render-math-as-png-images}\label{ext/math:module-sphinx.ext.pngmath}\index{sphinx.ext.pngmath (模块)}
This extension renders math via LaTeX and \href{http://savannah.nongnu.org/projects/dvipng/}{dvipng} into PNG images.  This of
course means that the computer where the docs are built must have both programs
available.

There are various config values you can set to influence how the images are
built:


\subsubsection{\texttt{sphinx.ext.mathjax} -- Render math via JavaScript}
\label{ext/math:sphinx-ext-mathjax-render-math-via-javascript}\label{ext/math:module-sphinx.ext.mathjax}\index{sphinx.ext.mathjax (模块)}
\DUrole{versionmodified}{1.1 新版功能.}

This extension puts math as-is into the HTML files.  The JavaScript package
\href{http://www.mathjax.org/}{MathJax} is then loaded and transforms the LaTeX markup to readable math live in
the browser.

Because MathJax (and the necessary fonts) is very large, it is not included in
Sphinx.


\subsubsection{\texttt{sphinx.ext.jsmath} -- Render math via JavaScript}
\label{ext/math:sphinx-ext-jsmath-render-math-via-javascript}\label{ext/math:module-sphinx.ext.jsmath}\index{sphinx.ext.jsmath (模块)}
This extension works just as the MathJax extension does, but uses the older
package \href{http://www.math.union.edu/~dpvc/jsmath/}{jsMath}.  It provides this config value:


\subsection{\texttt{sphinx.ext.graphviz} -- Add Graphviz graphs}
\label{ext/graphviz:sphinx-ext-graphviz-add-graphviz-graphs}\label{ext/graphviz:amsmath-latex-package}\label{ext/graphviz:module-sphinx.ext.graphviz}\label{ext/graphviz::doc}\index{sphinx.ext.graphviz (模块)}
\DUrole{versionmodified}{0.6 新版功能.}

This extension allows you to embed \href{http://graphviz.org/}{Graphviz} graphs in
your documents.

It adds these directives:
\index{graphviz (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/graphviz:directive-graphviz}\pysigline{\bfcode{..~graphviz::}}
Directive to embed graphviz code.  The input code for \code{dot} is given as the
content.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{graphviz}\PYG{p}{::}

   digraph foo \PYGZob{}
      \PYGZdq{}bar\PYGZdq{} \PYGZhy{}\PYGZgt{} \PYGZdq{}baz\PYGZdq{};
   \PYGZcb{}
\end{Verbatim}

In HTML output, the code will be rendered to a PNG or SVG image (see
{\color{red}\bfseries{}:confval:{}`graphviz\_output\_format{}`}).  In LaTeX output, the code will be
rendered to an embeddable PDF file.

You can also embed external dot files, by giving the file name as an
argument to {\hyperref[ext/graphviz:directive\string-graphviz]{\crossref{\code{graphviz}}}} and no additional content:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{graphviz}\PYG{p}{::} external.dot
\end{Verbatim}

As for all file references in Sphinx, if the filename is absolute, it is
taken as relative to the source directory.

\DUrole{versionmodified}{在 1.1 版更改: }Added support for external files.

\end{fulllineitems}

\index{graph (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/graphviz:directive-graph}\pysigline{\bfcode{..~graph::}}
Directive for embedding a single undirected graph.  The name is given as a
directive argument, the contents of the graph are the directive content.
This is a convenience directive to generate \code{graph \textless{}name\textgreater{} \{ \textless{}content\textgreater{} \}}.

For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{graph}\PYG{p}{::} foo

   \PYGZdq{}bar\PYGZdq{} \PYGZhy{}\PYGZhy{} \PYGZdq{}baz\PYGZdq{};
\end{Verbatim}

\end{fulllineitems}

\index{digraph (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/graphviz:directive-digraph}\pysigline{\bfcode{..~digraph::}}
Directive for embedding a single directed graph.  The name is given as a
directive argument, the contents of the graph are the directive content.
This is a convenience directive to generate \code{digraph \textless{}name\textgreater{} \{ \textless{}content\textgreater{} \}}.

For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{digraph}\PYG{p}{::} foo

   \PYGZdq{}bar\PYGZdq{} \PYGZhy{}\PYGZgt{} \PYGZdq{}baz\PYGZdq{} \PYGZhy{}\PYGZgt{} \PYGZdq{}quux\PYGZdq{};
\end{Verbatim}

\end{fulllineitems}


\DUrole{versionmodified}{1.0 新版功能: }All three directives support an \code{alt} option that determines the image's
alternate text for HTML output.  If not given, the alternate text defaults to
the graphviz code.

\DUrole{versionmodified}{1.1 新版功能: }All three directives support an \code{inline} flag that controls paragraph
breaks in the output.  When set, the graph is inserted into the current
paragraph.  If the flag is not given, paragraph breaks are introduced before
and after the image (the default).

\DUrole{versionmodified}{1.1 新版功能: }All three directives support a \code{caption} option that can be used to give a
caption to the diagram.  Naturally, diagrams marked as ``inline'' cannot have a
caption.

There are also these new config values:


\subsection{\texttt{sphinx.ext.inheritance\_diagram} -- Include inheritance diagrams}
\label{ext/inheritance:sphinx-ext-inheritance-diagram-include-inheritance-diagrams}\label{ext/inheritance:module-sphinx.ext.inheritance_diagram}\label{ext/inheritance::doc}\index{sphinx.ext.inheritance\_diagram (模块)}
\DUrole{versionmodified}{0.6 新版功能.}

This extension allows you to include inheritance diagrams, rendered via the
{\hyperref[ext/graphviz:module\string-sphinx.ext.graphviz]{\crossref{\code{Graphviz extension}}}}.

It adds this directive:
\index{inheritance-diagram (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/inheritance:directive-inheritance-diagram}\pysigline{\bfcode{..~inheritance-diagram::}}
This directive has one or more arguments, each giving a module or class
name.  Class names can be unqualified; in that case they are taken to exist
in the currently described module (see {\hyperref[domains:directive\string-py:module]{\crossref{\code{py:module}}}}).

For each given class, and each class in each given module, the base classes
are determined.  Then, from all classes and their base classes, a graph is
generated which is then rendered via the graphviz extension to a directed
graph.

This directive supports an option called \code{parts} that, if given, must be an
integer, advising the directive to remove that many parts of module names
from the displayed names.  (For example, if all your class names start with
\code{lib.}, you can give \code{:parts: 1} to remove that prefix from the displayed
node names.)

It also supports a \code{private-bases} flag option; if given, private base
classes (those whose name starts with \code{\_}) will be included.

\DUrole{versionmodified}{在 1.1 版更改: }Added \code{private-bases} option; previously, all bases were always
included.

\end{fulllineitems}


New config values are:


\subsection{\texttt{sphinx.ext.refcounting} -- Keep track of reference counting behavior}
\label{ext/refcounting:sphinx-ext-refcounting-keep-track-of-reference-counting-behavior}\label{ext/refcounting:module-sphinx.ext.refcounting}\label{ext/refcounting::doc}\index{sphinx.ext.refcounting (模块)}

\subsection{\texttt{sphinx.ext.ifconfig} -- Include content based on configuration}
\label{ext/ifconfig:sphinx-ext-ifconfig-include-content-based-on-configuration}\label{ext/ifconfig:module-sphinx.ext.ifconfig}\label{ext/ifconfig::doc}\index{sphinx.ext.ifconfig (模块)}
This extension is quite simple, and features only one directive:
\index{ifconfig (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/ifconfig:directive-ifconfig}\pysigline{\bfcode{..~ifconfig::}}
Include content of the directive only if the Python expression given as an
argument is \code{True}, evaluated in the namespace of the project's
configuration (that is, all registered variables from \code{conf.py} are
available).

For example, one could write

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{ifconfig}\PYG{p}{::} releaselevel in (\PYGZsq{}alpha\PYGZsq{}, \PYGZsq{}beta\PYGZsq{}, \PYGZsq{}rc\PYGZsq{})

   This stuff is only included in the built docs for unstable versions.
\end{Verbatim}

To make a custom config value known to Sphinx, use
{\hyperref[ext/appapi:sphinx.application.Sphinx.add_config_value]{\crossref{\code{add\_config\_value()}}}} in the setup function in
\code{conf.py}, e.g.:

\begin{Verbatim}[commandchars=\\\{\}]
def setup(app):
    app.add\PYGZus{}config\PYGZus{}value(\PYGZsq{}releaselevel\PYGZsq{}, \PYGZsq{}\PYGZsq{}, True)
\end{Verbatim}

The second argument is the default value, the third should always be \code{True}
for such values (it selects if Sphinx re-reads the documents if the value
changes).

\end{fulllineitems}



\subsection{\texttt{sphinx.ext.coverage} -- Collect doc coverage stats}
\label{ext/coverage:module-sphinx.ext.coverage}\label{ext/coverage:sphinx-ext-coverage-collect-doc-coverage-stats}\label{ext/coverage::doc}\index{sphinx.ext.coverage (模块)}
This extension features one additional builder, the {\hyperref[ext/coverage:sphinx.ext.coverage.CoverageBuilder]{\crossref{\code{CoverageBuilder}}}}.
\index{CoverageBuilder (sphinx.ext.coverage 中的类)}

\begin{fulllineitems}
\phantomsection\label{ext/coverage:sphinx.ext.coverage.CoverageBuilder}\pysigline{\strong{class }\code{sphinx.ext.coverage.}\bfcode{CoverageBuilder}}
To use this builder, activate the coverage extension in your configuration
file and give \code{-b coverage} on the command line.

\end{fulllineitems}


Several new configuration values can be used to specify what the builder
should check:


\subsection{\texttt{sphinx.ext.todo} -- Support for todo items}
\label{ext/todo:sphinx-ext-todo-support-for-todo-items}\label{ext/todo:module-sphinx.ext.todo}\label{ext/todo::doc}\index{sphinx.ext.todo (模块)}
\DUrole{versionmodified}{0.5 新版功能.}

There are two additional directives when using this extension:
\index{todo (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/todo:directive-todo}\pysigline{\bfcode{..~todo::}}
Use this directive like, for example, {\hyperref[markup/para:directive\string-note]{\crossref{\code{note}}}}.

It will only show up in the output if {\color{red}\bfseries{}:confval:{}`todo\_include\_todos{}`} is true.

\end{fulllineitems}

\index{todolist (指示)}

\begin{fulllineitems}
\phantomsection\label{ext/todo:directive-todolist}\pysigline{\bfcode{..~todolist::}}
This directive is replaced by a list of all todo directives in the whole
documentation, if {\color{red}\bfseries{}:confval:{}`todo\_include\_todos{}`} is true.

\end{fulllineitems}


There is also an additional config value:


\subsection{\texttt{sphinx.ext.extlinks} -- Markup to shorten external links}
\label{ext/extlinks:sphinx-ext-extlinks-markup-to-shorten-external-links}\label{ext/extlinks:module-sphinx.ext.extlinks}\label{ext/extlinks::doc}\index{sphinx.ext.extlinks (模块)}
\DUrole{versionmodified}{1.0 新版功能.}

This extension is meant to help with the common pattern of having many external
links that point to URLs on one and the same site, e.g. links to bug trackers,
version control web interfaces, or simply subpages in other websites.  It does
so by providing aliases to base URLs, so that you only need to give the subpage
name when creating a link.

Let's assume that you want to include many links to issues at the Sphinx
tracker, at \code{http://bitbucket.org/birkenfeld/sphinx/issue/\emph{num}}.  Typing
this URL again and again is tedious, so you can use {\hyperref[ext/extlinks:module\string-sphinx.ext.extlinks]{\crossref{\code{extlinks}}}}
to avoid repeating yourself.

The extension adds one new config value:

\begin{notice}{note}{注解:}
Since links are generated from the role in the reading stage, they appear as
ordinary links to e.g. the \code{linkcheck} builder.
\end{notice}


\subsection{\texttt{sphinx.ext.viewcode} -- Add links to highlighted source code}
\label{ext/viewcode:sphinx-ext-viewcode-add-links-to-highlighted-source-code}\label{ext/viewcode:module-sphinx.ext.viewcode}\label{ext/viewcode::doc}\index{sphinx.ext.viewcode (模块)}
\DUrole{versionmodified}{1.0 新版功能.}

This extension looks at your Python object descriptions (\code{.. class::},
\code{.. function::} etc.) and tries to find the source files where the objects are
contained.  When found, a separate HTML page will be output for each module with
a highlighted version of the source code, and a link will be added to all object
descriptions that leads to the source code of the described object.  A link back
from the source to the description will also be inserted.

There are currently no configuration values for this extension; you just need to
add \code{'sphinx.ext.viewcode'} to your {\color{red}\bfseries{}:confval:{}`extensions{}`} value for it to work.


\subsection{\texttt{sphinx.ext.oldcmarkup} -- Compatibility extension for old C markup}
\label{ext/oldcmarkup:sphinx-ext-oldcmarkup-compatibility-extension-for-old-c-markup}\label{ext/oldcmarkup:module-sphinx.ext.oldcmarkup}\label{ext/oldcmarkup::doc}\index{sphinx.ext.oldcmarkup (模块)}
\DUrole{versionmodified}{1.0 新版功能.}

This extension is a transition helper for projects that used the old
(pre-domain) C markup, i.e. the directives like \code{cfunction} and roles like
\code{cfunc}.  Since the introduction of domains, they must be called by their
fully-qualified name (\code{c:function} and \code{c:func}, respectively) or, with the
default domain set to \code{c}, by their new name (\code{function} and \code{func}).
(See {\hyperref[domains:c\string-domain]{\crossref{\DUrole{std,std-ref}{The C Domain}}}} for the details.)

If you activate this extension, it will register the old names, and you can
use them like before Sphinx 1.0.  The directives are:
\begin{itemize}
\item {} 
\code{cfunction}

\item {} 
\code{cmember}

\item {} 
\code{cmacro}

\item {} 
\code{ctype}

\item {} 
\code{cvar}

\end{itemize}

The roles are:
\begin{itemize}
\item {} 
\code{cdata}

\item {} 
\code{cfunc}

\item {} 
\code{cmacro}

\item {} 
\code{ctype}

\end{itemize}

However, it is advised to migrate to the new markup -- this extension is a
compatibility convenience and will disappear in a future version of Sphinx.


\section{Third-party extensions}
\label{extensions:third-party-extensions}
You can find several extensions contributed by users in the \href{https://www.bitbucket.org/birkenfeld/sphinx-contrib}{Sphinx Contrib}
repository.  It is open for anyone who wants to maintain an extension
publicly; just send a short message asking for write permissions.

There are also several extensions hosted elsewhere.  The \href{https://www.bitbucket.org/birkenfeld/sphinx/wiki/Home}{Wiki at BitBucket}
maintains a list of those.

If you write an extension that you think others will find useful or you think
should be included as a part of Sphinx, please write to the project mailing
list (\href{http://groups.google.com/group/sphinx-dev}{join here}).


\subsection{Where to put your own extensions?}
\label{extensions:sphinx-contrib}\label{extensions:where-to-put-your-own-extensions}
Extensions local to a project should be put within the project's directory
structure.  Set Python's module search path, \code{sys.path}, accordingly so that
Sphinx can find them.
E.g., if your extension \code{foo.py} lies in the \code{exts} subdirectory of the
project root, put into \code{conf.py}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}\PYG{o}{,} \PYG{n+nn}{os}

\PYG{n}{sys}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{abspath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{exts}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{extensions} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{foo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{Verbatim}

You can also install extensions anywhere else on \code{sys.path}, e.g. in the
\code{site-packages} directory.


\chapter{Sphinx Web Support}
\label{websupport:websupport}\label{websupport:sphinx-web-support}\label{websupport::doc}
\DUrole{versionmodified}{1.1 新版功能.}

Sphinx provides a Python API to easily integrate Sphinx documentation into your
web application.  To learn more read the {\hyperref[web/quickstart:websupportquickstart]{\crossref{\DUrole{std,std-ref}{Web Support Quick Start}}}}.


\section{Web Support Quick Start}
\label{web/quickstart:web-support-quick-start}\label{web/quickstart:websupportquickstart}\label{web/quickstart::doc}

\subsection{Building Documentation Data}
\label{web/quickstart:building-documentation-data}
To make use of the web support package in your application you'll need to build
the data it uses.  This data includes pickle files representing documents,
search indices, and node data that is used to track where comments and other
things are in a document.  To do this you will need to create an instance of the
{\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} class and call its \code{build()} method:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sphinx}\PYG{n+nn}{.}\PYG{n+nn}{websupport} \PYG{k}{import} \PYG{n}{WebSupport}

\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{n}{srcdir}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/path/to/rst/sources/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{n}{builddir}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/path/to/build/outdir}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{n}{search}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xapian}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{support}\PYG{o}{.}\PYG{n}{build}\PYG{p}{(}\PYG{p}{)}
\end{Verbatim}

This will read reStructuredText sources from \titleref{srcdir} and place the necessary
data in \titleref{builddir}.  The \titleref{builddir} will contain two sub-directories: one named
``data'' that contains all the data needed to display documents, search through
documents, and add comments to documents.  The other directory will be called
``static'' and contains static files that should be served from ``/static''.

\begin{notice}{note}{注解:}
If you wish to serve static files from a path other than ``/static'', you can
do so by providing the \emph{staticdir} keyword argument when creating the
{\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} object.
\end{notice}


\subsection{Integrating Sphinx Documents Into Your Webapp}
\label{web/quickstart:integrating-sphinx-documents-into-your-webapp}
Now that the data is built, it's time to do something useful with it.  Start off
by creating a {\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} object for your application:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sphinx}\PYG{n+nn}{.}\PYG{n+nn}{websupport} \PYG{k}{import} \PYG{n}{WebSupport}

\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{n}{datadir}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/path/to/the/data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{n}{search}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xapian}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{Verbatim}

You'll only need one of these for each set of documentation you will be working
with.  You can then call it's \code{get\_document()} method to access
individual documents:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{contents} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{get\PYGZus{}document}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{contents}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{Verbatim}

This will return a dictionary containing the following items:
\begin{itemize}
\item {} 
\textbf{body}: The main body of the document as HTML

\item {} 
\textbf{sidebar}: The sidebar of the document as HTML

\item {} 
\textbf{relbar}: A div containing links to related documents

\item {} 
\textbf{title}: The title of the document

\item {} 
\textbf{css}: Links to css files used by Sphinx

\item {} 
\textbf{js}: Javascript containing comment options

\end{itemize}

This dict can then be used as context for templates.  The goal is to be easy to
integrate with your existing templating system.  An example using \href{http://jinja.pocoo.org/}{Jinja2} is:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{extends} \PYG{l+s+s2}{\PYGZdq{}layout.html\PYGZdq{}} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{title} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.title} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{css} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nb}{super}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.css}\PYG{o}{\textbar{}}\PYG{n+nf}{safe} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}/static/websupport\PYGZhy{}custom.css\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{js} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nb}{super}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.js}\PYG{o}{\textbar{}}\PYG{n+nf}{safe} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{relbar} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.relbar}\PYG{o}{\textbar{}}\PYG{n+nf}{safe} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{body} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.body}\PYG{o}{\textbar{}}\PYG{n+nf}{safe} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{sidebar} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
    \PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nv}{document}\PYG{n+nv}{.sidebar}\PYG{o}{\textbar{}}\PYG{n+nf}{safe} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}


\subsubsection{Authentication}
\label{web/quickstart:authentication}
To use certain features such as voting, it must be possible to authenticate
users.  The details of the authentication are left to your application.  Once a
user has been authenticated you can pass the user's details to certain
{\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} methods using the \emph{username} and \emph{moderator} keyword
arguments.  The web support package will store the username with comments and
votes.  The only caveat is that if you allow users to change their username you
must update the websupport package's data:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{support}\PYG{o}{.}\PYG{n}{update\PYGZus{}username}\PYG{p}{(}\PYG{n}{old\PYGZus{}username}\PYG{p}{,} \PYG{n}{new\PYGZus{}username}\PYG{p}{)}
\end{Verbatim}

\emph{username} should be a unique string which identifies a user, and \emph{moderator}
should be a boolean representing whether the user has moderation privilieges.
The default value for \emph{moderator} is \emph{False}.

An example \href{http://flask.pocoo.org/}{Flask} function that checks whether a
user is logged in and then retrieves a document is:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sphinx}\PYG{n+nn}{.}\PYG{n+nn}{websupport}\PYG{n+nn}{.}\PYG{n+nn}{errors} \PYG{k}{import} \PYG{o}{*}

\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/\PYGZlt{}path:docname\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{doc}\PYG{p}{(}\PYG{n}{docname}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{username} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{name} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{moderator} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{moderator} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{k}{else} \PYG{k+kc}{False}
    \PYG{k}{try}\PYG{p}{:}
        \PYG{n}{document} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{get\PYGZus{}document}\PYG{p}{(}\PYG{n}{docname}\PYG{p}{,} \PYG{n}{username}\PYG{p}{,} \PYG{n}{moderator}\PYG{p}{)}
    \PYG{k}{except} \PYG{n}{DocumentNotFoundError}\PYG{p}{:}
        \PYG{n}{abort}\PYG{p}{(}\PYG{l+m+mi}{404}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{render\PYGZus{}template}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{document}\PYG{o}{=}\PYG{n}{document}\PYG{p}{)}
\end{Verbatim}

The first thing to notice is that the \emph{docname} is just the request path.  This
makes accessing the correct document easy from a single view.  If the user is
authenticated, then the username and moderation status are passed along with the
docname to \code{get\_document()}.  The web support package will then
add this data to the \code{COMMENT\_OPTIONS} that are used in the template.

\begin{notice}{note}{注解:}
This only works works if your documentation is served from your
document root. If it is served from another directory, you will
need to prefix the url route with that directory, and give the \titleref{docroot}
keyword argument when creating the web support object:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{,} \PYG{n}{docroot}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{docs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/docs/\PYGZlt{}path:docname\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{Verbatim}
\end{notice}


\subsection{Performing Searches}
\label{web/quickstart:performing-searches}
To use the search form built-in to the Sphinx sidebar, create a function to
handle requests to the url `search' relative to the documentation root.  The
user's search query will be in the GET parameters, with the key \titleref{q}.  Then use
the \code{get\_search\_results()} method to retrieve
search results. In \href{http://flask.pocoo.org/}{Flask} that would be like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/search}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{search}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{q} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{args}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{q}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{document} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{get\PYGZus{}search\PYGZus{}results}\PYG{p}{(}\PYG{n}{q}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{render\PYGZus{}template}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{document}\PYG{o}{=}\PYG{n}{document}\PYG{p}{)}
\end{Verbatim}

Note that we used the same template to render our search results as we did to
render our documents.  That's because \code{get\_search\_results()}
returns a context dict in the same format that \code{get\_document()}
does.


\subsection{Comments \& Proposals}
\label{web/quickstart:comments-proposals}
Now that this is done it's time to define the functions that handle the AJAX
calls from the script.  You will need three functions.  The first function is
used to add a new comment, and will call the web support method
\code{add\_comment()}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/docs/add\PYGZus{}comment}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{methods}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{POST}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{add\PYGZus{}comment}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{parent\PYGZus{}id} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{parent}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{node\PYGZus{}id} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{node}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{proposal} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{proposal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{username} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{name} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{o+ow}{is} \PYG{o+ow}{not} \PYG{k+kc}{None} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Anonymous}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{comment} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{add\PYGZus{}comment}\PYG{p}{(}\PYG{n}{text}\PYG{p}{,} \PYG{n}{node\PYGZus{}id}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{node\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                                  \PYG{n}{parent\PYGZus{}id}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{parent\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                                  \PYG{n}{username}\PYG{o}{=}\PYG{n}{username}\PYG{p}{,} \PYG{n}{proposal}\PYG{o}{=}\PYG{n}{proposal}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{jsonify}\PYG{p}{(}\PYG{n}{comment}\PYG{o}{=}\PYG{n}{comment}\PYG{p}{)}
\end{Verbatim}

You'll notice that both a \titleref{parent\_id} and \titleref{node\_id} are sent with the
request. If the comment is being attached directly to a node, \titleref{parent\_id}
will be empty. If the comment is a child of another comment, then \titleref{node\_id}
will be empty. Then next function handles the retrieval of comments for a
specific node, and is aptly named
\code{get\_data()}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/docs/get\PYGZus{}comments}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}comments}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{username} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{name} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{k}{else} \PYG{k+kc}{None}
    \PYG{n}{moderator} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{moderator} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{k}{else} \PYG{k+kc}{False}
    \PYG{n}{node\PYGZus{}id} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{args}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{node}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{get\PYGZus{}data}\PYG{p}{(}\PYG{n}{node\PYGZus{}id}\PYG{p}{,} \PYG{n}{username}\PYG{p}{,} \PYG{n}{moderator}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{jsonify}\PYG{p}{(}\PYG{o}{*}\PYG{o}{*}\PYG{n}{data}\PYG{p}{)}
\end{Verbatim}

The final function that is needed will call \code{process\_vote()},
and will handle user votes on comments:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/docs/process\PYGZus{}vote}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{methods}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{POST}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{process\PYGZus{}vote}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{abort}\PYG{p}{(}\PYG{l+m+mi}{401}\PYG{p}{)}
    \PYG{n}{comment\PYGZus{}id} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{comment\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{value} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{value} \PYG{o+ow}{is} \PYG{k+kc}{None} \PYG{o+ow}{or} \PYG{n}{comment\PYGZus{}id} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{abort}\PYG{p}{(}\PYG{l+m+mi}{400}\PYG{p}{)}
    \PYG{n}{support}\PYG{o}{.}\PYG{n}{process\PYGZus{}vote}\PYG{p}{(}\PYG{n}{comment\PYGZus{}id}\PYG{p}{,} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{id}\PYG{p}{,} \PYG{n}{value}\PYG{p}{)}
    \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{success}\PYG{l+s+s2}{\PYGZdq{}}
\end{Verbatim}


\subsection{Comment Moderation}
\label{web/quickstart:comment-moderation}
By default, all comments added through \code{add\_comment()} are
automatically displayed.  If you wish to have some form of moderation, you can
pass the \titleref{displayed} keyword argument:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{comment} \PYG{o}{=} \PYG{n}{support}\PYG{o}{.}\PYG{n}{add\PYGZus{}comment}\PYG{p}{(}\PYG{n}{text}\PYG{p}{,} \PYG{n}{node\PYGZus{}id}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{node\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                              \PYG{n}{parent\PYGZus{}id}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{parent\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                              \PYG{n}{username}\PYG{o}{=}\PYG{n}{username}\PYG{p}{,} \PYG{n}{proposal}\PYG{o}{=}\PYG{n}{proposal}\PYG{p}{,}
                              \PYG{n}{displayed}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{Verbatim}

You can then create a new view to handle the moderation of comments.  It
will be called when a moderator decides a comment should be accepted and
displayed:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n+nd}{@app}\PYG{o}{.}\PYG{n}{route}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/docs/accept\PYGZus{}comment}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{methods}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{POST}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{accept\PYGZus{}comment}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{moderator} \PYG{o}{=} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{moderator} \PYG{k}{if} \PYG{n}{g}\PYG{o}{.}\PYG{n}{user} \PYG{k}{else} \PYG{k+kc}{False}
    \PYG{n}{comment\PYGZus{}id} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{form}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{support}\PYG{o}{.}\PYG{n}{accept\PYGZus{}comment}\PYG{p}{(}\PYG{n}{comment\PYGZus{}id}\PYG{p}{,} \PYG{n}{moderator}\PYG{o}{=}\PYG{n}{moderator}\PYG{p}{)}
    \PYG{k}{return} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK}\PYG{l+s+s1}{\PYGZsq{}}
\end{Verbatim}

Rejecting comments happens via comment deletion.

To perform a custom action (such as emailing a moderator) when a new comment is
added but not displayed, you can pass callable to the {\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}}
class when instantiating your support object:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{moderation\PYGZus{}callback}\PYG{p}{(}\PYG{n}{comment}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Do something...\PYGZdq{}\PYGZdq{}\PYGZdq{}}

\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{,} \PYG{n}{moderation\PYGZus{}callback}\PYG{o}{=}\PYG{n}{moderation\PYGZus{}callback}\PYG{p}{)}
\end{Verbatim}

The moderation callback must take one argument, which will be the same comment
dict that is returned by \code{add\_comment()}.


\section{The WebSupport Class}
\label{web/api:the-websupport-class}\label{web/api:websupportapi}\label{web/api::doc}\index{WebSupport (sphinx.websupport 中的类)}

\begin{fulllineitems}
\phantomsection\label{web/api:sphinx.websupport.WebSupport}\pysigline{\strong{class }\code{sphinx.websupport.}\bfcode{WebSupport}}
The main API class for the web support package.  All interactions with the
web support package should occur through this class.

The class takes the following keyword arguments:
\begin{description}
\item[{srcdir}] \leavevmode
The directory containing reStructuredText source files.

\item[{builddir}] \leavevmode
The directory that build data and static files should be placed in.  This
should be used when creating a {\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} object that will be
used to build data.

\item[{datadir}] \leavevmode
The directory that the web support data is in.  This should be used when
creating a {\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} object that will be used to retrieve data.

\item[{search}] \leavevmode
This may contain either a string (e.g. `xapian') referencing a built-in
search adapter to use, or an instance of a subclass of
{\hyperref[web/searchadapters:sphinx.websupport.search.BaseSearch]{\crossref{\code{BaseSearch}}}}.

\item[{storage}] \leavevmode
This may contain either a string representing a database uri, or an
instance of a subclass of {\hyperref[web/storagebackends:sphinx.websupport.storage.StorageBackend]{\crossref{\code{StorageBackend}}}}.  If this is
not provided, a new sqlite database will be created.

\item[{moderation\_callback}] \leavevmode
A callable to be called when a new comment is added that is not
displayed.  It must accept one argument: a dictionary representing the
comment that was added.

\item[{staticdir}] \leavevmode
If static files are served from a location besides \code{'/static'}, this
should be a string with the name of that location
(e.g. \code{'/static\_files'}).

\item[{docroot}] \leavevmode
If the documentation is not served from the base path of a URL, this
should be a string specifying that path (e.g. \code{'docs'}).

\end{description}

\end{fulllineitems}



\subsection{Methods}
\label{web/api:methods}

\section{Search Adapters}
\label{web/searchadapters:search-adapters}\label{web/searchadapters:searchadapters}\label{web/searchadapters::doc}
To create a custom search adapter you will need to subclass the
{\hyperref[web/searchadapters:sphinx.websupport.search.BaseSearch]{\crossref{\code{BaseSearch}}}} class.  Then create an instance of the new class and pass
that as the \titleref{search} keyword argument when you create the {\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}}
object:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{n}{srcdir}\PYG{o}{=}\PYG{n}{srcdir}\PYG{p}{,}
                     \PYG{n}{builddir}\PYG{o}{=}\PYG{n}{builddir}\PYG{p}{,}
                     \PYG{n}{search}\PYG{o}{=}\PYG{n}{MySearch}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{Verbatim}

For more information about creating a custom search adapter, please see the
documentation of the {\hyperref[web/searchadapters:sphinx.websupport.search.BaseSearch]{\crossref{\code{BaseSearch}}}} class below.
\index{BaseSearch (sphinx.websupport.search 中的类)}

\begin{fulllineitems}
\phantomsection\label{web/searchadapters:sphinx.websupport.search.BaseSearch}\pysigline{\strong{class }\code{sphinx.websupport.search.}\bfcode{BaseSearch}}
Defines an interface for search adapters.

\end{fulllineitems}



\subsection{BaseSearch Methods}
\label{web/searchadapters:basesearch-methods}\begin{quote}

The following methods are defined in the BaseSearch class. Some methods do
not need to be overridden, but some (\code{add\_document()} and
\code{handle\_query()}) must be overridden in your subclass. For a
working example, look at the built-in adapter for whoosh.
\end{quote}


\section{Storage Backends}
\label{web/storagebackends:storage-backends}\label{web/storagebackends:storagebackends}\label{web/storagebackends::doc}
To create a custom storage backend you will need to subclass the
{\hyperref[web/storagebackends:sphinx.websupport.storage.StorageBackend]{\crossref{\code{StorageBackend}}}} class.  Then create an instance of the new class and
pass that as the \titleref{storage} keyword argument when you create the
{\hyperref[web/api:sphinx.websupport.WebSupport]{\crossref{\code{WebSupport}}}} object:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{support} \PYG{o}{=} \PYG{n}{WebSupport}\PYG{p}{(}\PYG{n}{srcdir}\PYG{o}{=}\PYG{n}{srcdir}\PYG{p}{,}
                     \PYG{n}{builddir}\PYG{o}{=}\PYG{n}{builddir}\PYG{p}{,}
                     \PYG{n}{storage}\PYG{o}{=}\PYG{n}{MyStorage}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{Verbatim}

For more information about creating a custom storage backend, please see the
documentation of the {\hyperref[web/storagebackends:sphinx.websupport.storage.StorageBackend]{\crossref{\code{StorageBackend}}}} class below.
\index{StorageBackend (sphinx.websupport.storage 中的类)}

\begin{fulllineitems}
\phantomsection\label{web/storagebackends:sphinx.websupport.storage.StorageBackend}\pysigline{\strong{class }\code{sphinx.websupport.storage.}\bfcode{StorageBackend}}
Defines an interface for storage backends.

\end{fulllineitems}



\subsection{StorageBackend Methods}
\label{web/storagebackends:storagebackend-methods}

\chapter{Sphinx FAQ}
\label{faq:faq}\label{faq:sphinx-faq}\label{faq::doc}
This is a list of Frequently Asked Questions about Sphinx.  Feel free to
suggest new entries!


\section{How do I...}
\label{faq:how-do-i}\begin{description}
\item[{... create PDF files without LaTeX?}] \leavevmode
You can use \href{http://rst2pdf.googlecode.com}{rst2pdf} version 0.12 or greater
which comes with built-in Sphinx integration.  See the {\hyperref[builders:builders]{\crossref{\DUrole{std,std-ref}{Available builders}}}}
section for details.

\item[{... get section numbers?}] \leavevmode
They are automatic in LaTeX output; for HTML, give a \code{:numbered:} option to
the {\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}} directive where you want to start numbering.

\item[{... customize the look of the built HTML files?}] \leavevmode
Use themes, see {\hyperref[theming::doc]{\crossref{\DUrole{doc}{HTML theming support}}}}.

\item[{... add global substitutions or includes?}] \leavevmode
Add them in the {\color{red}\bfseries{}:confval:{}`rst\_epilog{}`} config value.

\item[{... display the whole TOC tree in the sidebar?}] \leavevmode
Use the {\hyperref[templating:toctree]{\crossref{\code{toctree}}}} callable in a custom layout template, probably in the
\code{sidebartoc} block.

\item[{... write my own extension?}] \leavevmode
See the {\hyperref[ext/tutorial:exttut]{\crossref{\DUrole{std,std-ref}{extension tutorial}}}}.

\item[{... convert from my existing docs using MoinMoin markup?}] \leavevmode
The easiest way is to convert to xhtml, then convert \href{http://docutils.sourceforge.net/sandbox/xhtml2rest/xhtml2rest.py}{xhtml to reST}.  You'll
still need to mark up classes and such, but the headings and code examples
come through cleanly.

\end{description}


\section{Using Sphinx with...}
\label{faq:using-sphinx-with}\label{faq:usingwith}\begin{description}
\item[{Read the Docs}] \leavevmode
\url{http://readthedocs.org} is a documentation hosting service based around Sphinx.
They will host sphinx documentation, along with supporting a number of other
features including version support, PDF generation, and more. The \href{http://read-the-docs.readthedocs.org/en/latest/getting\_started.html}{Getting
Started}
guide is a good place to start.

\item[{Epydoc}] \leavevmode
There's a third-party extension providing an \href{http://git.savannah.gnu.org/cgit/kenozooid.git/tree/doc/extapi.py}{api role} which refers to
Epydoc's API docs for a given identifier.

\item[{Doxygen}] \leavevmode
Michael Jones is developing a reST/Sphinx bridge to doxygen called \href{http://github.com/michaeljones/breathe/tree/master}{breathe}.

\item[{SCons}] \leavevmode
Glenn Hutchings has written a SCons build script to build Sphinx
documentation; it is hosted here: \url{https://bitbucket.org/zondo/sphinx-scons}

\item[{PyPI}] \leavevmode
Jannis Leidel wrote a \href{http://pypi.python.org/pypi/Sphinx-PyPI-upload}{setuptools command} that automatically uploads
Sphinx documentation to the PyPI package documentation area at
\url{http://packages.python.org/}.

\item[{GitHub Pages}] \leavevmode
Directories starting with underscores are ignored by default which breaks
static files in Sphinx.  GitHub's preprocessor can be \href{https://github.com/blog/572-bypassing-jekyll-on-github-pages}{disabled} to support
Sphinx HTML output properly.

\item[{MediaWiki}] \leavevmode
See \url{https://bitbucket.org/kevindunn/sphinx-wiki}, a project by Kevin Dunn.

\item[{Google Analytics}] \leavevmode
You can use a custom \code{layout.html} template, like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{extends} \PYG{l+s+s2}{\PYGZdq{}!layout.html\PYGZdq{}} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}}\PYGZhy{} \PYG{k}{block} \PYG{n+nv}{extrahead} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nb}{super}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/javascript\PYGZdq{}}\PYG{p}{\PYGZgt{}}
  \PYG{k+kd}{var} \PYG{n+nx}{\PYGZus{}gaq} \PYG{o}{=} \PYG{n+nx}{\PYGZus{}gaq} \PYG{o}{\textbar{}\textbar{}} \PYG{p}{[}\PYG{p}{]}\PYG{p}{;}
  \PYG{n+nx}{\PYGZus{}gaq}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}\PYGZus{}setAccount\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}XXX account number XXX\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
  \PYG{n+nx}{\PYGZus{}gaq}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}\PYGZus{}trackPageview\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}

\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{block} \PYG{n+nv}{footer} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\PYG{c+cp}{\PYGZob{}\PYGZob{}} \PYG{n+nb}{super}\PYG{o}{(}\PYG{o}{)} \PYG{c+cp}{\PYGZcb{}\PYGZcb{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{div} \PYG{n+na}{class}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}footer\PYGZdq{}}\PYG{p}{\PYGZgt{}}This page uses \PYG{p}{\PYGZlt{}}\PYG{n+nt}{a} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}http://analytics.google.com/\PYGZdq{}}\PYG{p}{\PYGZgt{}}
Google Analytics\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{a}\PYG{p}{\PYGZgt{}} to collect statistics. You can disable it by blocking
the JavaScript coming from www.google\PYGZhy{}analytics.com.
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/javascript\PYGZdq{}}\PYG{p}{\PYGZgt{}}
  \PYG{p}{(}\PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{ga} \PYG{o}{=} \PYG{n+nb}{document}\PYG{p}{.}\PYG{n+nx}{createElement}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}script\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{n+nx}{ga}\PYG{p}{.}\PYG{n+nx}{src} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}https:\PYGZsq{}} \PYG{o}{==} \PYG{n+nb}{document}\PYG{p}{.}\PYG{n+nx}{location}\PYG{p}{.}\PYG{n+nx}{protocol} \PYG{o}{?}
              \PYG{l+s+s1}{\PYGZsq{}https://ssl\PYGZsq{}} \PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}http://www\PYGZsq{}}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}.google\PYGZhy{}analytics.com/ga.js\PYGZsq{}}\PYG{p}{;}
    \PYG{n+nx}{ga}\PYG{p}{.}\PYG{n+nx}{setAttribute}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}async\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}true\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{n+nb}{document}\PYG{p}{.}\PYG{n+nx}{documentElement}\PYG{p}{.}\PYG{n+nx}{firstChild}\PYG{p}{.}\PYG{n+nx}{appendChild}\PYG{p}{(}\PYG{n+nx}{ga}\PYG{p}{)}\PYG{p}{;}
  \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{div}\PYG{p}{\PYGZgt{}}
\PYG{c+cp}{\PYGZob{}\PYGZpc{}} \PYG{k}{endblock} \PYG{c+cp}{\PYGZpc{}\PYGZcb{}}
\end{Verbatim}

\end{description}


\section{Epub info}
\label{faq:epub-info}\label{faq:epub-faq}
The epub builder is currently in an experimental stage.  It has only been tested
with the Sphinx documentation itself.  If you want to create epubs, here are
some notes:
\begin{itemize}
\item {} 
Split the text into several files. The longer the individual HTML files are,
the longer it takes the ebook reader to render them.  In extreme cases, the
rendering can take up to one minute.

\item {} 
Try to minimize the markup.  This also pays in rendering time.

\item {} 
For some readers you can use embedded or external fonts using the CSS
\code{@font-face} directive.  This is \emph{extremely} useful for code listings which
are often cut at the right margin.  The default Courier font (or variant) is
quite wide and you can only display up to 60 characters on a line.  If you
replace it with a narrower font, you can get more characters on a line.  You
may even use \href{http://fontforge.sourceforge.net/}{FontForge} and create
narrow variants of some free font.  In my case I get up to 70 characters on a
line.

You may have to experiment a little until you get reasonable results.

\item {} 
Test the created epubs. You can use several alternatives.  The ones I am aware
of are \href{http://code.google.com/p/epubcheck/}{Epubcheck}, \href{http://calibre-ebook.com/}{Calibre}, \href{http://www.fbreader.org/}{FBreader} (although it does not render the CSS),
and \href{http://bookworm.oreilly.com/}{Bookworm}.  For bookworm you can download the source from
\url{http://code.google.com/p/threepress/} and run your own local server.

\item {} 
Large floating divs are not displayed properly.
If they cover more than one page, the div is only shown on the first page.
In that case you can copy the \code{epub.css} from the
\code{sphinx/themes/epub/static/} directory to your local \code{\_static/}
directory and remove the float settings.

\item {} 
Files that are inserted outside of the \code{toctree} directive must be manually
included. This sometimes applies to appendixes, e.g. the glossary or
the indices.  You can add them with the {\color{red}\bfseries{}:confval:{}`epub\_post\_files{}`} option.

\end{itemize}


\section{Texinfo info}
\label{faq:texinfo-info}\label{faq:texinfo-faq}
The Texinfo builder is currently in an experimental stage but has successfully
been used to build the documentation for both Sphinx and Python.  The intended
use of this builder is to generate Texinfo that is then processed into Info
files.

There are two main programs for reading Info files, \code{info} and GNU Emacs.  The
\code{info} program has less features but is available in most Unix environments
and can be quickly accessed from the terminal.  Emacs provides better font and
color display and supports extensive customization (of course).


\subsection{Displaying Links}
\label{faq:texinfo-links}\label{faq:displaying-links}
One noticeable problem you may encounter with the generated Info files is how
references are displayed.  If you read the source of an Info file, a reference
to this section would look like:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{o}{*} \PYG{n}{note} \PYG{n}{Displaying} \PYG{n}{Links}\PYG{p}{:} \PYG{n}{target}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{id}
\end{Verbatim}

In the stand-alone reader, \code{info}, references are displayed just as they
appear in the source.  Emacs, on the other-hand, will by default replace
\code{\textbackslash{}*note:} with \code{see} and hide the \code{target-id}.  For example:
\begin{quote}

{\hyperref[faq:texinfo\string-links]{\crossref{\DUrole{std,std-ref}{Displaying Links}}}}
\end{quote}

The exact behavior of how Emacs displays references is dependent on the variable
\code{Info-hide-note-references}.  If set to the value of \code{hide}, Emacs will hide
both the \code{\textbackslash{}*note:} part and the \code{target-id}.  This is generally the best way
to view Sphinx-based documents since they often make frequent use of links and
do not take this limitation into account.  However, changing this variable
affects how all Info documents are displayed and most due take this behavior
into account.

If you want Emacs to display Info files produced by Sphinx using the value
\code{hide} for \code{Info-hide-note-references} and the default value for all other
Info files, try adding the following Emacs Lisp code to your start-up file,
\code{\textasciitilde{}/.emacs.d/init.el}.

\begin{Verbatim}[commandchars=\\\{\}]
(defadvice info\PYGZhy{}insert\PYGZhy{}file\PYGZhy{}contents (after
                                      sphinx\PYGZhy{}info\PYGZhy{}insert\PYGZhy{}file\PYGZhy{}contents
                                      activate)
  \PYGZdq{}Hack to make {}`Info\PYGZhy{}hide\PYGZhy{}note\PYGZhy{}references\PYGZsq{} buffer\PYGZhy{}local and
automatically set to {}`hide\PYGZsq{} iff it can be determined that this file
was created from a Texinfo file generated by Docutils or Sphinx.\PYGZdq{}
  (set (make\PYGZhy{}local\PYGZhy{}variable \PYGZsq{}Info\PYGZhy{}hide\PYGZhy{}note\PYGZhy{}references)
       (default\PYGZhy{}value \PYGZsq{}Info\PYGZhy{}hide\PYGZhy{}note\PYGZhy{}references))
  (save\PYGZhy{}excursion
    (save\PYGZhy{}restriction
      (widen) (goto\PYGZhy{}char (point\PYGZhy{}min))
      (when (re\PYGZhy{}search\PYGZhy{}forward
             \PYGZdq{}\PYGZca{}Generated by \PYGZbs{}\PYGZbs{}(Sphinx\PYGZbs{}\PYGZbs{}\textbar{}Docutils\PYGZbs{}\PYGZbs{})\PYGZdq{}
             (save\PYGZhy{}excursion (search\PYGZhy{}forward \PYGZdq{}\PYGZbs{}x1f\PYGZdq{} nil t)) t)
        (set (make\PYGZhy{}local\PYGZhy{}variable \PYGZsq{}Info\PYGZhy{}hide\PYGZhy{}note\PYGZhy{}references)
             \PYGZsq{}hide)))))
\end{Verbatim}


\subsection{Notes}
\label{faq:notes}
The following notes may be helpful if you want to create Texinfo files:
\begin{itemize}
\item {} 
Each section corresponds to a different \code{node} in the Info file.

\item {} 
Colons (\code{:}) cannot be properly escaped in menu entries and xrefs.
They will be replaced with semicolons (\code{;}).

\item {} 
In the HTML and Tex output, the word \code{see} is automatically inserted before
all xrefs.

\item {} 
Links to external Info files can be created using the somewhat official URI
scheme \code{info}.  For example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{info}\PYG{p}{:}\PYG{n}{Texinfo}\PYG{c+c1}{\PYGZsh{}makeinfo\PYGZus{}options}
\end{Verbatim}

which produces:
\begin{quote}

info:Texinfo\#makeinfo\_options
\end{quote}

\item {} 
Inline markup appears as follows in Info:
\begin{itemize}
\item {} 
strong -- *strong*

\item {} 
emphasis -- \_emphasis\_

\item {} 
literal -- {}`literal'

\end{itemize}

It is possible to change this behavior using the Texinfo command
\code{@definfoenclose}.  For example, to make inline markup more closely resemble
reST, add the following to your \code{conf.py}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{texinfo\PYGZus{}elements} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{preamble}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}}
\PYG{l+s+s2}{@definfoenclose strong,**,**}
\PYG{l+s+s2}{@definfoenclose emph,*,*}
\PYG{l+s+s2}{@definfoenclose code,{}`@w}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s2}{{}`,{}`@w}\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s2}{{}`}
\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\end{Verbatim}

\end{itemize}


\chapter{Glossary}
\label{glossary:id1}\label{glossary:glossary}\label{glossary::doc}\begin{description}
\item[{builder\index{builder|textbf}}] \leavevmode\phantomsection\label{glossary:term-builder}
A class (inheriting from {\hyperref[ext/builderapi:sphinx.builders.Builder]{\crossref{\code{Builder}}}}) that takes
parsed documents and performs an action on them.  Normally, builders
translate the documents to an output format, but it is also possible to
use the builder builders that e.g. check for broken links in the
documentation, or build coverage information.

See {\hyperref[builders:builders]{\crossref{\DUrole{std,std-ref}{Available builders}}}} for an overview over Sphinx' built-in builders.

\item[{configuration directory\index{configuration directory|textbf}}] \leavevmode\phantomsection\label{glossary:term-configuration-directory}
The directory containing \code{conf.py}.  By default, this is the same as
the {\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}}, but can be set differently with the \textbf{-c}
command-line option.

\item[{directive\index{directive|textbf}}] \leavevmode\phantomsection\label{glossary:term-directive}
A reStructuredText markup element that allows marking a block of content
with special meaning.  Directives are supplied not only by docutils, but
Sphinx and custom extensions can add their own.  The basic directive
syntax looks like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{directivename}\PYG{p}{::} argument ...
   \PYG{n+nc}{:option:} \PYG{n+nf}{value}

   Content of the directive.
\end{Verbatim}

See {\hyperref[rest:directives]{\crossref{\DUrole{std,std-ref}{指令}}}} for more information.

\item[{document name\index{document name|textbf}}] \leavevmode\phantomsection\label{glossary:term-document-name}
Since reST source files can have different extensions (some people like
\code{.txt}, some like \code{.rst} -- the extension can be configured with
{\color{red}\bfseries{}:confval:{}`source\_suffix{}`}) and different OSes have different path separators,
Sphinx abstracts them: \emph{document names} are always relative to the
{\hyperref[glossary:term\string-source\string-directory]{\termref{\DUrole{xref,std,std-term}{source directory}}}}, the extension is stripped, and path separators
are converted to slashes.  All values, parameters and such referring to
``documents'' expect such document names.

Examples for document names are \code{index}, \code{library/zipfile}, or
\code{reference/datamodel/types}.  Note that there is no leading or trailing
slash.

\item[{domain\index{domain|textbf}}] \leavevmode\phantomsection\label{glossary:term-domain}
A domain is a collection of markup (reStructuredText {\hyperref[glossary:term\string-directive]{\termref{\DUrole{xref,std,std-term}{directive}}}}s
and {\hyperref[glossary:term\string-role]{\termref{\DUrole{xref,std,std-term}{role}}}}s) to describe and link to {\hyperref[glossary:term\string-object]{\termref{\DUrole{xref,std,std-term}{object}}}}s belonging
together, e.g. elements of a programming language.  Directive and role
names in a domain have names like \code{domain:name}, e.g. \code{py:function}.

Having domains means that there are no naming problems when one set of
documentation wants to refer to e.g. C++ and Python classes.  It also
means that extensions that support the documentation of whole new
languages are much easier to write.  For more information about domains,
see the chapter {\hyperref[domains:domains]{\crossref{\DUrole{std,std-ref}{Sphinx Domains}}}}.

\item[{environment\index{environment|textbf}}] \leavevmode\phantomsection\label{glossary:term-environment}
A structure where information about all documents under the root is saved,
and used for cross-referencing.  The environment is pickled after the
parsing stage, so that successive runs only need to read and parse new and
changed documents.

\item[{master document\index{master document|textbf}}] \leavevmode\phantomsection\label{glossary:term-master-document}
The document that contains the root {\hyperref[markup/toctree:directive\string-toctree]{\crossref{\code{toctree}}}} directive.

\item[{object\index{object|textbf}}] \leavevmode\phantomsection\label{glossary:term-object}
The basic building block of Sphinx documentation.  Every ``object
directive'' (e.g. \code{function} or {\hyperref[domains:directive\string-object]{\crossref{\code{object}}}}) creates such a block;
and most objects can be cross-referenced to.

\item[{role\index{role|textbf}}] \leavevmode\phantomsection\label{glossary:term-role}
A reStructuredText markup element that allows marking a piece of text.
Like directives, roles are extensible.  The basic syntax looks like this:
\code{:rolename:{}`content{}`}.  See {\hyperref[rest:inlinemarkup]{\crossref{\DUrole{std,std-ref}{内联标记}}}} for details.

\item[{source directory\index{source directory|textbf}}] \leavevmode\phantomsection\label{glossary:term-source-directory}
The directory which, including its subdirectories, contains all source
files for one Sphinx project.

\end{description}


\chapter{索引及表格}
\label{contents:id1}\begin{itemize}
\item {} 
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\DUrole{xref,std,std-ref}{search}

\item {} 
{\hyperref[glossary:glossary]{\crossref{\DUrole{std,std-ref}{Glossary}}}}

\end{itemize}


\renewcommand{\indexname}{Python 模块索引}
\begin{theindex}
\def\bigletter#1{{\Large\sffamily#1}\nopagebreak\vspace{1mm}}
\bigletter{c}
\item {\texttt{conf}}, \pageref{config:module-conf}
\indexspace
\bigletter{s}
\item {\texttt{sphinx.application}}, \pageref{extensions:module-sphinx.application}
\item {\texttt{sphinx.builders}}, \pageref{builders:module-sphinx.builders}
\item {\texttt{sphinx.builders.changes}}, \pageref{builders:module-sphinx.builders.changes}
\item {\texttt{sphinx.builders.devhelp}}, \pageref{builders:module-sphinx.builders.devhelp}
\item {\texttt{sphinx.builders.epub}}, \pageref{builders:module-sphinx.builders.epub}
\item {\texttt{sphinx.builders.gettext}}, \pageref{builders:module-sphinx.builders.gettext}
\item {\texttt{sphinx.builders.html}}, \pageref{builders:module-sphinx.builders.html}
\item {\texttt{sphinx.builders.htmlhelp}}, \pageref{builders:module-sphinx.builders.htmlhelp}
\item {\texttt{sphinx.builders.latex}}, \pageref{builders:module-sphinx.builders.latex}
\item {\texttt{sphinx.builders.linkcheck}}, \pageref{builders:module-sphinx.builders.linkcheck}
\item {\texttt{sphinx.builders.manpage}}, \pageref{builders:module-sphinx.builders.manpage}
\item {\texttt{sphinx.builders.qthelp}}, \pageref{builders:module-sphinx.builders.qthelp}
\item {\texttt{sphinx.builders.texinfo}}, \pageref{builders:module-sphinx.builders.texinfo}
\item {\texttt{sphinx.builders.text}}, \pageref{builders:module-sphinx.builders.text}
\item {\texttt{sphinx.domains}}, \pageref{ext/appapi:module-sphinx.domains}
\item {\texttt{sphinx.ext.autodoc}}, \pageref{ext/autodoc:module-sphinx.ext.autodoc}
\item {\texttt{sphinx.ext.autosummary}}, \pageref{ext/autosummary:module-sphinx.ext.autosummary}
\item {\texttt{sphinx.ext.coverage}}, \pageref{ext/coverage:module-sphinx.ext.coverage}
\item {\texttt{sphinx.ext.doctest}}, \pageref{ext/doctest:module-sphinx.ext.doctest}
\item {\texttt{sphinx.ext.extlinks}}, \pageref{ext/extlinks:module-sphinx.ext.extlinks}
\item {\texttt{sphinx.ext.graphviz}}, \pageref{ext/graphviz:module-sphinx.ext.graphviz}
\item {\texttt{sphinx.ext.ifconfig}}, \pageref{ext/ifconfig:module-sphinx.ext.ifconfig}
\item {\texttt{sphinx.ext.inheritance\_diagram}}, \pageref{ext/inheritance:module-sphinx.ext.inheritance_diagram}
\item {\texttt{sphinx.ext.intersphinx}}, \pageref{ext/intersphinx:module-sphinx.ext.intersphinx}
\item {\texttt{sphinx.ext.jsmath}}, \pageref{ext/math:module-sphinx.ext.jsmath}
\item {\texttt{sphinx.ext.mathbase}}, \pageref{ext/math:module-sphinx.ext.mathbase}
\item {\texttt{sphinx.ext.mathjax}}, \pageref{ext/math:module-sphinx.ext.mathjax}
\item {\texttt{sphinx.ext.oldcmarkup}}, \pageref{ext/oldcmarkup:module-sphinx.ext.oldcmarkup}
\item {\texttt{sphinx.ext.pngmath}}, \pageref{ext/math:module-sphinx.ext.pngmath}
\item {\texttt{sphinx.ext.refcounting}}, \pageref{ext/refcounting:module-sphinx.ext.refcounting}
\item {\texttt{sphinx.ext.todo}}, \pageref{ext/todo:module-sphinx.ext.todo}
\item {\texttt{sphinx.ext.viewcode}}, \pageref{ext/viewcode:module-sphinx.ext.viewcode}
\end{theindex}

\renewcommand{\indexname}{索引}
\printindex
\end{document}
